import{_ as H}from"./index-ByJwDCaU.js";import{b1 as O,c as U,o as $,w as o,b as l,aI as S,aJ as T,dc as G,aK as A,aM as L,u,aD as M,h as b,a$ as B,b0 as j,r as v,a as J,v as P,aR as Q,aC as q,m as N,U as K,d as F,a5 as X,E as Y,a8 as Z,t as ee,b8 as le,ay as te,k as oe,bR as ae,au as ne,aF as se}from"./index-AWZvdbgs.js";import{_ as W}from"./index-BWkpR5g6.js";import{_ as re}from"./index-DWBgQO06.js";import"./index-axKr1LNA.js";import{_ as de}from"./index-C8O7s9CO.js";import"./index-CkvP5V7E.js";import"./virtual-list-B-mgPJnJ.js";import"./index-BVfMDzgA.js";import"./index-DgrYBINK.js";import{a as ue,E as ie}from"./col-DZqiZqzL.js";import{E as me}from"./input-number-btnEw-i9.js";import{u as pe,a as ce,b as fe,c as _e,l as ve,p as ge,r as be}from"./index-nLRxoiQQ.js";import{E as ye}from"./tree-BwbXXe5O.js";import"./isArrayLikeObject-CgR4g7QS.js";import"./vuedraggable.umd-D8mshle6.js";import"./index-Byen0zw0.js";const Ve={__name:"role-search",emits:["search"],setup(R,{emit:x}){const k=x,[i,f]=O({roleName:"",roleCode:"",comments:""}),r=()=>{k("search",{...i})},c=()=>{f(),r()};return(y,s)=>{const C=L,h=A,E=ie,m=M,a=ue,t=S,n=W;return $(),U(n,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[l(t,{"label-width":"72px",onKeyup:G(r,["enter"]),onSubmit:s[2]||(s[2]=T(()=>{},["prevent"]))},{default:o(()=>[l(a,{gutter:8},{default:o(()=>[l(E,{lg:6,md:8,sm:12,xs:24},{default:o(()=>[l(h,{label:"角色名称"},{default:o(()=>[l(C,{clearable:"",modelValue:u(i).roleName,"onUpdate:modelValue":s[0]||(s[0]=e=>u(i).roleName=e),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(E,{lg:6,md:8,sm:12,xs:24},{default:o(()=>[l(h,{label:"角色标识"},{default:o(()=>[l(C,{clearable:"",modelValue:u(i).roleCode,"onUpdate:modelValue":s[1]||(s[1]=e=>u(i).roleCode=e),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(E,{lg:12,md:8,sm:24,xs:24},{default:o(()=>[l(h,{"label-width":"16px"},{default:o(()=>[l(m,{type:"primary",onClick:r},{default:o(()=>s[3]||(s[3]=[b("查询")])),_:1}),l(m,{onClick:c},{default:o(()=>s[4]||(s[4]=[b("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},xe={__name:"role-edit",props:B({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(R,{emit:x}){const k=R,i=x,f=j(R,"modelValue"),r=v(!1),c=v(!1),y=v(null),[s,C,h]=O({roleId:void 0,roleName:"",roleCode:"",sortNum:1,status:"ENABLED",comments:""}),E=J({roleName:[{required:!0,message:"请输入角色名称",type:"string",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色标识",type:"string",trigger:"blur"}]}),m=()=>{f.value=!1},a=()=>{var n,e;(e=(n=y.value)==null?void 0:n.validate)==null||e.call(n,_=>{if(!_)return;c.value=!0,(r.value?pe:ce)(s).then(p=>{c.value=!1,N.success(p),m(),i("done")}).catch(p=>{c.value=!1,N.error(p.message)})})},t=()=>{k.data?(h(k.data),r.value=!0):(C(),r.value=!1),K(()=>{K(()=>{var n,e;(e=(n=y.value)==null?void 0:n.clearValidate)==null||e.call(n)})})};return(n,e)=>{const _=L,g=A,p=me,I=Q,d=P,w=S,D=M,z=q;return $(),U(z,{form:"",width:460,modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=V=>f.value=V),title:r.value?"修改角色":"添加角色",onOpen:t},{footer:o(()=>[l(D,{onClick:m},{default:o(()=>e[9]||(e[9]=[b("取消")])),_:1}),l(D,{type:"primary",loading:c.value,onClick:a},{default:o(()=>e[10]||(e[10]=[b(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[l(w,{ref_key:"formRef",ref:y,model:u(s),rules:E,"label-width":"80px",onSubmit:e[5]||(e[5]=T(()=>{},["prevent"]))},{default:o(()=>[l(g,{label:"角色名称",prop:"roleName"},{default:o(()=>[l(_,{clearable:"",maxlength:20,modelValue:u(s).roleName,"onUpdate:modelValue":e[0]||(e[0]=V=>u(s).roleName=V),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(g,{label:"角色标识",prop:"roleCode"},{default:o(()=>[l(_,{clearable:"",maxlength:20,modelValue:u(s).roleCode,"onUpdate:modelValue":e[1]||(e[1]=V=>u(s).roleCode=V),placeholder:"请输入角色标识"},null,8,["modelValue"])]),_:1}),l(g,{prop:"sortNum",label:"角色顺序",required:""},{default:o(()=>[l(p,{modelValue:u(s).sortNum,"onUpdate:modelValue":e[2]||(e[2]=V=>u(s).sortNum=V),min:1},null,8,["modelValue"])]),_:1}),l(g,{prop:"status",label:"角色状态"},{default:o(()=>[l(d,{modelValue:u(s).status,"onUpdate:modelValue":e[3]||(e[3]=V=>u(s).status=V)},{default:o(()=>[l(I,{value:"ENABLED",size:"small"},{default:o(()=>e[7]||(e[7]=[b("启用")])),_:1}),l(I,{value:"DISABLED",size:"small"},{default:o(()=>e[8]||(e[8]=[b("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"备注"},{default:o(()=>[l(_,{rows:4,type:"textarea",modelValue:u(s).comments,"onUpdate:modelValue":e[4]||(e[4]=V=>u(s).comments=V),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},ke={style:{"vertical-align":"-2px"}},Ce={__name:"role-auth",props:B({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(R){const x=R,k=j(R,"modelValue"),i=v(null),f=v([]),r=v(!1),c=v(!1),y=v([]),s=()=>{f.value=[],y.value=[],x.data&&(r.value=!0,_e(x.data.roleId).then(m=>{r.value=!1,f.value=le({data:m.menus,idField:"menuId",parentIdField:"parentId"}),y.value=m.checked_menu_ids,console.log("checkedKeys",y.value)}).catch(m=>{r.value=!1,N.error(m.message)}))},C=()=>{k.value=!1},h=()=>{var a,t,n,e,_,g,p,I;c.value=!0;const m=(p=((n=(t=(a=i.value)==null?void 0:a.getCheckedKeys)==null?void 0:t.call(a))!=null?n:[]).concat((g=(_=(e=i.value)==null?void 0:e.getHalfCheckedKeys)==null?void 0:_.call(e))!=null?g:[]))!=null?p:[];fe((I=x.data)==null?void 0:I.roleId,m).then(d=>{c.value=!1,N.success(d),C()}).catch(d=>{c.value=!1,N.error(d.message)})},E=()=>{s()};return(m,a)=>{const t=Y,n=ye,e=de,_=M,g=q;return $(),U(g,{width:460,title:"分配权限",position:"center",modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=p=>k.value=p),"body-style":{padding:"12px 0 12px 22px"},onOpen:E},{footer:o(()=>[l(_,{onClick:C},{default:o(()=>a[1]||(a[1]=[b("取消")])),_:1}),l(_,{type:"primary",loading:c.value,onClick:h},{default:o(()=>a[2]||(a[2]=[b(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[l(e,{loading:r.value,"spinner-style":{background:"transparent"},style:{paddingRight:"20px",height:"calc(100vh - 192px)",maxHeight:"calc(100dvh - 192px)",minHeight:"100px",overflow:"auto"}},{default:o(()=>[l(n,{ref_key:"treeRef",ref:i,"show-checkbox":"",data:f.value,"node-key":"menuId","default-expand-all":!0,props:{label:"title"},"default-checked-keys":y.value,style:{"--ele-tree-item-height":"28px"}},{default:o(p=>[F("div",null,[p.data.icon?($(),U(t,{key:0,size:16,style:{"margin-right":"6px","vertical-align":"-5px"}},{default:o(()=>[($(),U(Z(p.data.icon)))]),_:2},1024)):X("",!0),F("span",ke,ee(p.data.title),1)])]),_:1},8,["data","default-checked-keys"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])}}},Le=Object.assign({name:"SystemRole"},{__name:"index",setup(R){const x=v(null),k=v([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",sortable:"custom",minWidth:120},{prop:"roleCode",label:"角色标识",sortable:"custom",minWidth:120},{prop:"sortNum",label:"排序",sortable:"custom",minWidth:80},{prop:"comments",label:"备注",sortable:"custom",minWidth:140},{prop:"create_time",label:"创建时间",sortable:"custom",width:180,align:"center"},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),i=v([]),f=v(null),r=v(!1),c=v(!1),y=({pages:a,where:t,orders:n})=>ge({...t,...n,...a}),s=a=>{var t,n;i.value=[],(n=(t=x.value)==null?void 0:t.reload)==null||n.call(t,{page:1,where:a})},C=a=>{f.value=a!=null?a:null,r.value=!0},h=a=>{f.value=a!=null?a:null,c.value=!0},E=a=>{const t=a==null?i.value:[a];if(!t.length){N.error("请至少选择一条数据");return}se.confirm("确定要删除“"+t.map(n=>n.roleName).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const n=N.loading({message:"请求中..",plain:!0});be(t.map(e=>e.roleId)).then(e=>{n.close(),N.success(e),s()}).catch(e=>{n.close(),N.error(e.message)})}).catch(()=>{})},m=({where:a,orders:t})=>ve({...a,...t});return(a,t)=>{const n=M,e=te,_=oe,g=re,p=W,I=H;return $(),U(I,null,{default:o(()=>[l(Ve,{onSearch:s}),l(p,{"body-style":{paddingTop:"8px"}},{default:o(()=>[l(g,{ref_key:"tableRef",ref:x,"row-key":"roleId",columns:k.value,datasource:y,"show-overflow-tooltip":!0,selections:i.value,"onUpdate:selections":t[2]||(t[2]=d=>i.value=d),"highlight-current-row":!0,"export-config":{fileName:"角色数据",datasource:m},"print-config":{datasource:m},"cache-key":"systemRoleTable"},{toolbar:o(()=>[l(n,{type:"primary",class:"ele-btn-icon",icon:u(ae),onClick:t[0]||(t[0]=d=>C())},{default:o(()=>t[5]||(t[5]=[b(" 新建 ")])),_:1},8,["icon"]),l(n,{type:"danger",class:"ele-btn-icon",icon:u(ne),onClick:t[1]||(t[1]=d=>E())},{default:o(()=>t[6]||(t[6]=[b(" 删除 ")])),_:1},8,["icon"])]),action:o(({row:d})=>[l(e,{type:"primary",underline:!1,onClick:w=>C(d)},{default:o(()=>t[7]||(t[7]=[b(" 修改 ")])),_:2},1032,["onClick"]),l(_,{direction:"vertical"}),l(e,{type:"primary",underline:!1,onClick:w=>h(d)},{default:o(()=>t[8]||(t[8]=[b(" 分配权限 ")])),_:2},1032,["onClick"]),l(_,{direction:"vertical"}),l(e,{type:"danger",underline:!1,onClick:w=>E(d)},{default:o(()=>t[9]||(t[9]=[b(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections","export-config","print-config"])]),_:1}),l(xe,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=d=>r.value=d),data:f.value,onDone:s},null,8,["modelValue","data"]),l(Ce,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=d=>c.value=d),data:f.value},null,8,["modelValue","data"])]),_:1})}}});export{Le as default};
