import{a$ as x,b0 as N,c as I,o as U,aL as T,p as F,w as M,a1 as R,bX as D,bY as J,m as O,r as C,R as j}from"./index-Bq3ZSOYo.js";import"./index-BGJoVFV4.js";import"./upload-BCVNaYCK.js";import"./progress-CTIqQ9U3.js";import{g as z}from"./index-REJM3uj7.js";import{u as W}from"./index-ahn91JRz.js";const L=Object.assign({name:"CommonUpload"},{__name:"index",props:x({fileLimit:{type:Number,default:100},readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:{type:Boolean,default:!0},accept:{type:String,default:""},itemStyle:Object,buttonStyle:Object,sortable:{type:[Boolean,Object],default:()=>({forceFallback:!0})},imageProps:Object,progressProps:Object,previewProps:Object,tools:{type:Boolean,default:!0},listType:String,beforeUploadClick:Function,beforeItemEdit:Function,beforePreview:Function,locale:Object},{modelValue:{type:Array,default:()=>[]},modelModifiers:{}}),emits:x(["itemClick","preview"],["update:modelValue"]),setup(t,{emit:v}){const g=t,c=v,m=N(t,"modelValue"),u=a=>{if(a){if(g.accept==="image/*"){if(!a.type.startsWith("image")){O.error("只能选择图片");return}}else if(g.accept===".xls,.xlsx"&&!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(a.type)){O.error("只能选择 excel 文件");return}if(g.fileLimit&&a.size/1024/1024>g.fileLimit){O.error(`大小不能超过 ${g.fileLimit}MB`);return}return!0}},b=(a,r)=>{if(!a.file||!u(a.file))return;r||m.value.push({...a});const i=m.value.find(e=>e.key===a.key);i&&(i.status="uploading",i.progress=0,W(a.file,{onUploadProgress:e=>{e.total!=null&&i.status!=="done"&&(i.progress=e.loaded/e.total*100)}}).then(e=>{i.progress=100,i.status="done",i.url=e.url}).catch(e=>{i.status="exception",O.error(e.message)}))},P=({item:a,newItem:r})=>{if(!u(r.file))return;const i=m.value.find(e=>e.key===a.key);i&&(i.url=void 0,i.name=r.name,i.file=r.file,i.progress=0,i.status=void 0,b(i,!0))},h=a=>{m.value.splice(m.value.indexOf(a),1)},w=a=>{c("itemClick",a)},S=a=>{c("preview",a)};return(a,r)=>{const i=z;return U(),I(i,{modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=e=>m.value=e),readonly:t.readonly,disabled:t.disabled,preview:t.preview,limit:t.limit,multiple:t.multiple,drag:t.drag,accept:t.accept,itemStyle:t.itemStyle,buttonStyle:t.buttonStyle,sortable:t.sortable,imageProps:t.imageProps,progressProps:t.progressProps,previewProps:t.previewProps,tools:t.tools,listType:t.listType,beforeUploadClick:t.beforeUploadClick,beforeItemEdit:t.beforeItemEdit,beforePreview:t.beforePreview,locale:t.locale,onUpload:b,onRetry:r[1]||(r[1]=e=>b(e,!0)),onRemove:h,onEditUpload:P,onItemClick:w,onPreview:S},T({_:2},[F(Object.keys(a.$slots),e=>({name:e,fn:M(o=>[R(a.$slots,e,D(J(o||{})))])}))]),1032,["modelValue","readonly","disabled","preview","limit","multiple","drag","accept","itemStyle","buttonStyle","sortable","imageProps","progressProps","previewProps","tools","listType","beforeUploadClick","beforeItemEdit","beforePreview","locale"])}}}),K=Object.assign({name:"ImageUpload"},{__name:"index",props:{modelValue:String,fileLimit:{type:Number,default:100},readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:{type:Boolean,default:!0},accept:{type:String,default:"image/*"},itemStyle:Object,buttonStyle:Object,sortable:{type:[Boolean,Object],default:()=>({forceFallback:!0})},imageProps:Object,progressProps:Object,previewProps:Object,tools:{type:Boolean,default:!0},listType:String,beforeUploadClick:Function,beforeItemEdit:Function,locale:Object},emits:["update:modelValue","change"],setup(t,{expose:v,emit:g}){const c=t,m=g,u=C([]),b=r=>{var o;const i=(o=c.modelValue)!=null?o:"",e=r!=null?r:"";i!==e&&(m("update:modelValue",e),m("change",r))},P=()=>{u.value=[]},h=()=>!u.value.some(r=>r.status!=="done"),w=r=>{const i=[];return r.forEach(e=>{e.status==="done"&&e.url!=null&&i.push(e.url)}),i},S=(r,i)=>{if(!r)return i.filter(o=>o.status!=="done");const e=[];if(c.limit===1)return e.push({key:`0-${r}`,url:r,status:"done"}),e;try{const o=JSON.parse(r);if(i.forEach(l=>{(l.url&&o.includes(l.url)||l.status!=="done")&&e.push(l)}),o.forEach((l,s)=>{if(l&&!e.some(d=>d.url===l)){const d=`${s}-${l}`,f=e.findIndex(n=>n.key===d);f!==-1&&e.splice(f,1),e.push({key:d,url:l,status:"done"})}}),c.limit!=null&&e.length>c.limit){const l=e.filter(s=>s.status!=="done");for(const s of l){const d=e.indexOf(s);if(e.splice(d,1),e.length<=c.limit)break}}}catch(o){console.error(o),i.forEach(l=>{l.status!=="done"&&e.push(l)})}return e},a=(r,i)=>{if(r.length!==i.length)return!0;for(let e=0;e<r.length;e++){const o=r[e],l=i[e];if(o.key!==l.key||o.url!==l.url||o.status!==l.status)return!0}return!1};return j(u,r=>{const i=w(r);if(c.limit===1){b(i.join());return}b(i.length?JSON.stringify(i):"")},{deep:!0}),j(()=>c.modelValue,r=>{const i=S(r,u.value);a(i,u.value)&&(u.value=i)},{immediate:!0}),v({clearData:P,isDone:h}),(r,i)=>(U(),I(L,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=e=>u.value=e),fileLimit:t.fileLimit,readonly:t.readonly,disabled:t.disabled,preview:t.preview,limit:t.limit,multiple:t.multiple,drag:t.drag,accept:t.accept,itemStyle:t.itemStyle,buttonStyle:t.buttonStyle,sortable:t.sortable,imageProps:t.imageProps,progressProps:t.progressProps,previewProps:t.previewProps,tools:t.tools,listType:t.listType,beforeUploadClick:t.beforeUploadClick,beforeItemEdit:t.beforeItemEdit,locale:t.locale},null,8,["modelValue","fileLimit","readonly","disabled","preview","limit","multiple","drag","accept","itemStyle","buttonStyle","sortable","imageProps","progressProps","previewProps","tools","listType","beforeUploadClick","beforeItemEdit","locale"]))}}),Q=Object.assign({name:"FileUpload"},{__name:"index",props:{modelValue:String,fileLimit:{type:Number,default:100},readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:{type:Boolean,default:!0},accept:{type:String,default:""},itemStyle:Object,buttonStyle:Object,sortable:{type:[Boolean,Object],default:()=>({forceFallback:!0})},imageProps:Object,progressProps:Object,previewProps:Object,tools:{type:Boolean,default:!0},listType:{type:String,default:"file"},beforeUploadClick:Function,beforeItemEdit:Function,locale:Object},emits:["update:modelValue","change"],setup(t,{expose:v,emit:g}){const c=t,m=g,u=C([]),b=e=>{var s,d;const o=e?e.split("."):[],l=o.length<=1||o[0]===""&&o.length===2?"":(d=(s=o.pop())==null?void 0:s.toLowerCase)==null?void 0:d.call(s);return l&&["png","jpg","jpeg","gif","svg"].includes(l)},P=e=>{if(!b(e.url))return e.url?window.open(e.url):e.file&&!e.file.type.startsWith("image")&&window.open(URL.createObjectURL(e.file)),!1},h=e=>{var s;const o=(s=c.modelValue)!=null?s:"",l=e!=null?e:"";o!==l&&(m("update:modelValue",l),m("change",e))},w=()=>{u.value=[]},S=()=>!u.value.some(e=>e.status!=="done"),a=e=>{const o=[];return e.forEach(l=>{l.status==="done"&&l.url!=null&&o.push({url:l.url,name:l.name})}),o},r=(e,o)=>{var s,d;if(!e)return o.filter(f=>f.status!=="done");const l=[];if(c.limit===1){try{const n=JSON.parse(e);if(n){const p=(s=n.url)!=null?s:"";return l.push({key:`0-${p}`,url:p,name:(d=n.name)!=null?d:"",status:"done",thumbnail:b(p)}),l}}catch(n){console.error(n)}const f=o.find(n=>n.status!=="done");return f!=null&&l.push(f),l}try{const f=JSON.parse(e);if(o.forEach(n=>{(n.url&&f.some(p=>p.url===n.url)||n.status!=="done")&&l.push(n)}),f.forEach((n,p)=>{var V,B;const y=(V=n==null?void 0:n.url)!=null?V:"";if(y&&!l.some(k=>k.url===y)){const k=`${p}-${y}`,E=l.findIndex($=>$.key===k);E!==-1&&l.splice(E,1),l.push({key:k,url:y,name:(B=n.name)!=null?B:"",status:"done",thumbnail:b(y)})}}),c.limit!=null&&l.length>c.limit){const n=l.filter(p=>p.status!=="done");for(const p of n){const y=l.indexOf(p);if(l.splice(y,1),l.length<=c.limit)break}}}catch(f){console.error(f),o.forEach(n=>{n.status!=="done"&&l.push(n)})}return l},i=(e,o)=>{if(e.length!==o.length)return!0;for(let l=0;l<e.length;l++){const s=e[l],d=o[l];if(s.key!==d.key||s.name!==d.name||s.url!==d.url||s.status!==d.status)return!0}return!1};return j(u,e=>{const o=a(e);if(c.limit===1){h(o.length?JSON.stringify(o[0]):"");return}h(o.length?JSON.stringify(o):"")},{deep:!0}),j(()=>c.modelValue,e=>{const o=r(e,u.value);i(o,u.value)&&(u.value=o)},{immediate:!0}),v({clearData:w,isDone:S}),(e,o)=>(U(),I(L,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=l=>u.value=l),fileLimit:t.fileLimit,readonly:t.readonly,disabled:t.disabled,preview:t.preview,limit:t.limit,multiple:t.multiple,drag:t.drag,accept:t.accept,itemStyle:t.itemStyle,buttonStyle:t.buttonStyle,sortable:t.sortable,imageProps:t.imageProps,progressProps:t.progressProps,previewProps:t.previewProps,tools:t.tools,listType:t.listType,beforeUploadClick:t.beforeUploadClick,beforeItemEdit:t.beforeItemEdit,beforePreview:P,locale:t.locale},null,8,["modelValue","fileLimit","readonly","disabled","preview","limit","multiple","drag","accept","itemStyle","buttonStyle","sortable","imageProps","progressProps","previewProps","tools","listType","beforeUploadClick","beforeItemEdit","locale"]))}});export{K as _,Q as a};
