import{a2 as he,c5 as K,cC as ke,cD as fe,a4 as be,L as Z,bc as ye,fj as xe,fk as Re,cs as _e,a0 as Ce,fl as Te,r as k,fm as Ve,N as Ae,I as p,R as me,U as Ie,T as Se,c as le,o as w,w as g,b as i,cc as Le,d as b,a7 as ve,a6 as v,u as a,fn as $e,a5 as C,n as E,a1 as q,aH as Me,E as R,cJ as Be,F as re,de as Pe,df as De,fo as Ye,fc as Fe,a8 as Xe,fp as He,fq as je,p as Ke,c9 as qe,ca as Ze,fr as Ue,c8 as $,fs as We,ce as A,a9 as ze,cU as Ge,ft as Je,cS as Qe,cf as j,cM as ea,t as aa,bU as pe,ci as ta,cg as sa,fu as na,fv as oa,fw as la,e7 as ra,Z as ia,eA as ca}from"./index-C4Wz-E93.js";import{t as de}from"./throttle-DJjmKuHL.js";const Ee=he({urlList:{type:K(Array),default:()=>ke([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:K(String)}}),ua={close:()=>!0,switch:c=>fe(c),rotate:c=>fe(c)},da=Z({name:"ElImageViewer"}),fa=Z({...da,props:Ee,emits:ua,setup(c,{expose:N,emit:f}){var T;const n=c,m={CONTAIN:{name:"contain",icon:ye(Re)},ORIGINAL:{name:"original",icon:ye(xe)}},{t:M}=_e(),s=Ce("image-viewer"),{nextZIndex:B}=Te(),O=k(),o=k([]),I=Ve(),S=k(!0),y=k(n.initialIndex),h=Ae(m.CONTAIN),r=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),P=k((T=n.zIndex)!=null?T:B()),D=p(()=>{const{urlList:t}=n;return t.length<=1}),U=p(()=>y.value===0),W=p(()=>y.value===n.urlList.length-1),Y=p(()=>n.urlList[y.value]),ie=p(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!n.infinite&&U.value)]),G=p(()=>[s.e("btn"),s.e("next"),s.is("disabled",!n.infinite&&W.value)]),F=p(()=>{const{scale:t,deg:d,offsetX:l,offsetY:_,enableTransition:L}=r.value;let z=l/t,x=_/t;const H=d*Math.PI/180,ge=Math.cos(H),we=Math.sin(H);z=z*ge+x*we,x=x*ge-l/t*we;const ue={transform:`scale(${t}) rotate(${d}deg) translate(${z}px, ${x}px)`,transition:L?"transform .3s":""};return h.value.name===m.CONTAIN.name&&(ue.maxWidth=ue.maxHeight="100%"),ue});function V(){J(),f("close")}function ce(){const t=de(l=>{switch(l.code){case A.esc:n.closeOnPressEscape&&V();break;case A.space:se();break;case A.left:ne();break;case A.up:u("zoomIn");break;case A.right:e();break;case A.down:u("zoomOut");break}}),d=de(l=>{const _=l.deltaY||l.deltaX;u(_<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});I.run(()=>{$(document,"keydown",t),$(document,"wheel",d)})}function J(){I.stop()}function Q(){S.value=!1}function ee(t){S.value=!1,t.target.alt=M("el.image.error")}function ae(t){if(S.value||t.button!==0||!O.value)return;r.value.enableTransition=!1;const{offsetX:d,offsetY:l}=r.value,_=t.pageX,L=t.pageY,z=de(H=>{r.value={...r.value,offsetX:d+H.pageX-_,offsetY:l+H.pageY-L}}),x=$(document,"mousemove",z);$(document,"mouseup",()=>{x()}),t.preventDefault()}function te(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function se(){if(S.value)return;const t=We(m),d=Object.values(m),l=h.value.name,L=(d.findIndex(z=>z.name===l)+1)%t.length;h.value=m[t[L]],te()}function X(t){const d=n.urlList.length;y.value=(t+d)%d}function ne(){U.value&&!n.infinite||X(y.value-1)}function e(){W.value&&!n.infinite||X(y.value+1)}function u(t,d={}){if(S.value)return;const{minScale:l,maxScale:_}=n,{zoomRate:L,rotateDeg:z,enableTransition:x}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...d};switch(t){case"zoomOut":r.value.scale>l&&(r.value.scale=Number.parseFloat((r.value.scale/L).toFixed(3)));break;case"zoomIn":r.value.scale<_&&(r.value.scale=Number.parseFloat((r.value.scale*L).toFixed(3)));break;case"clockwise":r.value.deg+=z,f("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=z,f("rotate",r.value.deg);break}r.value.enableTransition=x}function oe(t){var d;((d=t.detail)==null?void 0:d.focusReason)==="pointer"&&t.preventDefault()}function Oe(){n.closeOnPressEscape&&V()}return me(Y,()=>{Ie(()=>{const t=o.value[0];t!=null&&t.complete||(S.value=!0)})}),me(y,t=>{te(),f("switch",t)}),Se(()=>{ce()}),N({setActiveItem:X}),(t,d)=>(w(),le(a(Ue),{to:"body",disabled:!t.teleported},{default:g(()=>[i(Le,{name:"viewer-fade",appear:""},{default:g(()=>[b("div",{ref_key:"wrapper",ref:O,tabindex:-1,class:v(a(s).e("wrapper")),style:ve({zIndex:P.value})},[i(a($e),{loop:"",trapped:"","focus-trap-el":O.value,"focus-start-el":"container",onFocusoutPrevented:oe,onReleaseRequested:Oe},{default:g(()=>[b("div",{class:v(a(s).e("mask")),onClick:Me(l=>t.hideOnClickModal&&V(),["self"])},null,10,["onClick"]),C(" CLOSE "),b("span",{class:v([a(s).e("btn"),a(s).e("close")]),onClick:V},[i(a(R),null,{default:g(()=>[i(a(Be))]),_:1})],2),C(" ARROW "),a(D)?C("v-if",!0):(w(),E(re,{key:0},[b("span",{class:v(a(ie)),onClick:ne},[i(a(R),null,{default:g(()=>[i(a(Pe))]),_:1})],2),b("span",{class:v(a(G)),onClick:e},[i(a(R),null,{default:g(()=>[i(a(De))]),_:1})],2)],64)),C(" ACTIONS "),b("div",{class:v([a(s).e("btn"),a(s).e("actions")])},[b("div",{class:v(a(s).e("actions__inner"))},[i(a(R),{onClick:l=>u("zoomOut")},{default:g(()=>[i(a(Ye))]),_:1},8,["onClick"]),i(a(R),{onClick:l=>u("zoomIn")},{default:g(()=>[i(a(Fe))]),_:1},8,["onClick"]),b("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(R),{onClick:se},{default:g(()=>[(w(),le(Xe(a(h).icon)))]),_:1}),b("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(R),{onClick:l=>u("anticlockwise")},{default:g(()=>[i(a(He))]),_:1},8,["onClick"]),i(a(R),{onClick:l=>u("clockwise")},{default:g(()=>[i(a(je))]),_:1},8,["onClick"])],2)],2),C(" CANVAS "),b("div",{class:v(a(s).e("canvas"))},[(w(!0),E(re,null,Ke(t.urlList,(l,_)=>qe((w(),E("img",{ref_for:!0,ref:L=>o.value[_]=L,key:l,src:l,style:ve(a(F)),class:v(a(s).e("img")),crossorigin:t.crossorigin,onLoad:Q,onError:ee,onMousedown:ae},null,46,["src","crossorigin"])),[[Ze,_===y.value]])),128))],2),q(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ma=be(fa,[["__file","image-viewer.vue"]]);const Ne=ze(ma),va=he({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:K([String,Object])},previewSrcList:{type:K(Array),default:()=>ke([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:K(String)}}),pa={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>fe(c),close:()=>!0,show:()=>!0},ga=Z({name:"ElImage",inheritAttrs:!1}),wa=Z({...ga,props:va,emits:pa,setup(c,{emit:N}){const f=c;let T="";const{t:n}=_e(),m=Ce("image"),M=Ge(),s=p(()=>Je(Object.entries(M).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),B=Qe({excludeListeners:!0,excludeKeys:p(()=>Object.keys(s.value))}),O=k(),o=k(!1),I=k(!0),S=k(!1),y=k(),h=k(),r=j&&"loading"in HTMLImageElement.prototype;let P,D;const U=p(()=>[m.e("inner"),Y.value&&m.e("preview"),I.value&&m.is("loading")]),W=p(()=>{const{fit:e}=f;return j&&e?{objectFit:e}:{}}),Y=p(()=>{const{previewSrcList:e}=f;return ea(e)&&e.length>0}),ie=p(()=>{const{previewSrcList:e,initialIndex:u}=f;let oe=u;return u>e.length-1&&(oe=0),oe}),G=p(()=>f.loading==="eager"?!1:!r&&f.loading==="lazy"||f.lazy),F=()=>{j&&(I.value=!0,o.value=!1,O.value=f.src)};function V(e){I.value=!1,o.value=!1,N("load",e)}function ce(e){I.value=!1,o.value=!0,N("error",e)}function J(){la(y.value,h.value)&&(F(),ae())}const Q=oa(J,200,!0);async function ee(){var e;if(!j)return;await Ie();const{scrollContainer:u}=f;ta(u)?h.value=u:sa(u)&&u!==""?h.value=(e=document.querySelector(u))!=null?e:void 0:y.value&&(h.value=na(y.value)),h.value&&(P=$(h,"scroll",Q),setTimeout(()=>J(),100))}function ae(){!j||!h.value||!Q||(P==null||P(),h.value=void 0)}function te(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function se(){Y.value&&(D=$("wheel",te,{passive:!1}),T=document.body.style.overflow,document.body.style.overflow="hidden",S.value=!0,N("show"))}function X(){D==null||D(),document.body.style.overflow=T,S.value=!1,N("close")}function ne(e){N("switch",e)}return me(()=>f.src,()=>{G.value?(I.value=!0,o.value=!1,ae(),ee()):F()}),Se(()=>{G.value?ee():F()}),(e,u)=>(w(),E("div",pe({ref_key:"container",ref:y},a(s),{class:[a(m).b(),e.$attrs.class]}),[o.value?q(e.$slots,"error",{key:0},()=>[b("div",{class:v(a(m).e("error"))},aa(a(n)("el.image.error")),3)]):(w(),E(re,{key:1},[O.value!==void 0?(w(),E("img",pe({key:0},a(B),{src:O.value,loading:e.loading,style:a(W),class:a(U),crossorigin:e.crossorigin,onClick:se,onLoad:V,onError:ce}),null,16,["src","loading","crossorigin"])):C("v-if",!0),I.value?(w(),E("div",{key:1,class:v(a(m).e("wrapper"))},[q(e.$slots,"placeholder",{},()=>[b("div",{class:v(a(m).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),a(Y)?(w(),E(re,{key:2},[S.value?(w(),le(a(Ne),{key:0,"z-index":e.zIndex,"initial-index":a(ie),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:X,onSwitch:ne},{default:g(()=>[e.$slots.viewer?(w(),E("div",{key:0},[q(e.$slots,"viewer")])):C("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var ya=be(wa,[["__file","image.vue"]]);const Ca=ze(ya),ha={...Ee,teleported:{type:Boolean,default:!0},modelValue:Boolean,customClass:String,customStyle:Object,transitionName:{type:String,default:"ele-image-viewer-fade"},keepAlive:Boolean},ka={"update:modelValue":c=>!0,close:()=>!0,switch:c=>!0,rotate:c=>!0},Ia=Z({name:"EleImageViewer",__name:"index",props:ha,emits:ka,setup(c,{expose:N,emit:f}){const T=c,n=f,m=k(null),M=p(()=>{const o=ra(T,["modelValue","customClass","customStyle","transitionName","keepAlive"]);return o.teleported=!1,o}),s=()=>{n("update:modelValue",!1),n("close")},B=o=>{n("switch",o)},O=o=>{n("rotate",o)};return ia(()=>{s()}),N({imageViewerRef:m}),(o,I)=>(w(),le(ca,{to:"body",disabled:!o.teleported},[i(Le,{name:o.transitionName,appear:!0},{default:g(()=>[o.modelValue?(w(),E("div",{key:0,class:v(["ele-image-viewer",o.customClass]),style:ve(o.customStyle)},[i(a(Ne),pe(M.value,{ref_key:"imageViewerRef",ref:m,onClose:s,onSwitch:B,onRotate:O}),{default:g(()=>[q(o.$slots,"default")]),_:3},16)],6)):C("",!0)]),_:3},8,["name"])],8,["disabled"]))}});export{Ca as E,Ia as _};
