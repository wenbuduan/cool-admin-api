import{_ as ve}from"./index-D9JJOZeW.js";import{aF as te,c as B,o as M,w as a,b as e,aJ as ae,aK as Q,u as i,aL as oe,aC as W,h as E,aH as le,aI as be,aG as ne,b3 as X,b4 as xe,r as u,a as re,a5 as se,aB as ye,m as w,U as K,R as ie,n as Y,k as he,d as j,E as de,bf as we,a$ as Ve,F as Z,p as ze,l as ke,t as ue,aM as G,au as H,av as me,aE as J,bQ as Ie,b7 as Ce,at as ee,f7 as $e,f2 as Ue,bb as Ee,ef as De,bc as A}from"./index-C4Wz-E93.js";import{_ as Re}from"./index-B7CPKknw.js";import{_ as Me}from"./index-CgNGxHIq.js";import{_ as Ne}from"./index-BpeYX26o.js";import{E as Fe}from"./tree-D50DgR80.js";import{_ as Te}from"./index-C4uegQIc.js";import"./index-BWRTmGSC.js";import"./index-1MN7neRp.js";import"./virtual-list-CKtLkxHg.js";import"./index-CwnermTv.js";import"./index-BUwq14Gk.js";import{E as Se}from"./link-sE-uksY2.js";import{a as pe,E as ce}from"./col-wGeLV9c2.js";import{_ as Be}from"./role-select-hll_ccAC.js";import{_ as Oe}from"./organization-select-DyZkA2vI.js";import{c as Ke,u as qe,a as Le,b as je,r as We,l as Pe,p as Ae,d as Ge}from"./index-CnOLMqNk.js";import{p as He,e as Je}from"./validate-B_6HX0Io.js";import{_ as Qe}from"./organization-edit-DtNPqlVK.js";import{l as Xe,r as Ye}from"./index-CiU_EHeO.js";import"./isArrayLikeObject-B8QFGS9H.js";import"./vuedraggable.umd-svCSXnzP.js";import"./index-cGN0WSKX.js";import"./tree-select-C26EqoA0.js";import"./input-number-tZCTFD7x.js";import"./index-BgwkhR57.js";const Ze={__name:"user-search",emits:["search"],setup(N,{expose:F,emit:C}){const D=C,[_,g]=te({username:"",nickname:"",sex:void 0}),m=()=>{D("search",{..._})},V=()=>{g(),m()};return F({resetFields:g}),(d,p)=>{const R=Q,z=ae,$=ce,U=oe,k=W,f=pe,o=ne;return M(),B(o,{"label-width":"72px",onKeyup:be(m,["enter"]),onSubmit:p[3]||(p[3]=le(()=>{},["prevent"]))},{default:a(()=>[e(f,{gutter:8},{default:a(()=>[e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{label:"用户账号"},{default:a(()=>[e(R,{clearable:"",modelValue:i(_).username,"onUpdate:modelValue":p[0]||(p[0]=s=>i(_).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{label:"用户名"},{default:a(()=>[e(R,{clearable:"",modelValue:i(_).nickname,"onUpdate:modelValue":p[1]||(p[1]=s=>i(_).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{label:"性别"},{default:a(()=>[e(U,{code:"sex",modelValue:i(_).sex,"onUpdate:modelValue":p[2]||(p[2]=s=>i(_).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{"label-width":"16px"},{default:a(()=>[e(k,{type:"primary",onClick:m},{default:a(()=>p[4]||(p[4]=[E("查询")])),_:1}),e(k,{onClick:V},{default:a(()=>p[5]||(p[5]=[E("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},et={__name:"user-edit",props:X({data:Object,organizationId:Number,organizationData:Array},{modelValue:{type:Boolean},modelModifiers:{}}),emits:X(["done"],["update:modelValue"]),setup(N,{emit:F}){const C=N,D=F,_=xe(N,"modelValue"),g=u(!1),m=u(!1),V=u(null),[d,p,R]=te({userId:void 0,organizationId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),z=re({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(f,o,s)=>{var x;Ke("username",o,(x=C.data)==null?void 0:x.userId).then(()=>{s(new Error("账号已经存在"))}).catch(()=>{s()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"change"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"change"}],email:[{pattern:Je,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(f,o,s)=>{if(g.value||/^[\S]{5,18}$/.test(o))return s();s(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:He,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),$=()=>{_.value=!1},U=()=>{var f,o;(o=(f=V.value)==null?void 0:f.validate)==null||o.call(f,s=>{if(!s)return;m.value=!0,(g.value?qe:Le)(d).then(I=>{m.value=!1,w.success(I),$(),D("done")}).catch(I=>{m.value=!1,w.error(I.message)})})},k=()=>{C.data?(R({...C.data,password:""}),g.value=!0):(p(),d.organizationId=C.organizationId,g.value=!1),K(()=>{K(()=>{var f,o;(o=(f=V.value)==null?void 0:f.clearValidate)==null||o.call(f)})})};return(f,o)=>{const s=ae,x=Q,I=oe,O=ce,r=pe,l=ne,c=W,v=ye;return M(),B(v,{form:"",width:640,modelValue:_.value,"onUpdate:modelValue":o[10]||(o[10]=t=>_.value=t),title:g.value?"修改用户":"新建用户",onOpen:k},{footer:a(()=>[e(c,{onClick:$},{default:a(()=>o[11]||(o[11]=[E("取消")])),_:1}),e(c,{type:"primary",loading:m.value,onClick:U},{default:a(()=>o[12]||(o[12]=[E(" 保存 ")])),_:1},8,["loading"])]),default:a(()=>[e(l,{ref_key:"formRef",ref:V,model:i(d),rules:z,"label-width":"80px",onSubmit:o[9]||(o[9]=le(()=>{},["prevent"]))},{default:a(()=>[e(r,{gutter:16},{default:a(()=>[e(O,{sm:12,xs:24},{default:a(()=>[e(s,{label:"所属机构"},{default:a(()=>[e(Oe,{modelValue:i(d).organizationId,"onUpdate:modelValue":o[0]||(o[0]=t=>i(d).organizationId=t),"organization-data":N.organizationData},null,8,["modelValue","organization-data"])]),_:1}),e(s,{label:"用户账号",prop:"username"},{default:a(()=>[e(x,{clearable:"",maxlength:20,modelValue:i(d).username,"onUpdate:modelValue":o[1]||(o[1]=t=>i(d).username=t),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),e(s,{label:"用户名",prop:"nickname"},{default:a(()=>[e(x,{clearable:"",maxlength:20,modelValue:i(d).nickname,"onUpdate:modelValue":o[2]||(o[2]=t=>i(d).nickname=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(s,{label:"性别",prop:"sex"},{default:a(()=>[e(I,{code:"sex",modelValue:i(d).sex,"onUpdate:modelValue":o[3]||(o[3]=t=>i(d).sex=t),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),e(s,{label:"角色",prop:"roles"},{default:a(()=>[e(Be,{modelValue:i(d).roles,"onUpdate:modelValue":o[4]||(o[4]=t=>i(d).roles=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{sm:12,xs:24},{default:a(()=>[e(s,{label:"手机号",prop:"phone"},{default:a(()=>[e(x,{clearable:"",maxlength:11,modelValue:i(d).phone,"onUpdate:modelValue":o[5]||(o[5]=t=>i(d).phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(s,{label:"邮箱",prop:"email"},{default:a(()=>[e(x,{clearable:"",maxlength:100,modelValue:i(d).email,"onUpdate:modelValue":o[6]||(o[6]=t=>i(d).email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),g.value?se("",!0):(M(),B(s,{key:0,label:"登录密码",prop:"password"},{default:a(()=>[e(x,{"show-password":"",type:"password",maxlength:20,modelValue:i(d).password,"onUpdate:modelValue":o[7]||(o[7]=t=>i(d).password=t),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),e(s,{label:"个人简介"},{default:a(()=>[e(x,{type:"textarea",rows:3,maxlength:200,modelValue:i(d).introduction,"onUpdate:modelValue":o[8]||(o[8]=t=>i(d).introduction=t),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},tt={__name:"user-list",props:{organizationId:Number,organizationData:Array},setup(N){const F=N,C=u(null),D=u(null),_=u([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"sexName",label:"性别",sortable:"custom",width:90,align:"center"},{columnKey:"roles",label:"角色",minWidth:120,slot:"roles",align:"center",formatter:r=>r.roles.map(l=>l.roleName).join(",")},{prop:"createTime",label:"创建时间",sortable:"custom",width:180,align:"center"},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status",formatter:r=>r.status==0?"正常":"冻结"},{columnKey:"action",label:"操作",width:128,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),g=u([]),m=u(null),V=u(!1),d=({pages:r,where:l,orders:c})=>Ae({...l,...c,...r,organizationId:F.organizationId}),p=r=>{var l,c;(c=(l=D.value)==null?void 0:l.reload)==null||c.call(l,{page:1,where:r})},R=r=>{m.value=r!=null?r:null,V.value=!0},z=r=>{const l=r==null?g.value:[r];if(!l.length){w.error("请至少选择一条数据");return}J.confirm("确定要删除“"+l.map(c=>c.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const c=w.loading({message:"请求中..",plain:!0});We(l.map(v=>v.userId)).then(v=>{c.close(),w.success(v),p()}).catch(v=>{c.close(),w.error(v.message)})}).catch(()=>{})},$=(r,l)=>{const c=r?0:1;je(l.userId,c).then(v=>{l.status=c,w.success(v)}).catch(v=>{w.error(v.message)})};ie(()=>F.organizationId,()=>{var r,l;(l=(r=C.value)==null?void 0:r.resetFields)==null||l.call(r),p({})});const U=({where:r,orders:l})=>Pe({...r,...l,organizationId:F.organizationId}),k=u(null),f=u([]),o=u();let s=null;const x=r=>[{title:"重置密码",command:"password"},{title:"删除用户",command:"delete",divided:!0,danger:!0}],I=(r,l)=>{r==null||o.value===r||s!=null&&s===l||(k.value&&k.value.handleClose(),K(()=>{s=l,f.value=x()||[],o.value=r,f.value.length&&K(()=>{k.value&&k.value.handleOpen()})}))},O=r=>{if(s==null)return;const l=s;r==="delete"?z(l):r==="password"&&J.prompt(`请输入用户"${l.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:c})=>{const v=w.loading({message:"请求中..",plain:!0});Ge(l.userId,c).then(t=>{v.close(),w.success(t)}).catch(t=>{v.close(),w.error(t.message)})}).catch(()=>{})};return(r,l)=>{const c=W,v=ke,t=Ve,n=Se,y=he,b=de,q=Te,P=me;return M(),Y(Z,null,[e(Ze,{ref_key:"searchRef",ref:C,style:{"margin-bottom":"-14px"},onSearch:p},null,512),e(q,{ref_key:"tableRef",ref:D,"row-key":"userId",columns:_.value,datasource:d,"show-overflow-tooltip":!0,selections:g.value,"onUpdate:selections":l[2]||(l[2]=h=>g.value=h),"highlight-current-row":!0,"export-config":{fileName:"用户数据",datasource:U},"print-config":{datasource:U},style:{paddingBottom:"16px"},"cache-key":"listUserTable"},{toolbar:a(()=>[e(c,{type:"primary",class:"ele-btn-icon",icon:i(G),onClick:l[0]||(l[0]=h=>R())},{default:a(()=>l[4]||(l[4]=[E(" 新建 ")])),_:1},8,["icon"]),e(c,{type:"danger",class:"ele-btn-icon",icon:i(H),onClick:l[1]||(l[1]=h=>z())},{default:a(()=>l[5]||(l[5]=[E(" 删除 ")])),_:1},8,["icon"])]),roles:a(({row:h})=>[(M(!0),Y(Z,null,ze(h.roles,T=>(M(),B(v,{key:T.roleId,size:"small","disable-transitions":!0},{default:a(()=>[E(ue(T.roleName),1)]),_:2},1024))),128))]),status:a(({row:h})=>[e(t,{size:"small","model-value":h.status===0,onChange:T=>$(T,h)},null,8,["model-value","onChange"])]),action:a(({row:h})=>[e(n,{type:"primary",underline:!1,onClick:T=>R(h)},{default:a(()=>l[6]||(l[6]=[E(" 修改 ")])),_:2},1032,["onClick"]),e(y,{direction:"vertical"}),e(n,{type:"primary",underline:!1,onMouseenter:T=>I(T.currentTarget,h)},{default:a(()=>[l[7]||(l[7]=j("span",null,"更多",-1)),e(b,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:a(()=>[e(i(we))]),_:1})]),_:2},1032,["onMouseenter"])]),_:1},8,["columns","selections","export-config","print-config"]),e(et,{data:m.value,modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=h=>V.value=h),"organization-id":N.organizationId,"organization-data":N.organizationData,onDone:p},null,8,["data","modelValue","organization-id","organization-data"]),e(P,{ref_key:"moreDropdownRef",ref:k,trigger:"hover",triggerKeys:[],persistent:!1,componentType:"pro",virtualTriggering:!0,virtualRef:o.value,disabled:!f.value.length,items:f.value,onCommand:O},null,8,["virtualRef","disabled","items"])],64)}}},at={style:{padding:"0 16px 12px 0"}},ot={style:{"margin-bottom":"12px"}},lt={class:"el-tree-node__label",style:{"margin-top":"2px"}},Dt=Object.assign({name:"ListUser"},{__name:"index",setup(N){const{mobile:F}=Ie(),C=u(null),D=u(null),_=u(!0),g=u([]),m=u(null),V=u(""),d=u(!1),p=u(null),R=u(),z=()=>{_.value=!0,Xe().then(t=>{_.value=!1,g.value=Ee({data:t,idField:"organizationId",parentIdField:"parentId"}),K(()=>{$(g.value[0])})}).catch(t=>{_.value=!1,w.error(t.message)})},$=t=>{var n,y,b,q;m.value!=null&&F.value&&((y=(n=C.value)==null?void 0:n.toggleCollapse)==null||y.call(n,!0)),t&&t.organizationId?(m.value=t,(q=(b=D.value)==null?void 0:b.setCurrentKey)==null||q.call(b,t.organizationId)):m.value=null},U=(t,n)=>{p.value=t!=null?t:null,R.value=n,d.value=!0},k=t=>{const n=t;n&&J.confirm(`确定要删除“${n.organizationName}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const y=w.loading({message:"请求中..",plain:!0});Ye(n.organizationId).then(b=>{y.close(),w.success(b),z()}).catch(b=>{y.close(),w.error(b.message)})}).catch(()=>{})},f=(t,n)=>t?!!(n.organizationName&&n.organizationName.includes(t)):!0;ie(V,t=>{var n,y;(y=(n=D.value)==null?void 0:n.filter)==null||y.call(n,t)}),z();const o=u(null),s=u([]),x=u();let I=null;const O=re({marginLeft:"0px"}),r=t=>[{title:"添加下级",command:"add",icon:A(G)},{title:"修改机构",command:"edit",icon:A(ee)},{title:"删除机构",command:"del",icon:A(H),divided:!0,danger:!0}],l=(t,n)=>{o.value&&o.value.handleClose(),K(()=>{I=n,s.value=r()||[],x.value=t,s.value.length&&K(()=>{o.value&&o.value.handleOpen()})})},c=t=>{I!=null&&(t==="add"?U(void 0,I.organizationId):t==="edit"?U(I):t==="del"&&k(I))},v=(t,n)=>{const y=De(t.currentTarget,"el-tree-node__content"),b=y.getBoundingClientRect();O.marginLeft=`${t.clientX-b.left-b.width/2}px`,l(y,n)};return(t,n)=>{const y=Q,b=W,q=de,P=Fe,h=Ne,T=Me,fe=Re,ge=me,_e=ve;return M(),B(_e,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:a(()=>[e(fe,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:a(()=>[e(T,{ref_key:"splitRef",ref:C,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:a(()=>[m.value?(M(),B(tt,{key:0,"organization-id":m.value.organizationId,"organization-data":g.value},null,8,["organization-id","organization-data"])):se("",!0)]),default:a(()=>[j("div",at,[e(y,{clearable:"",maxlength:20,modelValue:V.value,"onUpdate:modelValue":n[0]||(n[0]=S=>V.value=S),placeholder:"左侧树还支持鼠标右键","prefix-icon":i(Ce)},null,8,["modelValue","prefix-icon"])]),j("div",ot,[e(b,{type:"primary",class:"ele-btn-icon",icon:i(G),onClick:n[1]||(n[1]=S=>{var L;return U(void 0,(L=m.value)==null?void 0:L.organizationId)})},{default:a(()=>n[5]||(n[5]=[E(" 新建 ")])),_:1},8,["icon"]),e(b,{type:"warning",disabled:!m.value,class:"ele-btn-icon",icon:i(ee),onClick:n[2]||(n[2]=S=>U(m.value))},{default:a(()=>n[6]||(n[6]=[E(" 修改 ")])),_:1},8,["disabled","icon"]),e(b,{type:"danger",disabled:!m.value,class:"ele-btn-icon",icon:i(H),onClick:n[3]||(n[3]=S=>k(m.value))},{default:a(()=>n[7]||(n[7]=[E(" 删除 ")])),_:1},8,["disabled","icon"])]),e(h,{loading:_.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:a(()=>[e(P,{ref_key:"treeRef",ref:D,data:g.value,"highlight-current":"","node-key":"organizationId",props:{label:"organizationName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":f,style:{"--ele-tree-item-height":"34px"},onNodeClick:$,onNodeContextmenu:v},{default:a(S=>[e(q,{style:{"margin-right":"6px",color:"#ffd659","font-size":"16px"}},{default:a(()=>{var L;return[(L=S.data.children)!=null&&L.length?(M(),B(i($e),{key:0,style:{fill:"currentColor"}})):(M(),B(i(Ue),{key:1,style:{transform:"scale(0.9) translateY(1px)",color:"#faad14"}}))]}),_:2},1024),j("span",lt,ue(S.data.organizationName),1)]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1}),e(Qe,{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=S=>d.value=S),data:p.value,"organization-id":R.value,"organization-data":g.value,onDone:z},null,8,["modelValue","data","organization-id","organization-data"]),e(ge,{ref_key:"ctxMenuDropdownRef",ref:o,trigger:"contextmenu","trigger-keys":[],"icon-props":{size:15},"popper-options":{strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,-4]}}]},persistent:!1,"component-type":"pro","prevent-contextmenu":!0,"virtual-triggering":!0,"virtual-ref":x.value,disabled:!s.value.length,items:s.value,"popper-style":O,onCommand:c},null,8,["virtual-ref","disabled","items","popper-style"])]),_:1})}}});export{Dt as default};
