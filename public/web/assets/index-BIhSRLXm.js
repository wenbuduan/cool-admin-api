import{_ as O}from"./index-MJsbY79C.js";import{b1 as z,r as M,c as b,o as p,w as e,b as t,aI as N,aJ as P,dc as q,aK as K,aM as U,u as V,aD as B,h as f,_ as Y,a$ as j,b0 as F,a as H,bO as J,a5 as R,d as g,t as u,n as L,l as I,q as Z,aC as A,s as S,ay as G,ba as Q,m as $,aZ as X,a_ as ee}from"./index-n6Orl0xG.js";import{_ as W}from"./index-DLejwlYb.js";import{_ as te}from"./index-BBd_ea8k.js";import"./index-xWcpkv5n.js";import"./index-DJBR385J.js";import"./index-DBPDFNRg.js";import"./virtual-list-Dy04eCLP.js";import"./index-C5FeiaYW.js";import"./index-Z0s6jAnH.js";import{a as ae,E as le}from"./col-CI8qhQxM.js";import{E as oe}from"./date-picker-D93ZoyC0.js";import{E as se,a as ne}from"./descriptions-item-CIa-C3V8.js";import"./isArrayLikeObject-CVZfMnll.js";import"./vuedraggable.umd-oUa5xh2t.js";import"./arrays-BjUxbwJc.js";import"./index-tsWABA3i.js";const re={__name:"operation-record-search",emits:["search"],setup(o,{emit:r}){const h=r,[_,k]=z({username:"",module:""}),d=M(["",""]),n=()=>{const[y,a]=d.value||[];h("search",{..._,createTimeStart:y,createTimeEnd:a})},v=()=>{k(),d.value=["",""],n()};return(y,a)=>{const l=U,i=K,c=le,T=oe,w=B,x=ae,E=N,m=W;return p(),b(m,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(E,{"label-width":"72px",onKeyup:q(n,["enter"]),onSubmit:a[3]||(a[3]=P(()=>{},["prevent"]))},{default:e(()=>[t(x,{gutter:8},{default:e(()=>[t(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{label:"用户账号"},{default:e(()=>[t(l,{clearable:"",modelValue:V(_).username,"onUpdate:modelValue":a[0]||(a[0]=s=>V(_).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{label:"操作模块"},{default:e(()=>[t(l,{clearable:"",modelValue:V(_).module,"onUpdate:modelValue":a[1]||(a[1]=s=>V(_).module=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{label:"操作时间"},{default:e(()=>[t(T,{"unlink-panels":"",type:"datetimerange",modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=s=>d.value=s),"range-separator":"-","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{"label-width":"16px"},{default:e(()=>[t(w,{type:"primary",onClick:n},{default:e(()=>a[4]||(a[4]=[f("查询")])),_:1}),t(w,{onClick:v},{default:e(()=>a[5]||(a[5]=[f("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},ie={key:0},de={style:{"word-break":"break-all"}},me={style:{"word-break":"break-all"}},ue={__name:"operation-record-detail",props:j({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const r=F(o,"modelValue"),h=H({popperStyle:{width:"580px",maxWidth:"90%",wordBreak:"break-all"},bodyStyle:{maxWidth:"calc(100vw - 32px)",maxHeight:"252px",overflowY:"auto","--ele-scrollbar-color":"#5e5e5e","--ele-scrollbar-hover-color":"#707070","--ele-scrollbar-size":"8px"},offset:4,placement:"top"}),{mobile:_}=J();return(k,d)=>{const n=ne,v=I,y=Z,a=se,l=A;return p(),b(l,{title:"详情",width:720,modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=i=>r.value=i)},{default:e(()=>[o.data?(p(),b(a,{key:0,border:!0,column:V(_)?1:2,class:"detail-table"},{default:e(()=>[t(n,{label:"操作人"},{default:e(()=>[g("div",null,u(o.data.nickname)+"("+u(o.data.username)+")",1)]),_:1}),t(n,{label:"IP地址"},{default:e(()=>[g("div",null,u(o.data.ip),1)]),_:1}),t(n,{label:"操作模块"},{default:e(()=>[g("div",null,u(o.data.module),1)]),_:1}),t(n,{label:"操作功能"},{default:e(()=>[g("div",null,u(o.data.description),1)]),_:1}),t(n,{label:"操作时间"},{default:e(()=>[g("div",null,u(o.data.createTime),1)]),_:1}),t(n,{label:"请求耗时"},{default:e(()=>[isNaN(o.data.spendTime)?R("",!0):(p(),L("div",ie,u(o.data.spendTime/1e3)+"s",1))]),_:1}),t(n,{label:"请求方式"},{default:e(()=>[g("div",null,u(o.data.requestMethod),1)]),_:1}),t(n,{label:"请求状态"},{default:e(()=>[o.data.status===0?(p(),b(v,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>d[1]||(d[1]=[f(" 正常 ")])),_:1})):o.data.status===1?(p(),b(v,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>d[2]||(d[2]=[f(" 异常 ")])),_:1})):R("",!0)]),_:1}),t(n,{label:"请求地址",span:2},{default:e(()=>[g("div",de,u(o.data.url),1)]),_:1}),t(n,{label:"调用方法",span:2},{default:e(()=>[g("div",me,u(o.data.method),1)]),_:1}),t(n,{label:"请求参数",span:2},{default:e(()=>[t(y,{"max-line":4,tooltip:h},{default:e(()=>[f(u(o.data.params),1)]),_:1},8,["tooltip"])]),_:1}),o.data.status===0?(p(),b(n,{key:0,label:"返回结果",span:2},{default:e(()=>[t(y,{"max-line":4,tooltip:h},{default:e(()=>[f(u(o.data.result),1)]),_:1},8,["tooltip"])]),_:1})):(p(),b(n,{key:1,label:"异常信息",span:2},{default:e(()=>[t(y,{"max-line":4,tooltip:h},{default:e(()=>[f(u(o.data.error),1)]),_:1},8,["tooltip"])]),_:1}))]),_:1},8,["column"])):R("",!0)]),_:1},8,["modelValue"])}}},ce=Y(ue,[["__scopeId","data-v-fe3d6de7"]]);async function pe(o){const r=await S.get("/system/operation-record/page",{params:o});return r.data.code===0?r.data.data:Promise.reject(new Error(r.data.message))}async function fe(o){const r=await S.get("/system/operation-record",{params:o});return r.data.code===0&&r.data.data?r.data.data:Promise.reject(new Error(r.data.message))}const Be=Object.assign({name:"SystemOperationRecord"},{__name:"index",setup(o){const r=M(null),h=M([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"module",label:"操作模块",sortable:"custom",minWidth:110},{prop:"description",label:"操作功能",sortable:"custom",minWidth:110},{prop:"url",label:"请求地址",sortable:"custom",minWidth:110},{prop:"requestMethod",label:"请求方式",sortable:"custom",width:110,align:"center"},{prop:"status",label:"状态",sortable:"custom",width:100,align:"center",slot:"status",filters:[{text:"正常",value:"0"},{text:"异常",value:"1"}],filterMultiple:!1,formatter:a=>a.status==0?"正常":"异常"},{prop:"spendTime",label:"耗时",sortable:"custom",width:100,formatter:a=>`${a.spendTime/1e3}s`,align:"center"},{prop:"createTime",label:"操作时间",sortable:"custom",align:"center",width:180},{columnKey:"action",label:"操作",width:90,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}]),_=M({module:"",description:"",url:"",requestMethod:"",method:"",params:"",result:"",error:"",spendTime:0,os:"",device:"",browser:"",ip:"",status:0,createTime:"",nickname:"",username:""}),k=M(!1),d=({pages:a,where:l,orders:i,filters:c})=>pe({...l,...i,...c,...a}),n=a=>{var l,i;(i=(l=r.value)==null?void 0:l.reload)==null||i.call(l,{page:1,where:a})},v=a=>{_.value=a,k.value=!0},y=()=>{var l,i;const a=$.loading({message:"请求中..",plain:!0});(i=(l=r.value)==null?void 0:l.fetch)==null||i.call(l,({where:c,orders:T,filters:w})=>{fe({...c,...T,...w}).then(x=>{const E=new X.Workbook,m=E.addWorksheet("Sheet1");m.addRow(["账号","用户名","操作模块","操作功能","请求地址","请求方式","状态","耗时","操作时间"]),x.forEach(s=>{m.addRow([s.username,s.nickname,s.module,s.description,s.url,s.requestMethod,["正常","异常"][s.status],s.spendTime/1e3+"s",s.createTime])}),[16,16,18,20,28,14,14,14,24].forEach((s,C)=>{m.getColumn(C+1).width=s}),m.eachRow({includeEmpty:!0},(s,C)=>{s.height=20,s.eachCell({includeEmpty:!0},D=>{D.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},D.alignment={vertical:"middle",horizontal:"center"},D.font={size:12,bold:C===1}})}),E.xlsx.writeBuffer().then(s=>{ee(s,"操作日志.xlsx"),a.close()})}).catch(x=>{a.close(),$.error(x.message)})})};return(a,l)=>{const i=B,c=I,T=G,w=te,x=W,E=O;return p(),b(E,null,{default:e(()=>[t(re,{onSearch:n}),t(x,{"body-style":{paddingTop:"8px"}},{default:e(()=>[t(w,{ref_key:"tableRef",ref:r,"row-key":"id",columns:h.value,datasource:d,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"操作日志数据"},"cache-key":"systemOperationRecordTable"},{toolbar:e(()=>[t(i,{type:"primary",class:"ele-btn-icon",icon:V(Q),onClick:y},{default:e(()=>l[1]||(l[1]=[f(" 导出 ")])),_:1},8,["icon"])]),status:e(({row:m})=>[m.status===0?(p(),b(c,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>l[2]||(l[2]=[f(" 正常 ")])),_:1})):m.status===1?(p(),b(c,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>l[3]||(l[3]=[f(" 异常 ")])),_:1})):R("",!0)]),action:e(({row:m})=>[t(T,{type:"primary",underline:!1,onClick:s=>v(m)},{default:e(()=>l[4]||(l[4]=[f(" 详情 ")])),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),t(ce,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=m=>k.value=m),data:_.value},null,8,["modelValue","data"])]),_:1})}}});export{Be as default};
