import{s as N,gF as D,_ as G,gy as J,aV as S,aU as Y,r as d,a as A,gG as O,gH as W,I as X,R as Z,gI as ee,gJ as ae,n as E,o as f,d as i,b as s,w as n,c as se,e as oe,h as C,t as v,u as l,aG as te,aH as le,aI as ne,aJ as re,aK as ce,ao as ie,cx as de,bv as ue,a5 as me,aY as pe,aC as _e,E as ge,as as fe,gK as ve,m as h,gL as he,gM as ye,gN as we,gO as be,gP as xe,gQ as ke}from"./index-C4Wz-E93.js";import{_ as Ve}from"./index-B7CPKknw.js";import{E as Ee}from"./link-sE-uksY2.js";import{_ as Ce}from"./index-DCGqdiry.js";import{_ as Ie}from"./index-CjiDOsk7.js";async function $e(c){var g;const o=await N.post("/login",c);return o.data.code===0?(D("Bearer "+((g=o.data.data)==null?void 0:g.token),c.remember),o.data.message):Promise.reject(new Error(o.data.message))}async function qe(){const c=await N.get("/captchaImage");return c.data.code===0&&c.data.data?c.data.data:Promise.reject(new Error(c.data.message))}const Re={class:"login-wrapper"},Ue={class:"login-main"},Ne={class:"login-body"},Pe={class:"login-captcha-group"},Te=["src"],Be={key:1,class:"login-qrcode-group"},Me={__name:"index",setup(c){const{t:o}=J.useI18n(),{currentRoute:g}=S(),{goHomeRoute:P,cleanPageTabs:T}=Y(),y=d(1),w=d(null),b=d(!1),m=d(!1),t=A({username:W()||"",password:O()||"",captcha_code:"",captcha_key:""}),B=X(()=>({username:[{required:!0,message:o("login.username"),type:"string",trigger:"blur"}],password:[{required:!0,message:o("login.password"),type:"string",trigger:"blur"}],captcha_code:[{required:!0,message:o("login.code"),type:"string",trigger:"blur"}]})),x=d(""),I=d(""),$=d(""),q=()=>{var a,e;(e=(a=w.value)==null?void 0:a.validate)==null||e.call(a,u=>{if(u){if(t.captcha_code.toLowerCase()!==I.value){h.error("验证码错误");return}b.value=!0,$e({username:t.username,password:he(t.password),captcha_code:t.captcha_code,captcha_key:t.captcha_key}).then(p=>{h.success(p),m.value&&(ye(t.username),we(t.password)),T(),U()}).catch(p=>{b.value=!1,h.error(p.message),k()})}})},k=()=>{qe().then(a=>{var e,u;x.value=`data:image/png;base64,${a.captcha_img}`,t.captcha_key=a.captcha_key,I.value=a.captcha_code,(u=(e=w.value)==null?void 0:e.clearValidate)==null||u.call(e)}).catch(a=>{h.error(a.message)})},R=()=>{$.value=`https://api.eleadmin.com/v2/auth/login?code=${Date.now()}`},M=a=>{a===2&&R()},U=()=>{const{query:a}=l(g);P(a.from)};return Z(m,a=>{be(a),a===!1&&(xe(),ke())}),ee()?U():(m.value=ae(),k()),(a,e)=>{const u=oe,p=Ce,V=ce,_=re,z=pe,H=_e,K=te,j=Ie,F=ge,L=Ee,Q=Ve;return f(),E("div",Re,[i("div",Ue,[s(Q,{shadow:"always",class:"login-card"},{default:n(()=>[e[6]||(e[6]=i("div",{class:"login-cover"},[i("h1",{class:"login-title"}),i("h4",{class:"login-subtitle"})],-1)),i("div",Ne,[s(u,{type:"heading",style:{"font-size":"24px","margin-bottom":"18px"}},{default:n(()=>[C(v(l(o)("login.title")),1)]),_:1}),s(p,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=r=>y.value=r),items:[{label:l(o)("login.passwordType"),value:1},{label:l(o)("login.qrcodeType"),value:2}],style:{"margin-bottom":"18px"},onChange:M},null,8,["modelValue","items"]),y.value==1?(f(),se(K,{key:0,ref_key:"formRef",ref:w,size:"large",model:t,rules:B.value,onKeyup:ne(q,["enter"]),onSubmit:e[5]||(e[5]=le(()=>{},["prevent"]))},{default:n(()=>[s(_,{prop:"username"},{default:n(()=>[s(V,{clearable:"",modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=r=>t.username=r),placeholder:l(o)("login.username"),"prefix-icon":l(ie)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),s(_,{prop:"password"},{default:n(()=>[s(V,{"show-password":"",modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=r=>t.password=r),placeholder:l(o)("login.password"),"prefix-icon":l(de)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),s(_,{prop:"code"},{default:n(()=>[i("div",Pe,[s(V,{clearable:"",modelValue:t.captcha_code,"onUpdate:modelValue":e[3]||(e[3]=r=>t.captcha_code=r),placeholder:l(o)("login.code"),"prefix-icon":l(ue)},null,8,["modelValue","placeholder","prefix-icon"]),i("div",{class:"login-captcha",onClick:k},[x.value?(f(),E("img",{key:0,src:x.value},null,8,Te)):me("",!0)])])]),_:1}),s(_,null,{default:n(()=>[s(z,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=r=>m.value=r)},{default:n(()=>[C(v(l(o)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1}),s(_,null,{default:n(()=>[s(H,{size:"large",type:"primary",loading:b.value,style:{width:"100%"},onClick:q},{default:n(()=>[C(v(l(o)("login.login")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])):(f(),E("div",Be,[s(j,{size:180,margin:2,value:$.value,class:"login-qrcode"},null,8,["value"]),s(L,{type:"primary",underline:!1,style:{"margin-top":"16px","user-select":"none"},onClick:R},{default:n(()=>[s(F,{size:15,style:{transform:"translateY(-1px)","margin-right":"6px"}},{default:n(()=>[s(l(fe))]),_:1}),i("span",null,v(l(o)("login.refreshQrcode")),1)]),_:1})]))])]),_:1})]),s(ve,{style:{"padding-top":"0"}})])}}},Le=G(Me,[["__scopeId","data-v-0af108e4"]]);export{Le as default};
