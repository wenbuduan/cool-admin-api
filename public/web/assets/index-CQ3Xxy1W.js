import{_ as z}from"./index-D9JJOZeW.js";import{aF as O,c as U,o as w,w as o,b as t,aG as S,aH as T,aI as G,aJ as A,aK as L,u as d,aC as B,h as b,b3 as M,b4 as W,r as v,a as J,v as P,aW as Q,aB as j,m as N,U as D,d as K,a5 as X,E as Y,a8 as Z,t as ee,bb as le,eb as te,k as oe,aM as ae,au as ne,aE as se}from"./index-C4Wz-E93.js";import{_ as q}from"./index-B7CPKknw.js";import{_ as re}from"./index-C4uegQIc.js";import"./index-BWRTmGSC.js";import{_ as ue}from"./index-BpeYX26o.js";import"./index-1MN7neRp.js";import"./virtual-list-CKtLkxHg.js";import"./index-CwnermTv.js";import"./index-BUwq14Gk.js";import{E as de}from"./link-sE-uksY2.js";import{a as ie,E as me}from"./col-wGeLV9c2.js";import{E as pe}from"./input-number-tZCTFD7x.js";import{u as ce,a as fe,b as _e,c as ve,l as ge,p as be,r as ye}from"./index-cGN0WSKX.js";import{E as Ve}from"./tree-D50DgR80.js";import"./isArrayLikeObject-B8QFGS9H.js";import"./vuedraggable.umd-svCSXnzP.js";import"./index-BgwkhR57.js";const xe={__name:"role-search",emits:["search"],setup(I,{emit:V}){const x=V,[i,p]=O({roleName:"",roleCode:"",comments:""}),r=()=>{x("search",{...i})},c=()=>{p(),r()};return(k,s)=>{const C=L,h=A,E=me,f=B,a=ie,l=S,n=q;return w(),U(n,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[t(l,{"label-width":"72px",onKeyup:G(r,["enter"]),onSubmit:s[2]||(s[2]=T(()=>{},["prevent"]))},{default:o(()=>[t(a,{gutter:8},{default:o(()=>[t(E,{lg:6,md:8,sm:12,xs:24},{default:o(()=>[t(h,{label:"角色名称"},{default:o(()=>[t(C,{clearable:"",modelValue:d(i).roleName,"onUpdate:modelValue":s[0]||(s[0]=e=>d(i).roleName=e),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(E,{lg:6,md:8,sm:12,xs:24},{default:o(()=>[t(h,{label:"角色标识"},{default:o(()=>[t(C,{clearable:"",modelValue:d(i).roleCode,"onUpdate:modelValue":s[1]||(s[1]=e=>d(i).roleCode=e),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(E,{lg:12,md:8,sm:24,xs:24},{default:o(()=>[t(h,{"label-width":"16px"},{default:o(()=>[t(f,{type:"primary",onClick:r},{default:o(()=>s[3]||(s[3]=[b("查询")])),_:1}),t(f,{onClick:c},{default:o(()=>s[4]||(s[4]=[b("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},ke={__name:"role-edit",props:M({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:M(["done"],["update:modelValue"]),setup(I,{emit:V}){const x=I,i=V,p=W(I,"modelValue"),r=v(!1),c=v(!1),k=v(null),[s,C,h]=O({roleId:void 0,roleName:"",roleCode:"",sortNum:1,status:"ENABLED",comments:""}),E=J({roleName:[{required:!0,message:"请输入角色名称",type:"string",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色标识",type:"string",trigger:"blur"}]}),f=()=>{p.value=!1},a=()=>{var n,e;(e=(n=k.value)==null?void 0:n.validate)==null||e.call(n,_=>{if(!_)return;c.value=!0,(r.value?ce:fe)(s).then(m=>{c.value=!1,N.success(m),f(),i("done")}).catch(m=>{c.value=!1,N.error(m.message)})})},l=()=>{x.data?(h(x.data),r.value=!0):(C(),r.value=!1),D(()=>{D(()=>{var n,e;(e=(n=k.value)==null?void 0:n.clearValidate)==null||e.call(n)})})};return(n,e)=>{const _=L,g=A,m=pe,R=Q,u=P,$=S,F=B,H=j;return w(),U(H,{form:"",width:460,modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=y=>p.value=y),title:r.value?"修改角色":"添加角色",onOpen:l},{footer:o(()=>[t(F,{onClick:f},{default:o(()=>e[9]||(e[9]=[b("取消")])),_:1}),t(F,{type:"primary",loading:c.value,onClick:a},{default:o(()=>e[10]||(e[10]=[b(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[t($,{ref_key:"formRef",ref:k,model:d(s),rules:E,"label-width":"80px",onSubmit:e[5]||(e[5]=T(()=>{},["prevent"]))},{default:o(()=>[t(g,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(_,{clearable:"",maxlength:20,modelValue:d(s).roleName,"onUpdate:modelValue":e[0]||(e[0]=y=>d(s).roleName=y),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"角色标识",prop:"roleCode"},{default:o(()=>[t(_,{clearable:"",maxlength:20,modelValue:d(s).roleCode,"onUpdate:modelValue":e[1]||(e[1]=y=>d(s).roleCode=y),placeholder:"请输入角色标识"},null,8,["modelValue"])]),_:1}),t(g,{prop:"sortNum",label:"角色顺序",required:""},{default:o(()=>[t(m,{modelValue:d(s).sortNum,"onUpdate:modelValue":e[2]||(e[2]=y=>d(s).sortNum=y),min:1},null,8,["modelValue"])]),_:1}),t(g,{prop:"status",label:"角色状态"},{default:o(()=>[t(u,{modelValue:d(s).status,"onUpdate:modelValue":e[3]||(e[3]=y=>d(s).status=y)},{default:o(()=>[t(R,{value:"ENABLED",size:"small"},{default:o(()=>e[7]||(e[7]=[b("启用")])),_:1}),t(R,{value:"DISABLED",size:"small"},{default:o(()=>e[8]||(e[8]=[b("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"备注"},{default:o(()=>[t(_,{rows:4,type:"textarea",modelValue:d(s).comments,"onUpdate:modelValue":e[4]||(e[4]=y=>d(s).comments=y),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},Ce={style:{"vertical-align":"-2px"}},Ee={__name:"role-auth",props:M({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(I){const V=I,x=W(I,"modelValue"),i=v(null),p=v([]),r=v(!1),c=v(!1),k=v([]),s=()=>{p.value=[],k.value=[],V.data&&(r.value=!0,ve(V.data.roleId).then(f=>{r.value=!1,p.value=le({data:f.menus,idField:"menuId",parentIdField:"parentId"}),D(()=>{const a=[];te(p.value,l=>{var n;l.menuId&&l.checked&&!((n=l.children)!=null&&n.length)&&a.push(l.menuId)}),k.value=a})}).catch(f=>{r.value=!1,N.error(f.message)}))},C=()=>{x.value=!1},h=()=>{var a,l,n,e,_,g,m,R;c.value=!0;const f=(m=((n=(l=(a=i.value)==null?void 0:a.getCheckedKeys)==null?void 0:l.call(a))!=null?n:[]).concat((g=(_=(e=i.value)==null?void 0:e.getHalfCheckedKeys)==null?void 0:_.call(e))!=null?g:[]))!=null?m:[];_e((R=V.data)==null?void 0:R.roleId,f).then(u=>{c.value=!1,N.success(u),C()}).catch(u=>{c.value=!1,N.error(u.message)})},E=()=>{s()};return(f,a)=>{const l=Y,n=Ve,e=ue,_=B,g=j;return w(),U(g,{width:460,title:"分配权限",position:"center",modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=m=>x.value=m),"body-style":{padding:"12px 0 12px 22px"},onOpen:E},{footer:o(()=>[t(_,{onClick:C},{default:o(()=>a[1]||(a[1]=[b("取消")])),_:1}),t(_,{type:"primary",loading:c.value,onClick:h},{default:o(()=>a[2]||(a[2]=[b(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[t(e,{loading:r.value,"spinner-style":{background:"transparent"},style:{paddingRight:"20px",height:"calc(100vh - 192px)",maxHeight:"calc(100dvh - 192px)",minHeight:"100px",overflow:"auto"}},{default:o(()=>[t(n,{ref_key:"treeRef",ref:i,"show-checkbox":"",data:p.value,"node-key":"menuId","default-expand-all":!0,props:{label:"title"},"default-checked-keys":k.value,style:{"--ele-tree-item-height":"28px"}},{default:o(m=>[K("div",null,[m.data.icon?(w(),U(l,{key:0,size:16,style:{"margin-right":"6px","vertical-align":"-5px"}},{default:o(()=>[(w(),U(Z(m.data.icon)))]),_:2},1024)):X("",!0),K("span",Ce,ee(m.data.title),1)])]),_:1},8,["data","default-checked-keys"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])}}},je=Object.assign({name:"SystemRole"},{__name:"index",setup(I){const V=v(null),x=v([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",sortable:"custom",minWidth:120},{prop:"roleCode",label:"角色标识",sortable:"custom",minWidth:120},{prop:"sortNum",label:"排序",sortable:"custom",minWidth:80},{prop:"comments",label:"备注",sortable:"custom",minWidth:140},{prop:"create_time",label:"创建时间",sortable:"custom",width:180,align:"center"},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),i=v([]),p=v(null),r=v(!1),c=v(!1),k=({pages:a,where:l,orders:n})=>be({...l,...n,...a}),s=a=>{var l,n;i.value=[],(n=(l=V.value)==null?void 0:l.reload)==null||n.call(l,{page:1,where:a})},C=a=>{p.value=a!=null?a:null,r.value=!0},h=a=>{p.value=a!=null?a:null,c.value=!0},E=a=>{const l=a==null?i.value:[a];if(!l.length){N.error("请至少选择一条数据");return}se.confirm("确定要删除“"+l.map(n=>n.roleName).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const n=N.loading({message:"请求中..",plain:!0});ye(l.map(e=>e.roleId)).then(e=>{n.close(),N.success(e),s()}).catch(e=>{n.close(),N.error(e.message)})}).catch(()=>{})},f=({where:a,orders:l})=>ge({...a,...l});return(a,l)=>{const n=B,e=de,_=oe,g=re,m=q,R=z;return w(),U(R,null,{default:o(()=>[t(xe,{onSearch:s}),t(m,{"body-style":{paddingTop:"8px"}},{default:o(()=>[t(g,{ref_key:"tableRef",ref:V,"row-key":"roleId",columns:x.value,datasource:k,"show-overflow-tooltip":!0,selections:i.value,"onUpdate:selections":l[2]||(l[2]=u=>i.value=u),"highlight-current-row":!0,"export-config":{fileName:"角色数据",datasource:f},"print-config":{datasource:f},"cache-key":"systemRoleTable"},{toolbar:o(()=>[t(n,{type:"primary",class:"ele-btn-icon",icon:d(ae),onClick:l[0]||(l[0]=u=>C())},{default:o(()=>l[5]||(l[5]=[b(" 新建 ")])),_:1},8,["icon"]),t(n,{type:"danger",class:"ele-btn-icon",icon:d(ne),onClick:l[1]||(l[1]=u=>E())},{default:o(()=>l[6]||(l[6]=[b(" 删除 ")])),_:1},8,["icon"])]),action:o(({row:u})=>[t(e,{type:"primary",underline:!1,onClick:$=>C(u)},{default:o(()=>l[7]||(l[7]=[b(" 修改 ")])),_:2},1032,["onClick"]),t(_,{direction:"vertical"}),t(e,{type:"primary",underline:!1,onClick:$=>h(u)},{default:o(()=>l[8]||(l[8]=[b(" 分配权限 ")])),_:2},1032,["onClick"]),t(_,{direction:"vertical"}),t(e,{type:"danger",underline:!1,onClick:$=>E(u)},{default:o(()=>l[9]||(l[9]=[b(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections","export-config","print-config"])]),_:1}),t(ke,{modelValue:r.value,"onUpdate:modelValue":l[3]||(l[3]=u=>r.value=u),data:p.value,onDone:s},null,8,["modelValue","data"]),t(Ee,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=u=>c.value=u),data:p.value},null,8,["modelValue","data"])]),_:1})}}});export{je as default};
