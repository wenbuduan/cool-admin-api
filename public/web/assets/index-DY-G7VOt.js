import{L as se,e$ as ue,bU as re,r as C,I as T,f1 as p,R as V,T as ie,c as pe,o as ce,aL as L,w as K,a1 as R,bW as E,bX as $,b as de,bS as me,p as fe,U as y,f2 as k}from"./index-DwvUEvvU.js";import{_ as he}from"./index-CrZMXbiR.js";import{_ as ge,a as ve}from"./index-PXkBd5Z8.js";const be={modelValue:{type:[String,Number,Boolean,Array],default:()=>null},multiple:Boolean,disabled:Boolean,size:String,clearable:Boolean,placeholder:String,valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},initValue:[Object,Array],cacheData:Array,tableProps:{type:Object,required:!0},maxTagCount:Number,maxTagTextLength:Number,tagType:{type:String,default:"info"},automaticDropdown:Boolean,filterable:Boolean,teleported:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},placement:{type:String,default:"bottom-start"},transition:{type:String,default:"el-zoom-in-top"},popperOptions:Object,popperClass:String,popperWidth:[Number,String],selectStyle:Object,inputStyle:Object,selectTagsStyle:Object,responsive:{type:Boolean,default:null}},ye={"update:modelValue":c=>!0,change:c=>!0,visibleChange:c=>!0,removeTag:c=>!0,clear:()=>!0,focus:c=>!0,blur:c=>!0,select:c=>!0,filterChange:c=>!0},Ve=se({name:"EleTableSelect",__name:"index",props:be,emits:ye,setup(c,{expose:j,emit:x}){const l=c,u=x,{validateChange:z}=ue(),W=re(l),h=C(null),r=C(null),S=C(!1),i=C([]),O=T(()=>{const e=i.value;return!l.multiple&&e.length?e[0].label:""}),P=T(()=>{if(!(l.multiple||p(l.modelValue)))return l.modelValue}),B=T(()=>{if(!(!l.multiple||p(l.modelValue)))return l.modelValue}),A=T(()=>{const e=["ele-table-select-popper"];return W.value&&e.push("is-responsive"),l.popperClass&&e.push(l.popperClass),e.join(" ")}),v=()=>{h.value&&h.value.updatePopper()},F=e=>{if(!p(e)){if(l.cacheData!=null){const a=l.cacheData.find(t=>t[l.valueKey]===e);if(a!=null)return a}if(!p(l.initValue))return l.multiple?l.initValue.find(a=>a[l.valueKey]===e):l.initValue}},N=(e,a,t,n,o)=>{if(t!=null){const s=a.indexOf(e);if(s!==-1)return t[s]}if(o!=null){const s=n.indexOf(e);if(s!==-1)return o[s]}},U=()=>{const e=l.modelValue;if(p(e,!0))return[];const a=[],t=[];if(r.value&&(r.value.getSelectionRows()||[]).forEach(o=>{if(!o._isMock){const s=o[l.valueKey],f=e.indexOf(s);f!==-1&&(a.push({value:s,label:o[l.labelKey],index:f}),t.push(s))}}),t.length!==e.length){const{valueKey:n,cacheData:o,initValue:s}=l,f=o?o.map(d=>d[n]):[],w=s?s.map(d=>d[n]):[];e.forEach(d=>{if(!t.includes(d)){const I=N(d,f,o,w,s),ne=I?I[l.labelKey]:String(d),oe=e.indexOf(d);a.push({value:d,label:ne,index:oe})}})}return a.sort((n,o)=>n.index-o.index),a},m=e=>{if(!l.multiple){const t=l.modelValue,n=i.value.length?i.value[0]:null;if(p(t)){n!=null&&(i.value=[]);return}if(e||!n||n.value!==t){const o=r.value?r.value.getCurrentRow():null,f=(o&&o[l.valueKey]===t?o:void 0)||F(t),w=f?f[l.labelKey]:String(t);i.value=[{label:w,value:t}]}return}if(p(l.modelValue,!0)){i.value.length&&(i.value=[],y(()=>{v()}));return}const a=i.value.map(t=>t.value);(e||k(l.modelValue,a,!0))&&(i.value=U(),y(()=>{v()}))},M=()=>{h.value&&h.value.focusSearchInput()},D=e=>{const a=l.valueKey;if(!l.multiple){const n=e[a];n===l.modelValue?m():g(n);return}const t=e.map(n=>n[a]);k(l.modelValue,t,!0)?g(t):m()},g=e=>{k(e,l.modelValue,l.multiple)&&(u("update:modelValue",e),z(),u("change",e))},b=e=>{var a;if(S.value!==e){if(S.value=e,e&&((a=l.tableProps)!=null&&a.virtual)&&r.value){const t=r.value.getTableRef();t!=null&&!t.wrapWidth&&y(()=>{t.updateWrapSize(),y(()=>{v()})})}u("visibleChange",e)}},q=e=>{const a=l.modelValue||[];g(a.filter(t=>t!==e.value)),u("removeTag",e.value)},X=()=>{g(l.multiple?[]:null),b(!1),u("clear")},G=e=>{u("focus",e)},H=e=>{u("blur",e)},J=e=>{u("filterChange",e)},Q=e=>{l.multiple&&g(e)},Y=e=>{l.multiple||g(e)},Z=e=>{!l.multiple&&e!=null&&m(!0)},_=()=>{l.multiple&&m(!0)},ee=e=>{var a;l.multiple?(a=l.tableProps)!=null&&a.rowClickChecked&&r.value&&!ve(e,r.value.getData().indexOf(e),r.value.tableProps.columns)&&u("select",r.value.getSelectionRows()||[]):(b(!1),u("select",e))},le=e=>{u("select",e)},te=e=>{u("select",e)},ae=()=>{y(()=>{v()})};return V(()=>l.modelValue,()=>{m()},{deep:!0}),V(()=>l.cacheData,()=>{m(!0)}),V(()=>l.initValue,e=>{p(e)||D(e)},{deep:!0}),V(()=>l.disabled,e=>{e&&b(!1)}),ie(()=>{p(l.initValue,l.multiple)?p(l.modelValue,l.multiple)||m():D(l.initValue)}),j({selectRef:h,tableRef:r,selectVisible:S,selectedItems:i,selectedLabel:O,currentRowKey:P,selectedRowKeys:B,updatePopover:v,updateSelectedItems:m,updateVisible:b,focusSearchInput:M}),(e,a)=>(ce(),pe(he,{ref_key:"selectRef",ref:h,value:e.modelValue,multiple:e.multiple,disabled:e.disabled,size:e.size,clearable:e.clearable,placeholder:e.placeholder,maxTagCount:e.maxTagCount,maxTagTextLength:e.maxTagTextLength,tagType:e.tagType,automaticDropdown:e.automaticDropdown,filterable:e.filterable,teleported:e.teleported,persistent:e.persistent,placement:e.placement,transition:e.transition,popperWidth:e.popperWidth,popperOptions:e.popperOptions,popperClass:A.value,selectStyle:e.selectStyle,inputStyle:e.inputStyle,selectTagsStyle:e.selectTagsStyle,selectedLabel:O.value,selected:i.value,visible:S.value,"onUpdate:visible":b,onFilterChange:J,onRemoveTag:q,onClear:X,onFocus:G,onBlur:H},L({default:K(()=>[R(e.$slots,"topExtra"),de(ge,me({"onUpdate:selectedRowKeys":Q,"onUpdate:currentRowKey":Y,onSelectionChange:_,onCurrentChange:Z,onRowClick:ee,onSelect:le,onSelectAll:te,onDone:ae},e.tableProps||{},{ref_key:"tableRef",ref:r,rowKey:e.valueKey,reserveCurrent:!0,highlightCurrentRow:!e.multiple,currentRowKey:P.value,selectedRowKeys:B.value}),L({_:2},[fe(Object.keys(e.$slots).filter(t=>!["topExtra","bottomExtra","maxTagPlaceholder"].includes(t)),t=>({name:t,fn:K(n=>[R(e.$slots,t,E($(n||{})))])}))]),1040,["rowKey","highlightCurrentRow","currentRowKey","selectedRowKeys"]),R(e.$slots,"bottomExtra")]),_:2},[e.$slots.maxTagPlaceholder?{name:"maxTagPlaceholder",fn:K(t=>[R(e.$slots,"maxTagPlaceholder",E($(t||{})))]),key:"0"}:void 0]),1032,["value","multiple","disabled","size","clearable","placeholder","maxTagCount","maxTagTextLength","tagType","automaticDropdown","filterable","teleported","persistent","placement","transition","popperWidth","popperOptions","popperClass","selectStyle","inputStyle","selectTagsStyle","selectedLabel","selected","visible"]))}});export{Ve as _};
