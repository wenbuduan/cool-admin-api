import{_ as ve}from"./index-MJsbY79C.js";import{b1 as te,c as S,o as M,w as a,b as e,aK as ae,aM as G,u as i,cB as oe,aD as W,h as D,aJ as le,dc as be,aI as ne,a$ as H,b0 as xe,r as u,a as re,a5 as se,aC as ye,m as w,U as K,R as ie,n as Q,ay as he,k as we,d as L,E as de,bc as Ve,aW as ze,F as Z,p as ke,l as Ie,t as ue,bR as J,au as X,av as me,aF as Y,bO as Ce,b4 as $e,at as ee,fc as Ue,f7 as De,b8 as Ee,ek as Re,b9 as A}from"./index-n6Orl0xG.js";import{_ as Me}from"./index-DLejwlYb.js";import{_ as Ne}from"./index-CrytgPw-.js";import{_ as Fe}from"./index-DJBR385J.js";import{E as Te}from"./tree-DjMbQr5I.js";import{_ as Oe}from"./index-BBd_ea8k.js";import"./index-xWcpkv5n.js";import"./index-DBPDFNRg.js";import"./virtual-list-Dy04eCLP.js";import"./index-C5FeiaYW.js";import"./index-Z0s6jAnH.js";import{a as pe,E as ce}from"./col-CI8qhQxM.js";import{_ as Se}from"./role-select-D09TBnjz.js";import{_ as Be}from"./organization-select-e6Cg6kqH.js";import{c as Ke,u as qe,a as je,b as Le,r as We,l as Pe,p as Ae,d as Je}from"./index-Ci85yZk2.js";import{p as Xe,e as Ye}from"./validate-B_6HX0Io.js";import{_ as Ge}from"./organization-edit-BWe3hU-c.js";import{l as He,r as Qe}from"./index-B61GkkgX.js";import"./isArrayLikeObject-CVZfMnll.js";import"./vuedraggable.umd-oUa5xh2t.js";import"./index-Crx599JX.js";import"./tree-select-CIqUjQHp.js";import"./input-number-w9GRKpek.js";import"./index-tsWABA3i.js";const Ze={__name:"user-search",emits:["search"],setup(N,{expose:F,emit:C}){const E=C,[_,f]=te({username:"",nickname:"",sex:void 0}),m=()=>{E("search",{..._})},V=()=>{f(),m()};return F({resetFields:f}),(d,p)=>{const R=G,z=ae,$=ce,U=oe,k=W,g=pe,o=ne;return M(),S(o,{"label-width":"72px",onKeyup:be(m,["enter"]),onSubmit:p[3]||(p[3]=le(()=>{},["prevent"]))},{default:a(()=>[e(g,{gutter:8},{default:a(()=>[e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{label:"用户账号"},{default:a(()=>[e(R,{clearable:"",modelValue:i(_).username,"onUpdate:modelValue":p[0]||(p[0]=s=>i(_).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{label:"用户名"},{default:a(()=>[e(R,{clearable:"",modelValue:i(_).nickname,"onUpdate:modelValue":p[1]||(p[1]=s=>i(_).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{label:"性别"},{default:a(()=>[e(U,{code:"sex",modelValue:i(_).sex,"onUpdate:modelValue":p[2]||(p[2]=s=>i(_).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[e(z,{"label-width":"16px"},{default:a(()=>[e(k,{type:"primary",onClick:m},{default:a(()=>p[4]||(p[4]=[D("查询")])),_:1}),e(k,{onClick:V},{default:a(()=>p[5]||(p[5]=[D("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},et={__name:"user-edit",props:H({data:Object,organizationId:Number,organizationData:Array},{modelValue:{type:Boolean},modelModifiers:{}}),emits:H(["done"],["update:modelValue"]),setup(N,{emit:F}){const C=N,E=F,_=xe(N,"modelValue"),f=u(!1),m=u(!1),V=u(null),[d,p,R]=te({userId:void 0,organizationId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),z=re({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(g,o,s)=>{var x;Ke("username",o,(x=C.data)==null?void 0:x.userId).then(()=>{s(new Error("账号已经存在"))}).catch(()=>{s()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"change"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"change"}],email:[{pattern:Ye,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(g,o,s)=>{if(f.value||/^[\S]{5,18}$/.test(o))return s();s(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:Xe,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),$=()=>{_.value=!1},U=()=>{var g,o;(o=(g=V.value)==null?void 0:g.validate)==null||o.call(g,s=>{if(!s)return;m.value=!0,(f.value?qe:je)(d).then(I=>{m.value=!1,w.success(I),$(),E("done")}).catch(I=>{m.value=!1,w.error(I.message)})})},k=()=>{C.data?(R({...C.data,password:""}),f.value=!0):(p(),d.organizationId=C.organizationId,f.value=!1),K(()=>{K(()=>{var g,o;(o=(g=V.value)==null?void 0:g.clearValidate)==null||o.call(g)})})};return(g,o)=>{const s=ae,x=G,I=oe,B=ce,r=pe,l=ne,c=W,v=ye;return M(),S(v,{form:"",width:640,modelValue:_.value,"onUpdate:modelValue":o[10]||(o[10]=t=>_.value=t),title:f.value?"修改用户":"新建用户",onOpen:k},{footer:a(()=>[e(c,{onClick:$},{default:a(()=>o[11]||(o[11]=[D("取消")])),_:1}),e(c,{type:"primary",loading:m.value,onClick:U},{default:a(()=>o[12]||(o[12]=[D(" 保存 ")])),_:1},8,["loading"])]),default:a(()=>[e(l,{ref_key:"formRef",ref:V,model:i(d),rules:z,"label-width":"80px",onSubmit:o[9]||(o[9]=le(()=>{},["prevent"]))},{default:a(()=>[e(r,{gutter:16},{default:a(()=>[e(B,{sm:12,xs:24},{default:a(()=>[e(s,{label:"所属机构"},{default:a(()=>[e(Be,{modelValue:i(d).organizationId,"onUpdate:modelValue":o[0]||(o[0]=t=>i(d).organizationId=t),"organization-data":N.organizationData},null,8,["modelValue","organization-data"])]),_:1}),e(s,{label:"用户账号",prop:"username"},{default:a(()=>[e(x,{clearable:"",maxlength:20,modelValue:i(d).username,"onUpdate:modelValue":o[1]||(o[1]=t=>i(d).username=t),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),e(s,{label:"用户名",prop:"nickname"},{default:a(()=>[e(x,{clearable:"",maxlength:20,modelValue:i(d).nickname,"onUpdate:modelValue":o[2]||(o[2]=t=>i(d).nickname=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(s,{label:"性别",prop:"sex"},{default:a(()=>[e(I,{code:"sex",modelValue:i(d).sex,"onUpdate:modelValue":o[3]||(o[3]=t=>i(d).sex=t),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),e(s,{label:"角色",prop:"roles"},{default:a(()=>[e(Se,{modelValue:i(d).roles,"onUpdate:modelValue":o[4]||(o[4]=t=>i(d).roles=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{sm:12,xs:24},{default:a(()=>[e(s,{label:"手机号",prop:"phone"},{default:a(()=>[e(x,{clearable:"",maxlength:11,modelValue:i(d).phone,"onUpdate:modelValue":o[5]||(o[5]=t=>i(d).phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(s,{label:"邮箱",prop:"email"},{default:a(()=>[e(x,{clearable:"",maxlength:100,modelValue:i(d).email,"onUpdate:modelValue":o[6]||(o[6]=t=>i(d).email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),f.value?se("",!0):(M(),S(s,{key:0,label:"登录密码",prop:"password"},{default:a(()=>[e(x,{"show-password":"",type:"password",maxlength:20,modelValue:i(d).password,"onUpdate:modelValue":o[7]||(o[7]=t=>i(d).password=t),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),e(s,{label:"个人简介"},{default:a(()=>[e(x,{type:"textarea",rows:3,maxlength:200,modelValue:i(d).introduction,"onUpdate:modelValue":o[8]||(o[8]=t=>i(d).introduction=t),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},tt={__name:"user-list",props:{organizationId:Number,organizationData:Array},setup(N){const F=N,C=u(null),E=u(null),_=u([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"sexName",label:"性别",sortable:"custom",width:90,align:"center"},{columnKey:"roles",label:"角色",minWidth:120,slot:"roles",align:"center",formatter:r=>r.roles.map(l=>l.roleName).join(",")},{prop:"createTime",label:"创建时间",sortable:"custom",width:180,align:"center"},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status",formatter:r=>r.status==0?"正常":"冻结"},{columnKey:"action",label:"操作",width:128,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),f=u([]),m=u(null),V=u(!1),d=({pages:r,where:l,orders:c})=>Ae({...l,...c,...r,organizationId:F.organizationId}),p=r=>{var l,c;(c=(l=E.value)==null?void 0:l.reload)==null||c.call(l,{page:1,where:r})},R=r=>{m.value=r!=null?r:null,V.value=!0},z=r=>{const l=r==null?f.value:[r];if(!l.length){w.error("请至少选择一条数据");return}Y.confirm("确定要删除“"+l.map(c=>c.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const c=w.loading({message:"请求中..",plain:!0});We(l.map(v=>v.userId)).then(v=>{c.close(),w.success(v),p()}).catch(v=>{c.close(),w.error(v.message)})}).catch(()=>{})},$=(r,l)=>{const c=r?0:1;Le(l.userId,c).then(v=>{l.status=c,w.success(v)}).catch(v=>{w.error(v.message)})};ie(()=>F.organizationId,()=>{var r,l;(l=(r=C.value)==null?void 0:r.resetFields)==null||l.call(r),p({})});const U=({where:r,orders:l})=>Pe({...r,...l,organizationId:F.organizationId}),k=u(null),g=u([]),o=u();let s=null;const x=r=>[{title:"重置密码",command:"password"},{title:"删除用户",command:"delete",divided:!0,danger:!0}],I=(r,l)=>{r==null||o.value===r||s!=null&&s===l||(k.value&&k.value.handleClose(),K(()=>{s=l,g.value=x()||[],o.value=r,g.value.length&&K(()=>{k.value&&k.value.handleOpen()})}))},B=r=>{if(s==null)return;const l=s;r==="delete"?z(l):r==="password"&&Y.prompt(`请输入用户"${l.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:c})=>{const v=w.loading({message:"请求中..",plain:!0});Je(l.userId,c).then(t=>{v.close(),w.success(t)}).catch(t=>{v.close(),w.error(t.message)})}).catch(()=>{})};return(r,l)=>{const c=W,v=Ie,t=ze,n=he,y=we,b=de,q=Oe,P=me;return M(),Q(Z,null,[e(Ze,{ref_key:"searchRef",ref:C,style:{"margin-bottom":"-14px"},onSearch:p},null,512),e(q,{ref_key:"tableRef",ref:E,"row-key":"userId",columns:_.value,datasource:d,"show-overflow-tooltip":!0,selections:f.value,"onUpdate:selections":l[2]||(l[2]=h=>f.value=h),"highlight-current-row":!0,"export-config":{fileName:"用户数据",datasource:U},"print-config":{datasource:U},style:{paddingBottom:"16px"},"cache-key":"listUserTable"},{toolbar:a(()=>[e(c,{type:"primary",class:"ele-btn-icon",icon:i(J),onClick:l[0]||(l[0]=h=>R())},{default:a(()=>l[4]||(l[4]=[D(" 新建 ")])),_:1},8,["icon"]),e(c,{type:"danger",class:"ele-btn-icon",icon:i(X),onClick:l[1]||(l[1]=h=>z())},{default:a(()=>l[5]||(l[5]=[D(" 删除 ")])),_:1},8,["icon"])]),roles:a(({row:h})=>[(M(!0),Q(Z,null,ke(h.roles,T=>(M(),S(v,{key:T.roleId,size:"small","disable-transitions":!0},{default:a(()=>[D(ue(T.roleName),1)]),_:2},1024))),128))]),status:a(({row:h})=>[e(t,{size:"small","model-value":h.status===0,onChange:T=>$(T,h)},null,8,["model-value","onChange"])]),action:a(({row:h})=>[e(n,{type:"primary",underline:!1,onClick:T=>R(h)},{default:a(()=>l[6]||(l[6]=[D(" 修改 ")])),_:2},1032,["onClick"]),e(y,{direction:"vertical"}),e(n,{type:"primary",underline:!1,onMouseenter:T=>I(T.currentTarget,h)},{default:a(()=>[l[7]||(l[7]=L("span",null,"更多",-1)),e(b,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:a(()=>[e(i(Ve))]),_:1})]),_:2},1032,["onMouseenter"])]),_:1},8,["columns","selections","export-config","print-config"]),e(et,{data:m.value,modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=h=>V.value=h),"organization-id":N.organizationId,"organization-data":N.organizationData,onDone:p},null,8,["data","modelValue","organization-id","organization-data"]),e(P,{ref_key:"moreDropdownRef",ref:k,trigger:"hover",triggerKeys:[],persistent:!1,componentType:"pro",virtualTriggering:!0,virtualRef:o.value,disabled:!g.value.length,items:g.value,onCommand:B},null,8,["virtualRef","disabled","items"])],64)}}},at={style:{padding:"0 16px 12px 0"}},ot={style:{"margin-bottom":"12px"}},lt={class:"el-tree-node__label",style:{"margin-top":"2px"}},Dt=Object.assign({name:"ListUser"},{__name:"index",setup(N){const{mobile:F}=Ce(),C=u(null),E=u(null),_=u(!0),f=u([]),m=u(null),V=u(""),d=u(!1),p=u(null),R=u(),z=()=>{_.value=!0,He().then(t=>{_.value=!1,f.value=Ee({data:t,idField:"organizationId",parentIdField:"parentId"}),K(()=>{$(f.value[0])})}).catch(t=>{_.value=!1,w.error(t.message)})},$=t=>{var n,y,b,q;m.value!=null&&F.value&&((y=(n=C.value)==null?void 0:n.toggleCollapse)==null||y.call(n,!0)),t&&t.organizationId?(m.value=t,(q=(b=E.value)==null?void 0:b.setCurrentKey)==null||q.call(b,t.organizationId)):m.value=null},U=(t,n)=>{p.value=t!=null?t:null,R.value=n,d.value=!0},k=t=>{const n=t;n&&Y.confirm(`确定要删除“${n.organizationName}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const y=w.loading({message:"请求中..",plain:!0});Qe(n.organizationId).then(b=>{y.close(),w.success(b),z()}).catch(b=>{y.close(),w.error(b.message)})}).catch(()=>{})},g=(t,n)=>t?!!(n.organizationName&&n.organizationName.includes(t)):!0;ie(V,t=>{var n,y;(y=(n=E.value)==null?void 0:n.filter)==null||y.call(n,t)}),z();const o=u(null),s=u([]),x=u();let I=null;const B=re({marginLeft:"0px"}),r=t=>[{title:"添加下级",command:"add",icon:A(J)},{title:"修改机构",command:"edit",icon:A(ee)},{title:"删除机构",command:"del",icon:A(X),divided:!0,danger:!0}],l=(t,n)=>{o.value&&o.value.handleClose(),K(()=>{I=n,s.value=r()||[],x.value=t,s.value.length&&K(()=>{o.value&&o.value.handleOpen()})})},c=t=>{I!=null&&(t==="add"?U(void 0,I.organizationId):t==="edit"?U(I):t==="del"&&k(I))},v=(t,n)=>{const y=Re(t.currentTarget,"el-tree-node__content"),b=y.getBoundingClientRect();B.marginLeft=`${t.clientX-b.left-b.width/2}px`,l(y,n)};return(t,n)=>{const y=G,b=W,q=de,P=Te,h=Fe,T=Ne,ge=Me,fe=me,_e=ve;return M(),S(_e,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:a(()=>[e(ge,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:a(()=>[e(T,{ref_key:"splitRef",ref:C,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:a(()=>[m.value?(M(),S(tt,{key:0,"organization-id":m.value.organizationId,"organization-data":f.value},null,8,["organization-id","organization-data"])):se("",!0)]),default:a(()=>[L("div",at,[e(y,{clearable:"",maxlength:20,modelValue:V.value,"onUpdate:modelValue":n[0]||(n[0]=O=>V.value=O),placeholder:"左侧树还支持鼠标右键","prefix-icon":i($e)},null,8,["modelValue","prefix-icon"])]),L("div",ot,[e(b,{type:"primary",class:"ele-btn-icon",icon:i(J),onClick:n[1]||(n[1]=O=>{var j;return U(void 0,(j=m.value)==null?void 0:j.organizationId)})},{default:a(()=>n[5]||(n[5]=[D(" 新建 ")])),_:1},8,["icon"]),e(b,{type:"warning",disabled:!m.value,class:"ele-btn-icon",icon:i(ee),onClick:n[2]||(n[2]=O=>U(m.value))},{default:a(()=>n[6]||(n[6]=[D(" 修改 ")])),_:1},8,["disabled","icon"]),e(b,{type:"danger",disabled:!m.value,class:"ele-btn-icon",icon:i(X),onClick:n[3]||(n[3]=O=>k(m.value))},{default:a(()=>n[7]||(n[7]=[D(" 删除 ")])),_:1},8,["disabled","icon"])]),e(h,{loading:_.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:a(()=>[e(P,{ref_key:"treeRef",ref:E,data:f.value,"highlight-current":"","node-key":"organizationId",props:{label:"organizationName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":g,style:{"--ele-tree-item-height":"34px"},onNodeClick:$,onNodeContextmenu:v},{default:a(O=>[e(q,{style:{"margin-right":"6px",color:"#ffd659","font-size":"16px"}},{default:a(()=>{var j;return[(j=O.data.children)!=null&&j.length?(M(),S(i(Ue),{key:0,style:{fill:"currentColor"}})):(M(),S(i(De),{key:1,style:{transform:"scale(0.9) translateY(1px)",color:"#faad14"}}))]}),_:2},1024),L("span",lt,ue(O.data.organizationName),1)]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1}),e(Ge,{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=O=>d.value=O),data:p.value,"organization-id":R.value,"organization-data":f.value,onDone:z},null,8,["modelValue","data","organization-id","organization-data"]),e(fe,{ref_key:"ctxMenuDropdownRef",ref:o,trigger:"contextmenu","trigger-keys":[],"icon-props":{size:15},"popper-options":{strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,-4]}}]},persistent:!1,"component-type":"pro","prevent-contextmenu":!0,"virtual-triggering":!0,"virtual-ref":x.value,disabled:!s.value.length,items:s.value,"popper-style":B,onCommand:c},null,8,["virtual-ref","disabled","items","popper-style"])]),_:1})}}});export{Dt as default};
