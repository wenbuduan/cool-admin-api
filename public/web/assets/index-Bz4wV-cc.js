import{_ as se}from"./index-ByJwDCaU.js";import{a$ as S,b0 as A,r as u,b1 as K,a as H,c as U,o as w,w as i,b as s,aI as Q,aJ as X,u as C,aK as Y,aM as L,aD as R,h as E,aC as z,m as h,_ as j,n as N,b2 as re,b3 as ie,d as $,au as Z,b4 as de,E as ce,b5 as ue,b6 as me,F as J,aF as ee,a5 as O,e as pe,a6 as W,b7 as G,p as fe,t as q,aR as ve,aG as _e,b8 as ge,a7 as ye,aE as be,b9 as T,at as he,ax as xe,ba as P}from"./index-AWZvdbgs.js";import{_ as Ve}from"./index-BWkpR5g6.js";import{_ as te}from"./index-C8O7s9CO.js";import{_ as ke}from"./index-axKr1LNA.js";import{E as Ie}from"./upload-CX_hwZQS.js";import"./progress-DvpGEND2.js";import{u as we}from"./index-5H3zYDd1.js";import{a as oe,_ as Ce,r as $e,u as le,b as Fe,l as ae,c as De,d as Ue,e as Ee,f as Se}from"./index-Dj3tYAP4.js";import{_ as Me}from"./index-B5iZ7B6v.js";import{E as Be}from"./tree-BwbXXe5O.js";import"./index-CPzgPsQF.js";import"./index-CkvP5V7E.js";import"./index-C68LVOzy.js";import"./vuedraggable.umd-D8mshle6.js";import"./tree-select-1lw_Ofap.js";import"./message-box-CRQ1VA6n.js";import"./throttle-BY9opDxO.js";const Te={__name:"folder-edit",props:S({parentId:Number},{modelValue:{type:Boolean},modelModifiers:{}}),emits:S(["done"],["update:modelValue"]),setup(r,{emit:I}){const d=r,g=I,f=A(r,"modelValue"),m=u(null),c=u(!1),[p,_]=K({name:""}),v=H({name:[{required:!0,message:"请输入文件夹名称",type:"string",trigger:"blur"}]}),y=()=>{f.value=!1},x=()=>{var b,o;(o=(b=m.value)==null?void 0:b.validate)==null||o.call(b,e=>{e&&(c.value=!0,oe({...p,parentId:d.parentId,isDirectory:1}).then(t=>{c.value=!1,h.success(t),y(),g("done")}).catch(t=>{c.value=!1,h.error(t.message)}))})},F=()=>{var b,o;_(),(o=(b=m.value)==null?void 0:b.clearValidate)==null||o.call(b)};return(b,o)=>{const e=L,t=Y,n=Q,V=R,D=z;return w(),U(D,{form:"",width:460,title:"新建文件夹",modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=a=>f.value=a),onClosed:F},{footer:i(()=>[s(V,{onClick:y},{default:i(()=>o[3]||(o[3]=[E("取消")])),_:1}),s(V,{type:"primary",loading:c.value,onClick:x},{default:i(()=>o[4]||(o[4]=[E(" 保存 ")])),_:1},8,["loading"])]),default:i(()=>[s(n,{ref_key:"formRef",ref:m,model:C(p),rules:v,"label-width":"100px",onSubmit:o[1]||(o[1]=X(()=>{},["prevent"]))},{default:i(()=>[s(t,{label:"文件夹名称",prop:"name"},{default:i(()=>[s(e,{clearable:"",maxlength:20,modelValue:C(p).name,"onUpdate:modelValue":o[0]||(o[0]=a=>C(p).name=a),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}},Oe={style:{"max-width":"240px"},class:"hidden-sm-and-down"},Ne={__name:"file-toolbar",props:{grid:Boolean,selections:Array,parentId:Number},emits:["update:grid","done"],setup(r,{emit:I}){const d=r,g=I,f=u(""),m=u(!1),c=o=>{if(o.size/1024/1024>100)return h.error("大小不能超过 100MB"),!1;const e=h.loading({message:"上传中..",plain:!0});return we(o).then(t=>{oe({name:t.name,isDirectory:0,parentId:d.parentId,path:t.path,length:t.length,contentType:t.contentType}).then(()=>{e.close(),h.success("上传成功"),v()}).catch(n=>{e.close(),h.error(n.message)})}).catch(t=>{e.close(),h.error(t.message)}),!1},p=()=>{m.value=!0},_=()=>{const o=d.selections;ee.confirm("确定要删除“"+o.map(e=>e.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const e=h.loading({message:"请求中..",plain:!0});$e(o.map(t=>t.id)).then(t=>{e.close(),h.success(t),v()}).catch(t=>{e.close(),h.error(t.message)})}).catch(()=>{})},v=()=>{g("done")},y=()=>{g("update:grid",!d.grid)},x=u(!1),F=()=>{x.value=!0},b=o=>{x.value=!1,o.length&&(console.log(JSON.parse(JSON.stringify(o))),h.success(o.length+"条数据已打印在控制台"))};return(o,e)=>{const t=R,n=Ie,V=L,D=ce,a=ke;return w(),N(J,null,[s(a,{theme:"plain",class:"demo-file-toolbar"},{tools:i(()=>[$("div",Oe,[s(V,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),placeholder:"搜索您的文件","prefix-icon":C(de)},null,8,["modelValue","prefix-icon"])]),s(D,{class:"demo-file-tool",onClick:y},{default:i(()=>[r.grid?(w(),U(C(ue),{key:0})):(w(),U(C(me),{key:1}))]),_:1})]),default:i(()=>[s(n,{action:"","show-file-list":!1,"before-upload":c,style:{display:"inline-block","vertical-align":"middle"}},{default:i(()=>[s(t,{type:"primary",class:"ele-btn-icon",icon:C(re)},{default:i(()=>e[3]||(e[3]=[E(" 上传 ")])),_:1},8,["icon"])]),_:1}),s(t,{class:"ele-btn-icon",icon:C(ie),style:{"margin-left":"12px"},onClick:p},{default:i(()=>e[4]||(e[4]=[$("span",null,"新建",-1),$("span",{class:"hidden-sm-and-down"},"文件夹",-1)])),_:1},8,["icon"]),s(t,{plain:"",type:"danger",icon:C(Z),disabled:!r.selections.length,class:"ele-btn-icon hidden-xs-only",onClick:_},{default:i(()=>e[5]||(e[5]=[E(" 删除 ")])),_:1},8,["icon","disabled"]),s(t,{class:"ele-btn-icon",style:{"margin-left":"12px"},onClick:F},{default:i(()=>e[6]||(e[6]=[$("span",{class:"hidden-sm-and-down"},"打开",-1),$("span",null,"文件选择",-1)])),_:1})]),_:1}),s(Te,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),"parent-id":r.parentId,onDone:v},null,8,["modelValue","parent-id"]),s(Ce,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),onDone:b},null,8,["modelValue"])],64)}}},Re=j(Ne,[["__scopeId","data-v-1f76b57b"]]),je={class:"demo-breadcrumb"},We={class:"demo-breadcrumb-body"},qe={class:"demo-breadcrumb-list"},Ae=["onClick"],Le={class:"hidden-xs-only"},ze={__name:"file-header",props:{directorys:Array,total:Number},emits:["update:directorys"],setup(r,{emit:I}){const d=r,g=I,f=()=>{g("update:directorys",d.directorys.slice(0,d.directorys.length-1))},m=()=>{d.directorys.length&&g("update:directorys",[])},c=p=>{p!==d.directorys.length-1&&g("update:directorys",d.directorys.slice(0,p+1))};return(p,_)=>{const v=pe;return w(),N("div",je,[$("div",We,[r.directorys.length?(w(),U(v,{key:0,type:"primary",class:"demo-breadcrumb-back",onClick:f},{default:i(()=>_[0]||(_[0]=[E(" 返回上一级 ")])),_:1})):O("",!0),$("div",qe,[s(v,{type:r.directorys.length?"primary":void 0,class:"demo-breadcrumb-item"},{default:i(()=>[$("div",{class:W({"demo-breadcrumb-link":!!r.directorys.length}),onClick:m}," 全部文件 ",2),r.directorys.length?(w(),U(v,{key:0,icon:C(G),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):O("",!0)]),_:1},8,["type"]),(w(!0),N(J,null,fe(r.directorys,(y,x)=>(w(),U(v,{key:y.id,class:"demo-breadcrumb-item",type:x!==r.directorys.length-1?"primary":"default"},{default:i(()=>[$("div",{class:W({"demo-breadcrumb-link":x!==r.directorys.length-1}),onClick:F=>c(x)},q(y.name),11,Ae),x!==r.directorys.length-1?(w(),U(v,{key:0,icon:C(G),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):O("",!0)]),_:2},1032,["type"]))),128))])]),$("div",Le,"已全部加载，共 "+q(r.total)+" 个",1)])}}},Je=j(ze,[["__scopeId","data-v-c7c221c0"]]),Ge={__name:"name-edit",props:S({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:S(["done"],["update:modelValue"]),setup(r,{emit:I}){const d=r,g=I,f=A(r,"modelValue"),m=u(null),c=u(!1),[p,_]=K({name:""}),v=H({name:[{required:!0,message:"请输入文件/夹名称",type:"string",trigger:"blur"}]}),y=()=>{f.value=!1},x=()=>{var o,e;(e=(o=m.value)==null?void 0:o.validate)==null||e.call(o,t=>{var n;t&&(c.value=!0,le({...p,id:(n=d.data)==null?void 0:n.id}).then(V=>{c.value=!1,h.success(V),y(),g("done")}).catch(V=>{c.value=!1,h.error(V.message)}))})},F=()=>{var o,e;_(),(e=(o=m.value)==null?void 0:o.clearValidate)==null||e.call(o)},b=()=>{d.data&&(p.name=d.data.name)};return(o,e)=>{const t=L,n=Y,V=Q,D=R,a=z;return w(),U(a,{form:"",width:460,title:"重命名",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),onOpen:b,onClosed:F},{footer:i(()=>[s(D,{onClick:y},{default:i(()=>e[3]||(e[3]=[E("取消")])),_:1}),s(D,{type:"primary",loading:c.value,onClick:x},{default:i(()=>e[4]||(e[4]=[E(" 保存 ")])),_:1},8,["loading"])]),default:i(()=>[s(V,{ref_key:"formRef",ref:m,model:C(p),rules:v,"label-width":"100px",onSubmit:e[1]||(e[1]=X(()=>{},["prevent"]))},{default:i(()=>[s(n,{label:"文件/夹名称",prop:"name"},{default:i(()=>[s(t,{clearable:"",maxlength:20,modelValue:C(p).name,"onUpdate:modelValue":e[0]||(e[0]=l=>C(p).name=l),placeholder:"请输入文件/夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}},Pe={class:"demo-file-move-tree"},Ke={__name:"file-move",props:S({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:S(["done"],["update:modelValue"]),setup(r,{emit:I}){const d=r,g=I,f=A(r,"modelValue"),m=u(!1),c=u(),p=u([]),_=u(!1),v=o=>{c.value=o.id},y=()=>{f.value=!1},x=()=>{var e;const o=c.value;if(o==null){h.error("请选择分组");return}m.value=!0,le({id:(e=d.data)==null?void 0:e.id,parentId:o}).then(t=>{m.value=!1,h.success(t),y(),g("done")}).catch(t=>{m.value=!1,h.error(t.message)})},F=()=>{_.value=!0,ae({isDirectory:1}).then(o=>{const e=[{id:0,name:"未分组"},..._e(ge({data:o,idField:"id",parentIdField:"parentId"}),t=>{var n;return t.id===((n=d.data)==null?void 0:n.id)?void 0:t})];p.value=e,_.value=!1}).catch(o=>{p.value=[],h.error(o.message),_.value=!1})},b=()=>{F(),d.data&&(c.value=d.data.parentId)};return(o,e)=>{const t=ve,n=Be,V=te,D=R,a=z;return w(),U(a,{width:460,title:"移动到",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),onOpen:b},{footer:i(()=>[s(D,{onClick:y},{default:i(()=>e[2]||(e[2]=[E("取消")])),_:1}),s(D,{type:"primary",loading:m.value,onClick:x},{default:i(()=>e[3]||(e[3]=[E(" 保存 ")])),_:1},8,["loading"])]),default:i(()=>[$("div",Pe,[s(n,{data:p.value,nodeKey:"id",props:{label:"name"},"expand-on-click-node":!1,"default-expand-all":!0,onNodeClick:v},{default:i(l=>[e[1]||(e[1]=$("img",{src:Fe,style:{width:"18px",height:"18px","margin-right":"6px"}},null,-1)),$("span",{class:W(["el-tree-node__label",{"is-active":l.data.id===c.value}])},q(l.data.name),3),s(t,{value:!0,"model-value":l.data.id===c.value},null,8,["model-value"])]),_:1},8,["data"])]),_.value?(w(),U(V,{key:0,loading:_.value,style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"var(--el-border-radius-base)",overflow:"hidden"}},null,8,["loading"])):O("",!0)]),_:1},8,["modelValue"])}}},He=j(Ke,[["__scopeId","data-v-f3170264"]]),Qe={class:"demo-file-list"},Xe={key:0,class:"demo-file-list-empty"},Ye={__name:"file-list",props:{parentId:Number,data:{type:Array,required:!0},sort:String,order:String,selections:{type:Array,required:!0},grid:{type:Boolean,required:!0}},emits:["sort-change","update:selections","go-directory","done"],setup(r,{emit:I}){const d=r,g=I,f=u(!1),m=u(),c=u(!1),p=u(),_=u(!1),v=u([]),y=u(0),x=a=>{g("sort-change",a)},F=a=>{g("update:selections",a)},b=a=>{console.log("onItemClick:",JSON.parse(JSON.stringify(a))),a.isDirectory?g("go-directory",a):n(a)?V(a):F(d.selections.includes(a)?d.selections.filter(l=>l!==a):[...d.selections,a])},o=a=>{const{key:l,item:k}=a;l==="open"?k.isDirectory||n(k)?b(k):window.open(k.url):l==="download"?typeof k.downloadUrl=="string"&&window.open(k.downloadUrl):l==="edit"?(m.value=k,f.value=!0):l==="remove"?e(k):l==="move"&&(p.value=k,c.value=!0)},e=a=>{ee.confirm(`确定要删除“${a.name}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const l=h.loading({message:"请求中..",plain:!0});Se(a.id).then(k=>{l.close(),h.success(k),t()}).catch(k=>{l.close(),h.error(k.message)})}).catch(()=>{})},t=()=>{g("done")},n=a=>typeof a.contentType=="string"&&a.contentType.startsWith("image/")&&a.url,V=a=>{const l=d.data.filter(M=>n(M)),k=l.indexOf(a);k!==-1&&(v.value=l.map(M=>M.url),y.value=k,_.value=!0)},D=a=>{if(!a)return[];const l=[{title:"重命名",command:"edit",icon:T(he),divided:!0},{title:"移动到",command:"move",icon:T(xe)},{title:"删除",command:"remove",icon:T(Z),divided:!0,danger:!0}];return a.isDirectory?l.unshift({title:"打开",command:"open"}):n(a)||typeof a.contentType=="string"&&(a.contentType.startsWith("video/")||a.contentType.startsWith("text/")||a.contentType.startsWith("application/pdf")||a.contentType.startsWith("application/json")||a.contentType.startsWith("application/javascript"))?(l[0].divided=!1,l.unshift({title:"下载",command:"download",icon:T(P),divided:!0}),l.unshift({title:"预览",command:"open"})):l.unshift({title:"下载",command:"download",icon:T(P)}),l};return(a,l)=>{const k=Ee,M=be,ne=Me;return w(),N(J,null,[$("div",Qe,[s(k,{data:r.data,grid:r.grid,sort:r.sort,order:r.order,sortable:!0,"box-choose":!0,"selection-type":"checkbox",selections:r.selections,"context-menus":D,"context-menu-props":{menuStyle:{minWidth:"120px"},iconProps:{size:15},popperOptions:{strategy:"fixed"}},icons:C(Ue),"small-icons":C(De),style:ye({minHeight:"400px",minWidth:r.grid?"auto":"456px"}),onItemClick:b,onSortChange:x,"onUpdate:selections":F,onItemContextMenu:o},null,8,["data","grid","sort","order","selections","icons","small-icons","style"]),r.data.length?O("",!0):(w(),N("div",Xe,[s(M,{description:"无数据","image-size":80})]))]),s(ne,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=B=>_.value=B),urlList:v.value,initialIndex:y.value,infinite:!1,"hide-on-click-modal":!0},null,8,["modelValue","urlList","initialIndex"]),s(Ge,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=B=>f.value=B),data:m.value,onDone:t},null,8,["modelValue","data"]),s(He,{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=B=>c.value=B),data:p.value,onDone:t},null,8,["modelValue","data"])],64)}}},Ze=j(Ye,[["__scopeId","data-v-84f3e1ef"]]),et={style:{padding:"8px 16px"}},bt=Object.assign({name:"ExtensionFile"},{__name:"index",setup(r){const I=u(!0),d=u([]),g=u(""),f=u(""),m=u([]),c=u([]),p=u(0),_=u(!0),v=u(0),y=()=>{d.value=[],m.value=[],I.value=!0,ae({sort:f.value?g.value:"",order:f.value,parentId:v.value}).then(t=>{I.value=!1,d.value=t.map(n=>Object.assign(n,{key:n.id,isDirectory:n.isDirectory===1,length:e(n.length)})),p.value=t.length}).catch(t=>{I.value=!1,h.error(t.message)})},x=()=>{y()},F=t=>{var n;f.value=(n=t.order)!=null?n:"",g.value=t.sort,y()},b=t=>{o([...c.value,t])},o=t=>{var n,V;c.value=t,v.value=(V=(n=c.value[c.value.length-1])==null?void 0:n.id)!=null?V:0,y()},e=t=>t==null?"-":t<1024?t+"B":t<1024*1024?(t/1024).toFixed(1)+"KB":t<1024*1024*1024?(t/1024/1024).toFixed(1)+"M":(t/1024/1024/1024).toFixed(1)+"G";return y(),(t,n)=>{const V=te,D=Ve,a=se;return w(),U(a,{"multi-card":!1},{default:i(()=>[s(D,{"body-style":{padding:0}},{default:i(()=>[$("div",et,[s(Re,{grid:_.value,"onUpdate:grid":n[0]||(n[0]=l=>_.value=l),selections:m.value,parentId:v.value,onDone:x},null,8,["grid","selections","parentId"]),s(Je,{total:p.value,directorys:c.value,"onUpdate:directorys":o},null,8,["total","directorys"])]),s(V,{loading:I.value},{default:i(()=>[s(Ze,{grid:_.value,data:d.value,sort:g.value,order:f.value,parentId:v.value,selections:m.value,"onUpdate:selections":n[1]||(n[1]=l=>m.value=l),onSortChange:F,onGoDirectory:b,onDone:x},null,8,["grid","data","sort","order","parentId","selections"])]),_:1},8,["loading"])]),_:1})]),_:1})}}});export{bt as default};
