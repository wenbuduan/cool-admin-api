import{L as he,r as I,I as Z,n as L,o as C,d as y,a5 as W,a1 as Y,a6 as ae,t as X,aJ as J,c as K,w,F as de,p as me,aL as Ie,bS as H,ew as Ne,a7 as ke,h as le,bT as Ge,a as Re,N as it,R as we,J as qe,bW as Fe,bX as Le,u as $,av as We,f5 as ot,U as Te,b as g,f6 as st,E as be,f7 as at,f8 as rt,at as Ae,f9 as ct,bQ as ut,ek as dt,ar as mt,ay as Ke,ej as ft,s as Me,fa as pt,f2 as vt,aD as Ve,b2 as gt,aM as Ue,bP as ht,b6 as yt,aE as bt,b9 as Ce,ax as kt,au as Xe,a$ as ge,b0 as Ee,b1 as Ye,aI as He,aK as Qe,aC as De,aR as xt,bN as Ct,cl as It,fb as wt,b8 as Mt,aH as Pt}from"./index-DwvUEvvU.js";import{_ as St}from"./index-DcIn0UC-.js";import{_ as Tt}from"./index-DX_2uvkE.js";import{E as Je}from"./tree-BBz1QPz_.js";import{_ as Vt}from"./index-DI3EPGNs.js";import{_ as Ot}from"./index-BFwrgEE-.js";import{E as Ze}from"./upload-PSHxxuJK.js";import{E as $t}from"./progress-CRcXxFMs.js";import{u as Et}from"./index-BQLS6Yxm.js";import{E as Dt,_ as jt}from"./index-CrslvNyI.js";import{V as Ft}from"./vuedraggable.umd-o9X7lHt5.js";import{E as Lt}from"./tree-select-Du6CNXH1.js";import{u as Rt}from"./message-box-COaITaxX.js";const At={class:"ele-file-list-item-icon"},Ut=["src"],_t=["title"],Bt=he({name:"FileGridItem",__name:"file-grid-item",props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,ctxMenuDropdownVisible:Boolean},emits:{click:e=>!0,checkChange:e=>!0,contextOpen:e=>!0},setup(e,{emit:h}){const t=e,a=h,r=I(null),k=Z(()=>t.selectionType==="checkbox"||t.selectionType==="radio"),b=Z(()=>!k.value||!t.item?!1:t.selectionType==="checkbox"?!!(t.selections&&t.selections.some(i=>i.key===t.item.key)):!!(t.current&&t.current.key===t.item.key)),m=Z(()=>{var i,s,o;if(t.item.thumbnail)return t.item.thumbnail;if(t.icons){if(t.item.isDirectory)return(i=t.icons.find(n=>n.type==="dir"))==null?void 0:i.icon;if(t.item.name){const n=(s=t.icons.find(v=>v.suffixes?!!v.suffixes.find(x=>!!t.item.name.endsWith(x)):!1))==null?void 0:s.icon;if(n)return n}return(o=t.icons.find(n=>n.type==="file"))==null?void 0:o.icon}}),E=()=>{a("click",t.item)},T=()=>{a("checkChange",t.item)},d=i=>{r.value!=null&&a("contextOpen",{item:t.item,triggerEl:r.value,e:i})};return(i,s)=>(C(),L("div",{class:ae(["ele-file-list-item",{"is-checked":b.value},{"is-active":e.ctxMenuDropdownVisible}]),onClick:J(E,["stop"])},[y("div",{class:"ele-file-list-item-body",onContextmenu:d},[y("div",At,[Y(i.$slots,"icon",{icon:m.value,item:e.item},()=>[y("img",{src:m.value,class:ae({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,Ut)])]),Y(i.$slots,"title",{item:e.item},()=>[y("div",{title:e.item.name,class:"ele-file-list-item-title"},X(e.item.name),9,_t)])],32),k.value?(C(),L("div",{key:0,class:"ele-file-list-item-checkbox",onClick:J(T,["stop"])},s[1]||(s[1]=[y("i",{class:"ele-file-list-checkbox is-checked"},null,-1)]))):W("",!0),y("div",{ref_key:"dropdownTriggerRef",ref:r,class:"ele-file-list-item-dropdown",onClick:s[0]||(s[0]=J(()=>{},["stop"]))},null,512)],2))}}),zt={key:0,class:"ele-file-list-header"},Nt={class:"ele-file-list-body"},Gt=he({name:"FileGrid",__name:"file-grid",props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,checkAllText:String,selectedText:String,ctxMenuDropdownVisible:Boolean,contextMenuFileItem:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextOpen:e=>!0},setup(e,{emit:h}){const t=e,a=h,r=Z(()=>!t.selections||!t.selections.length?t.checkAllText:t.selectedText?t.selectedText.replace(/\{\s*total\s*\}/g,String(t.selections.length)):""),k=()=>{a("checkAllChange")},b=T=>{a("itemClick",T)},m=T=>{a("itemCheckChange",T)},E=T=>{a("itemContextOpen",T)};return(T,d)=>(C(),K(Ne,{class:"ele-file-list"},{default:w(()=>[e.selectionType==="checkbox"?(C(),L("div",zt,[y("div",{class:"ele-file-list-selection",onClick:J(k,["stop"])},[y("i",{class:ae(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}])},null,2),y("div",null,X(r.value),1)])])):W("",!0),y("div",Nt,[(C(!0),L(de,null,me(e.data,i=>(C(),K(Bt,{key:i.key,item:i,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible&&e.contextMenuFileItem===i,onClick:b,onCheckChange:m,onContextOpen:E},Ie({_:2},[me(Object.keys(T.$slots),s=>({name:s,fn:w(o=>[Y(T.$slots,s,H({ref_for:!0},o||{}))])}))]),1032,["item","selectionType","selections","current","icons","ctxMenuDropdownVisible"]))),128))])]),_:3}))}}),qt={key:0,class:"ele-file-list-item-checkbox"},Wt={class:"ele-file-list-item-name"},Kt={class:"ele-file-list-item-icon"},Xt=["src"],Yt=["title"],Ht={key:0,class:"ele-file-list-item-tools"},Qt=he({name:"FileTableItem",__name:"file-table-item",props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,columns:Array,ctxMenuDropdownVisible:Boolean},emits:{click:e=>!0,checkChange:e=>!0,contextOpen:e=>!0},setup(e,{emit:h}){const t=e,a=h,r=I(null),k=Z(()=>t.selectionType==="checkbox"||t.selectionType==="radio"),b=Z(()=>!k.value||!t.item?!1:t.selectionType==="checkbox"?!!(t.selections&&t.selections.some(i=>i.key===t.item.key)):!!(t.current&&t.current.key===t.item.key)),m=Z(()=>{var i,s,o;if(t.item.thumbnail)return t.item.thumbnail;if(t.icons){if(t.item.isDirectory)return(i=t.icons.find(n=>n.type==="dir"))==null?void 0:i.icon;if(t.item.name){const n=(s=t.icons.find(v=>v.suffixes?!!v.suffixes.find(x=>!!t.item.name.endsWith(x)):!1))==null?void 0:s.icon;if(n)return n}return(o=t.icons.find(n=>n.type==="file"))==null?void 0:o.icon}}),E=()=>{a("click",t.item)},T=()=>{a("checkChange",t.item)},d=i=>{r.value!=null&&a("contextOpen",{item:t.item,triggerEl:r.value,e:i})};return(i,s)=>(C(),L("div",{class:ae(["ele-file-list-item",{"is-checked":b.value},{"is-active":e.ctxMenuDropdownVisible}]),onClick:J(E,["stop"])},[y("div",{class:"ele-file-list-item-body",onContextmenu:d},[k.value?(C(),L("div",qt,[y("i",{class:ae(["ele-file-list-checkbox",{"is-radio":e.selectionType==="radio"},{"is-checked":b.value}]),onClick:J(T,["stop"])},null,2)])):W("",!0),y("div",Wt,[y("div",Kt,[Y(i.$slots,"icon",{icon:m.value,item:e.item},()=>[y("img",{src:m.value,class:ae({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,Xt)]),Y(i.$slots,"title",{item:e.item},()=>[y("div",{title:e.item.name,class:"ele-file-list-item-title"},X(e.item.name),9,Yt)])]),i.$slots.tool?(C(),L("div",Ht,[Y(i.$slots,"tool",{item:e.item})])):W("",!0)]),(C(!0),L(de,null,me(e.columns,o=>(C(),L("div",{key:o.prop,style:ke(o.style),class:"ele-file-list-item-cell"},[o.slot&&!["icon","title","tool","contextMenu"].includes(o.slot)&&i.$slots[o.slot]?Y(i.$slots,o.slot,{key:0,item:e.item,col:o}):e.item&&o&&o.prop?(C(),L(de,{key:1},[le(X(e.item[o.prop]),1)],64)):W("",!0)],4))),128))],32),y("div",{ref_key:"dropdownTriggerRef",ref:r,class:"ele-file-list-item-dropdown",onClick:s[0]||(s[0]=J(()=>{},["stop"]))},null,512)],2))}}),ze=he({name:"FileSort",__name:"file-sort",props:{sort:String,order:String,name:{type:String,required:!0}},setup(e){return(h,t)=>(C(),L("i",{class:ae(["ele-file-list-item-sort",{"is-asc":e.name===e.sort&&e.order==="asc"},{"is-desc":e.name===e.sort&&e.order==="desc"}])},null,2))}}),Jt={class:"ele-file-list-header"},Zt={class:"ele-file-list-item"},el={class:"ele-file-list-item-body"},tl={key:0,class:"ele-file-list-item-checkbox"},ll=["onClick"],nl={class:"ele-file-list-body"},il=he({name:"FileTable",__name:"file-table",props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,nameText:String,sizeText:String,timeText:String,sortable:Boolean,sort:String,order:String,columns:Array,ctxMenuDropdownVisible:Boolean,contextMenuFileItem:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextOpen:e=>!0,sortChange:e=>!0},setup(e,{emit:h}){const t=e,a=h,r=Z(()=>t.columns?t.columns:[{title:t.sizeText,prop:"length",style:{width:"120px",flexShrink:0},sortable:t.sortable},{title:t.timeText,prop:"updateTime",style:{width:"180px",flexShrink:0},sortable:t.sortable}]),k=()=>{a("checkAllChange")},b=d=>{a("itemClick",d)},m=d=>{a("itemCheckChange",d)},E=(d,i)=>{i?i.sortable&&a("sortChange",d):t.sortable&&a("sortChange",d)},T=d=>{a("itemContextOpen",d)};return(d,i)=>(C(),K(Ne,{class:"ele-file-list-table"},{default:w(()=>[y("div",Jt,[y("div",Zt,[y("div",el,[e.selectionType==="checkbox"||e.selectionType==="radio"?(C(),L("div",tl,[e.selectionType==="checkbox"?(C(),L("i",{key:0,class:ae(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}]),onClick:J(k,["stop"])},null,2)):W("",!0)])):W("",!0),y("div",{class:ae(["ele-file-list-item-name",{"is-sortable":e.sortable}]),onClick:i[0]||(i[0]=s=>E("name"))},[y("span",null,X(e.nameText),1),e.sortable?(C(),K(ze,{key:0,sort:e.sort,order:e.order,name:"name"},null,8,["sort","order"])):W("",!0)],2),(C(!0),L(de,null,me(r.value,s=>(C(),L("div",{key:s.prop,style:ke(s.headerStyle||s.style),class:ae(["ele-file-list-item-cell",{"is-sortable":s.sortable}]),onClick:o=>E(s.prop,s)},[y("span",null,[s.headerSlot&&!["icon","title","tool","contextMenu"].includes(s.headerSlot)&&d.$slots[s.headerSlot]?Y(d.$slots,s.headerSlot,{key:0,col:s}):(C(),L(de,{key:1},[le(X(s.title),1)],64))]),s.sortable?(C(),K(ze,{key:0,sort:e.sort,order:e.order,name:s.prop},null,8,["sort","order","name"])):W("",!0)],14,ll))),128))])])]),y("div",nl,[(C(!0),L(de,null,me(e.data,s=>(C(),K(Qt,{key:s.key,item:s,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,columns:r.value,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible&&e.contextMenuFileItem===s,onClick:b,onCheckChange:m,onContextOpen:T},Ie({_:2},[me(Object.keys(d.$slots),o=>({name:o,fn:w(n=>[Y(d.$slots,o,H({ref_for:!0},n||{}))])}))]),1032,["item","selectionType","selections","current","icons","columns","ctxMenuDropdownVisible"]))),128))])]),_:3}))}}),_e=[{icon:"/ele-file-list/ic_file_misc_sm.png",type:"file"},{icon:"/ele-file-list/ic_file_folder_sm.png",type:"dir"},{icon:"/ele-file-list/ic_file_code_sm.png",suffixes:[".java",".js",".css",".vue",".ts",".tsx",".scss",".less",".c",".cpp",".cs",".jsp",".php",".asp",".py",".go",".kt",".lua"]},{icon:"/ele-file-list/ic_file_htm_sm.png",suffixes:[".html",".htm"]},{icon:"/ele-file-list/ic_file_text_sm.png",suffixes:[".txt"]},{icon:"/ele-file-list/ic_file_pdf_sm.png",suffixes:[".pdf"]},{icon:"/ele-file-list/ic_file_word_sm.png",suffixes:[".doc",".docx"]},{icon:"/ele-file-list/ic_file_excel_sm.png",suffixes:[".xls",".xlsx"]},{icon:"/ele-file-list/ic_file_ppt_sm.png",suffixes:[".ppt",".pptx"]},{icon:"/ele-file-list/ic_file_visio_sm.png",suffixes:[".vsd"]},{icon:"/ele-file-list/ic_file_ps_sm.png",suffixes:[".psd"]},{icon:"/ele-file-list/ic_file_cad_sm.png",suffixes:[".dwg"]},{icon:"/ele-file-list/ic_file_flash_sm.png",suffixes:[".swf"]},{icon:"/ele-file-list/ic_file_music_sm.png",suffixes:[".mp3",".wav"]},{icon:"/ele-file-list/ic_file_video_sm.png",suffixes:[".mp4",".rmvb",".flv",".avi",".3gp"]},{icon:"/ele-file-list/ic_file_picture_sm.png",suffixes:[".png",".jpg",".jpeg",".gif",".bmp"]},{icon:"/ele-file-list/ic_file_fonts_sm.png",suffixes:[".ttf",".woff"]},{icon:"/ele-file-list/ic_file_bt_sm.png",suffixes:[".torrent"]},{icon:"/ele-file-list/ic_file_android_sm.png",suffixes:[".apk"]},{icon:"/ele-file-list/ic_file_exe_sm.png",suffixes:[".exe"]},{icon:"/ele-file-list/ic_file_ipa_sm.png",suffixes:[".ipa",".dmg"]},{icon:"/ele-file-list/ic_file_zip_sm.png",suffixes:[".zip",".rar",".7z"]}],ol=_e.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),sl=_e.map(e=>({...e,icon:e.icon.replace("/ele-file-list/","https://cdn.eleadmin.com/20200609/")})),al=sl.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),rl={data:{type:Array,required:!0},selectionType:String,selections:Array,current:Object,grid:{type:Boolean,default:!0},sortable:Boolean,sort:String,order:String,icons:{type:Array,default:()=>al},smallIcons:Array,columns:Array,boxChoose:Boolean,contextMenus:[Array,Function],contextMenuProps:Object,locale:Object},cl={itemClick:e=>!0,sortChange:e=>!0,"update:selections":e=>!0,"update:current":e=>!0,itemContextMenu:e=>!0,itemContextOpen:(e,h)=>!0},ul=".ele-file-list-body>.ele-file-list-item",dl=he({name:"EleFileList",__name:"index",props:rl,emits:cl,setup(e,{emit:h}){const t=e,a=h,{lang:r}=Ge("fileList",t),k=Re({top:"0px",left:"0px",width:"0px",height:"0px",display:"none"}),b=I(null),m=it([]),E=I(),T=I(!1),d=I(null),i=Z(()=>!!(t.data&&t.data.length&&t.selections&&t.selections.length&&!t.data.some(c=>{var l,f;return!((f=(l=t.selections)==null?void 0:l.some)!=null&&f.call(l,D=>c.key===D.key))}))),s=Z(()=>!!(!i.value&&t.selections&&t.selections.length)),o=c=>{a("update:selections",c)},n=c=>{a("update:current",c)},v=()=>{if(t.selectionType!=="checkbox")return;if(i.value||t.data==null||!t.data.length){if(!t.selections){o([]);return}const l=t.selections.filter(f=>t.data?!t.data.some(D=>D.key===f.key):!0);o(l);return}if(!t.selections){o([...t.data]);return}const c=t.selections.concat(t.data.filter(l=>t.selections?!t.selections.some(f=>f.key===l.key):!0));o(c)},x=c=>{if(t.selectionType==="radio"){n(t.current&&t.current.key===c.key?null:c);return}if(t.selectionType==="checkbox"){if(!t.selections||!t.selections.length){o([c]);return}if(!t.selections.some(l=>l.key===c.key)){o(t.selections.concat([c]));return}o(t.selections.filter(l=>l.key!==c.key))}},S=c=>{a("itemClick",c)},R=c=>{const l={sort:c};t.order&&c===t.sort?l.order=t.order==="asc"?"desc":null:l.order="asc",a("sortChange",l)},_=c=>{if(d.value!=null){const l={key:c,item:d.value};a("itemContextMenu",l)}},B=c=>{T.value=c,c&&b.value!=null&&d.value!=null&&a("itemContextOpen",b.value,d.value)},z=c=>typeof t.contextMenus=="function"?t.contextMenus(c):t.contextMenus,re=()=>{b.value&&b.value.handleClose()},ne=(c,l)=>{d.value!=null&&d.value===c||(re(),Te(()=>{d.value=c,m.value=z(c)||[],E.value=l,m.value.length&&Te(()=>{b.value&&b.value.handleOpen()})}))},ee=c=>{if(t.contextMenus!=null){if(c.e.preventDefault(),c.e.stopPropagation(),E.value!==c.triggerEl){ne(c.item,c.triggerEl);return}m.value.length&&b.value&&b.value.handleOpen()}},fe=c=>{if(!t.boxChoose||t.selectionType!=="checkbox")return;const l=c.clientX,f=c.clientY,D=c.currentTarget,A=D.getBoundingClientRect(),G=Array.from(D.querySelectorAll(ul)),pe=ot(te=>{const ce=Math.max(te.clientX,A.left),Q=Math.max(te.clientY,A.top),u=Math.min(ce,l)-A.left,p=Math.min(Q,f)-A.top,M=Math.min(Math.abs(ce-l),D.clientWidth-u),P=Math.min(Math.abs(Q-f),D.clientHeight-p);if(k.left=u+"px",k.top=p+"px",k.width=M+"px",k.height=P+"px",k.display="block",M<6||P<6){G.forEach(V=>{V.classList.remove("is-active")});return}c.stopPropagation(),c.preventDefault(),te.stopPropagation(),te.preventDefault(),G.forEach(V=>{const U=V.offsetLeft+V.clientWidth,O=V.offsetTop+V.clientHeight;U>u&&O>p&&V.offsetLeft<u+M&&V.offsetTop<p+P?V.classList.add("is-active"):V.classList.remove("is-active")})},60),ve=te=>{k.display="none";const ce=Math.max(te.clientX,A.left),Q=Math.max(te.clientY,A.top),u=Math.min(ce,l)-A.left,p=Math.min(Q,f)-A.top,M=Math.min(Math.abs(ce-l),D.clientWidth-u),P=Math.min(Math.abs(Q-f),D.clientHeight-p);if(M>6&&P>6){const V=[];G.forEach((U,O)=>{U.classList.contains("is-active")&&(U.classList.remove("is-active"),t.data&&t.data[O]&&V.push(t.data[O]))}),V.length&&o(V)}document.removeEventListener("mousemove",pe),document.removeEventListener("mouseup",ve)};document.addEventListener("mousemove",pe),document.addEventListener("mouseup",ve)};return we([()=>t.grid,()=>t.data],()=>{re(),E.value=null,d.value=null},{deep:!0}),qe(()=>{d.value=null}),(c,l)=>(C(),L("div",{class:"ele-file-list-group",onMousedown:fe},[c.grid?(C(),K(Gt,{key:0,data:c.data,icons:c.icons,selectionType:c.selectionType,selections:c.selections,current:c.current,isCheckAll:i.value,isIndeterminate:s.value,checkAllText:$(r).selectAll,selectedText:$(r).selectTips,ctxMenuDropdownVisible:T.value,contextMenuFileItem:d.value,onCheckAllChange:v,onItemClick:S,onItemCheckChange:x,onItemContextOpen:ee},Ie({_:2},[me(Object.keys(c.$slots),f=>({name:f,fn:w(D=>[Y(c.$slots,f,Fe(Le(D||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","checkAllText","selectedText","ctxMenuDropdownVisible","contextMenuFileItem"])):(C(),K(il,{key:1,data:c.data,icons:c.icons,selectionType:c.selectionType,selections:c.selections,current:c.current,isCheckAll:i.value,isIndeterminate:s.value,nameText:$(r).fileName,sizeText:$(r).fileSize,timeText:$(r).fileTimestamp,sortable:c.sortable,sort:c.sort,order:c.order,columns:c.columns,ctxMenuDropdownVisible:T.value,contextMenuFileItem:d.value,onCheckAllChange:v,onItemClick:S,onItemCheckChange:x,onItemContextOpen:ee,onSortChange:R},Ie({_:2},[me(Object.keys(c.$slots),f=>({name:f,fn:w(D=>[Y(c.$slots,f,Fe(Le(D||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","nameText","sizeText","timeText","sortable","sort","order","columns","ctxMenuDropdownVisible","contextMenuFileItem"])),y("div",{class:"ele-file-list-selector",style:ke(k)},null,4),c.contextMenus?(C(),K(We,H({key:2,persistent:!1,placement:"bottom-start",popperClass:"ele-file-list-item-context",validateEvent:!1},c.contextMenuProps||{},{ref_key:"ctxMenuDropdownRef",ref:b,componentType:"pro",preventContextmenu:!0,trigger:"click",virtualTriggering:!0,virtualRef:E.value,disabled:!m.value.length,items:m.value,onCommand:_,onVisibleChange:B}),null,16,["virtualRef","disabled","items"])):W("",!0)],32))}}),ml=["title"],fl={key:0,class:"ele-upload-thumbnail"},pl={class:"ele-upload-thumbnail-text"},vl={key:0,class:"ele-upload-progress"},gl={class:"ele-upload-text"},hl=["title"],yl={class:"ele-upload-tool-text"},bl={key:1,class:"ele-upload-tools"},kl=["title"],xl={class:"ele-upload-tool-text"},Cl=["title"],Il={class:"ele-upload-tool-text"},wl=["title"],Ml={key:3,class:"ele-upload-handle"},Pl=he({name:"ListItem",__name:"list-item",props:{item:{type:Object,required:!0},readonly:Boolean,disabled:Boolean,sortable:Boolean,imageProps:Object,progressProps:Object,imageObjectUrls:Array,tools:Boolean,listType:String,locale:{type:Object,required:!0}},emits:{itemClick:e=>!0,remove:e=>!0,edit:e=>!0,preview:e=>!0,retry:e=>!0},setup(e,{emit:h}){const t=e,a=h,r=Z(()=>{var i;if(t.item.thumbnail&&t.item.thumbnail!==!0)return t.item.thumbnail;if(t.item.url)return t.item.url;if(!(!t.item.file||!t.imageObjectUrls))return(i=t.imageObjectUrls.find(s=>s.file===t.item.file))==null?void 0:i.url}),k=Z(()=>{const i=t.item.progress;return!i||i<0?0:i>100?100:i}),b=()=>{a("itemClick",t.item)},m=()=>{a("remove",t.item)},E=()=>{a("edit",t.item)},T=()=>{a("preview",t.item)},d=()=>{a("retry",t.item)};return(i,s)=>(C(),L("div",{title:e.item.name,class:"ele-upload-item",onClick:b},[Y(i.$slots,"thumbnail",{item:e.item,imageUrl:r.value},()=>[e.listType==="file"||e.item.thumbnail===!1||!r.value?(C(),L("div",fl,[g($(be),{class:"ele-upload-thumbnail-icon"},{default:w(()=>[g($(st))]),_:1}),y("div",pl,X(e.item.name||e.item.url),1)])):(C(),K($(Dt),H({key:1,fit:"contain",class:"ele-upload-image"},e.imageProps||{},{src:r.value}),null,16,["src"]))]),e.item.status==="uploading"||e.item.status==="exception"?(C(),L("div",vl,[Y(i.$slots,"progress",{item:e.item},()=>[y("div",gl,X(e.item.status=="exception"?e.locale.exception:e.locale.uploading),1),g($($t),H({showText:!1,strokeWidth:e.listType==="file"?2:void 0,status:e.item.status==="exception"?"exception":void 0,class:"ele-upload-progress-bar"},e.progressProps||{},{percentage:k.value}),null,16,["strokeWidth","status","percentage"]),!e.disabled&&e.item.status==="exception"?(C(),L("div",{key:0,title:e.locale.retry,class:"ele-upload-tool ele-upload-retry",onClick:J(d,["stop"])},[g($(be),{class:"ele-upload-tool-icon"},{default:w(()=>[g($(at))]),_:1}),y("div",yl,X(e.locale.retry),1)],8,hl)):W("",!0)])])):e.tools&&!e.readonly&&!e.disabled&&!e.item.readonly?(C(),L("div",bl,[y("div",{title:e.locale.preview,class:"ele-upload-tool",onClick:J(T,["stop"])},[g($(be),{class:"ele-upload-tool-icon"},{default:w(()=>[g($(rt))]),_:1}),y("div",xl,X(e.locale.preview),1)],8,kl),y("div",{title:e.locale.edit,class:"ele-upload-tool",onClick:J(E,["stop"])},[g($(be),{class:"ele-upload-tool-icon"},{default:w(()=>[g($(Ae))]),_:1}),y("div",Il,X(e.locale.edit),1)],8,Cl)])):W("",!0),!e.readonly&&!e.disabled&&!e.item.readonly?(C(),L("div",{key:2,title:e.locale.remove,class:"ele-upload-tool ele-upload-remove",onClick:J(m,["stop"])},[Y(i.$slots,"remove",{item:e.item},()=>[g($(be),{class:"ele-upload-tool-icon"},{default:w(()=>[g($(ct))]),_:1})])],8,wl)):W("",!0),e.sortable?(C(),L("div",Ml)):W("",!0)],8,ml))}}),Sl={modelValue:Array,readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:Boolean,accept:{type:String,default:"image/png,image/jpeg"},itemStyle:[Object,Boolean],buttonStyle:{type:[Object,Boolean],default:null},sortable:{type:[Boolean,Object],default:!0},imageProps:Object,progressProps:Object,previewProps:Object,tools:Boolean,listType:String,beforeUploadClick:Function,beforeItemEdit:Function,beforePreview:Function,locale:Object},Tl={"update:modelValue":e=>!0,itemClick:e=>!0,upload:e=>!0,remove:e=>!0,retry:e=>!0,editUpload:e=>!0,preview:e=>!0},Vl={class:"ele-upload-hidden"},Ol=["accept"],$l=he({name:"EleUploadList",__name:"index",props:Sl,emits:Tl,setup(e,{expose:h,emit:t}){const a=["default","icon"],r=e,k=t,{lang:b}=Ge("upload",r),m=I(!1),E=I([]),T=I(0),d=I([]),i=I(null);let s=null;const o=Z(()=>!r.readonly&&!(typeof r.limit=="number"&&r.limit>0&&r.modelValue!=null&&r.modelValue.length>=r.limit)),n=l=>({key:"ele"+dt(16,10)+String(Date.now()),name:l.name,status:void 0,progress:0,file:l}),v=(l,f)=>{if(l&&l.url)return l.url;const D=l==null?void 0:l.file;if(D!=null&&D.type.startsWith("image")){const A=d.value.find(pe=>pe.file===D);if(A!=null)return A.url;const G=URL.createObjectURL(D);return d.value.push({file:D,url:G}),G}},x=l=>{if(!(r.beforePreview&&r.beforePreview(l)===!1)&&r.modelValue!=null){const f=[];r.modelValue.forEach(A=>{const G=v(A);G&&A.thumbnail!==!1&&f.push({item:A,url:G})});const D=f.findIndex(A=>A.item.key===l.key);if(D!==-1){const A=f.map(G=>G.url);S(A,D)}}},S=(l,f)=>{E.value=l,T.value=f,m.value=!0},R=l=>{k("update:modelValue",l)},_=l=>{if(o.value&&!r.disabled){const f=n(l);k("upload",f)}return!1},B=l=>{r.preview&&x(l),k("itemClick",l)},z=l=>{k("remove",l)},re=l=>{if(r.beforeItemEdit&&r.beforeItemEdit(l)===!1)return;const f=i.value;f!=null&&(s=l,f.value="",f&&f.click())},ne=l=>{x(l),k("preview",l)},ee=l=>{k("retry",l)},fe=l=>{var f;const D=(f=l.target.files)==null?void 0:f[0];if(D!=null&&s!=null){const A={item:s,newItem:n(D)};s=null,k("editUpload",A)}},c=l=>{r.beforeUploadClick&&r.beforeUploadClick(l)===!1&&(l.stopPropagation(),l.preventDefault())};return we(()=>r.modelValue,()=>{r.modelValue!=null&&r.modelValue.forEach(l=>{v(l)})},{immediate:!0,deep:!0}),qe(()=>{d.value.forEach(l=>{URL.revokeObjectURL(l.url)}),d.value=[]}),h({openImagePreview:S}),(l,f)=>(C(),K($(Ft),H({itemKey:"key",animation:300,setData:()=>{},handle:".ele-upload-handle",class:["ele-upload-list",{"is-file-list":l.listType==="file"},{"is-disabled":l.disabled}]},!l.sortable||l.sortable===!0?{}:l.sortable,{modelValue:l.modelValue||[],"onUpdate:modelValue":R}),{item:w(({element:D})=>[g(Pl,{item:D,readonly:l.readonly,disabled:l.disabled,sortable:l.sortable&&!l.readonly&&!l.disabled&&l.limit!==1,imageProps:l.imageProps,progressProps:l.progressProps,imageObjectUrls:d.value,tools:l.tools,listType:l.listType,locale:$(b),style:ke(l.itemStyle),onItemClick:B,onRemove:z,onEdit:re,onPreview:ne,onRetry:ee},Ie({_:2},[me(Object.keys(l.$slots).filter(A=>!a.includes(A)),A=>({name:A,fn:w(G=>[Y(l.$slots,A,Fe(Le(G||{})))])}))]),1032,["item","readonly","disabled","sortable","imageProps","progressProps","imageObjectUrls","tools","listType","locale","style"])]),footer:w(()=>[o.value&&l.buttonStyle!==!1?(C(),L("div",{key:0,style:ke(typeof l.buttonStyle=="boolean"?void 0:l.buttonStyle),class:"ele-upload-item ele-upload-button"},[g($(Ze),{action:"",drag:l.drag,accept:l.accept,multiple:l.multiple,disabled:l.disabled,showFileList:!1,beforeUpload:_},{default:w(()=>[y("div",{class:"ele-upload-button-inner",onClick:c},[Y(l.$slots,"icon",{},()=>[g($(be),{class:"ele-upload-icon"},{default:w(()=>[g($(ut))]),_:1})])])]),_:3},8,["drag","accept","multiple","disabled"])],4)):W("",!0),y("div",Vl,[l.tools?(C(),L("input",{key:0,ref_key:"uploadInputRef",ref:i,type:"file",accept:l.accept,class:"ele-upload-input",onChange:fe},null,40,Ol)):W("",!0),g(jt,H({infinite:!1},l.previewProps||{},{modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=D=>m.value=D),urlList:E.value,initialIndex:T.value}),null,16,["modelValue","urlList","initialIndex"])])]),_:3},16,["class","modelValue"]))}}),$e="/ele-file-list/ic_file_folder.png",El=["title"],Dl={__name:"file-group",props:{groupData:Array},emits:["groupSelect","addBtnClick","moreIconClick","hideGroupCtxMenu"],setup(e,{expose:h,emit:t}){const a=t,r=I(null),k=d=>{a("groupSelect",d,!0)},b=()=>{a("addBtnClick")},m=(d,i)=>{a("moreIconClick",d.currentTarget,i)},E=(d,i)=>{var o,n;if(i.id===0||i.id===-1){a("hideGroupCtxMenu");return}const s=(n=(o=ft(d.currentTarget,"el-tree-node__content"))==null?void 0:o.querySelector)==null?void 0:n.call(o,".file-picker-tree-more");s&&s.click()};return h({setSelectedGroup:d=>{var i,s;(s=(i=r.value)==null?void 0:i.setCurrentKey)==null||s.call(i,d.id)}}),(d,i)=>{const s=be,o=Je,n=Ke;return C(),L(de,null,[g(o,{ref_key:"treeRef",ref:r,data:e.groupData,highlightCurrent:!0,nodeKey:"id",props:{label:"name"},expandOnClickNode:!1,defaultExpandAll:!0,class:"file-picker-left",onNodeClick:k,onNodeContextmenu:E},{default:w(v=>[i[0]||(i[0]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1)),y("span",{class:"el-tree-node__label",title:v.data.name},X(v.data.name),9,El),v.data.id!==0&&v.data.id!==-1?(C(),K(s,{key:0,class:"file-picker-tree-more",onClick:J(x=>m(x,v.data),["stop"])},{default:w(()=>[g($(mt),{style:{transform:"scale(1.1)"}})]),_:2},1032,["onClick"])):W("",!0)]),_:1},8,["data"]),g(n,{type:"primary",underline:!1,class:"file-picker-left-add",onClick:b},{default:w(()=>i[1]||(i[1]=[le(" 添加分组 ")])),_:1})],64)}}};async function jl(e){const h=await Me.get("/system/user-file/page",{params:e});return h.data.code===0?h.data.data:Promise.reject(new Error(h.data.message))}async function Fl(e){const h=await Me.get("/system/user-file",{params:e});return h.data.code===0&&h.data.data?h.data.data:Promise.reject(new Error(h.data.message))}async function et(e){const h=await Me.post("/system/user-file",e);return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}async function tt(e){const h=await Me.put("/system/user-file",e);return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}async function Ll(e){const h=await Me.delete("/system/user-file/"+e);return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}async function dn(e){const h=await Me.delete("/system/user-file/batch",{data:e});return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}const Rl={class:"file-picker-right"},Al={class:"file-picker-right-header"},Ul={class:"file-picker-right-title"},_l={key:1},Bl={__name:"file-selections",props:{fileSelections:Array,limit:Number,selectionListProps:Object,baseIndex:Number},emits:["clearSelections","removeItem"],setup(e,{expose:h,emit:t}){const a=e,r=t,{mobileDevice:k}=pt(),b=I(null),m=I([]),E=Re({zIndex:a.baseIndex}),T=o=>{const n=a.fileSelections.find(v=>v.key===o.key);n&&r("removeItem",n)},d=()=>{r("clearSelections")},i=()=>{const o=[];return m.value.forEach(n=>{const v=a.fileSelections.find(x=>x.key===n.key);v&&o.push(v)}),o},s=(o,n)=>{b.value&&b.value.openImagePreview(o,n)};return we(()=>a.fileSelections,o=>{if(!o||!o.length){m.value.length&&(m.value=[]);return}const n=m.value.filter(v=>o.some(x=>x.key===v.key));o.forEach(v=>{n.some(x=>x.key===v.key)||n.push({key:v.key,name:v.name,url:v.thumbnail,status:"done"})}),vt(m.value.map(v=>v.key),n.map(v=>v.key),!0)&&(m.value=n)},{immediate:!0,deep:!0}),we(()=>a.baseIndex,o=>{E.zIndex=o}),h({getSelections:i,openImagePreview:s}),(o,n)=>{const v=Ke,x=$l;return C(),L("div",Rl,[y("div",Al,[y("div",Ul,[n[2]||(n[2]=y("span",null,"已选择 ",-1)),y("span",null,X(e.fileSelections.length),1),e.limit?(C(),L(de,{key:0},[n[1]||(n[1]=y("span",null," / ",-1)),y("span",null,X(e.limit),1)],64)):(C(),L("span",_l," 个"))]),g(v,{type:"danger",underline:!1,class:"file-picker-right-clear",onClick:d},{default:w(()=>n[3]||(n[3]=[le(" 清空 ")])),_:1})]),g(x,H({limit:e.limit,previewProps:E},e.selectionListProps||{},{ref_key:"uploadListRef",ref:b,modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=S=>m.value=S),buttonStyle:!1,sortable:!$(k),onRemove:T}),null,16,["limit","previewProps","modelValue","sortable"])])}}},zl={class:"file-picker-main"},Nl={class:"file-picker-body"},Gl={class:"file-picker-toolbar"},ql={class:"file-picker-search"},Wl={__name:"file-list",props:{limit:Number,fileLimit:Number,accept:String,params:Object,fileListProps:Object,selectionListProps:Object,emptyProps:Object,paginationProps:Object,baseIndex:Number,messageIns:[Object,Function]},emits:["queryStart","queryDone","renameFile","moveFile","removeFile","fileItemContextOpen"],setup(e,{expose:h,emit:t}){const a=e,r=t,k=I(),b=I([]),m=I([]),E=I(),T=I(1),d=I(""),i=I(1),s=I(24),o=I(0),n=I(!1),v=[{icon:ht,value:0,iconStyle:{transform:"scale(0.9)"}},{icon:yt,value:1}],x=I(),S=Re({menuStyle:{minWidth:"120px"},iconProps:{size:15},popperOptions:{strategy:"fixed"},zIndex:a.baseIndex}),R=(u,p)=>{var M,P;if(a.limit&&a.limit>1&&(p?u.length>=a.limit:u.length>a.limit))return(P=(M=a.messageIns)==null?void 0:M.error)==null||P.call(M,`最多只能选择 ${a.limit} 个`),!1},_=u=>{if(R(u)!==!1){m.value=u;return}a.limit&&a.limit>1&&(m.value=u.slice(0,a.limit))},B=()=>{m.value=[],E.value=void 0},z=()=>x.value?(x.value.getSelections()||[]).map(p=>p.userFile):[],re=u=>{if(a.limit===1){B();return}const p=m.value.findIndex(M=>M.key===u.key);p!==-1&&m.value.splice(p,1)},ne=()=>{Q({page:1})},ee=u=>{i.value!==u&&(i.value=u,Q())},fe=u=>{if(s.value!==u){i.value=1,s.value=u;const p=Math.ceil(o.value/u);p&&i.value>p&&(i.value=p),Q()}},c=u=>{if(a.limit===1){E.value=u;return}const p=m.value.findIndex(M=>M.key===u.key);if(p!==-1){m.value.splice(p,1);return}R(m.value,!0)!==!1&&m.value.push(u)},l=u=>{const{key:p,item:M}=u,P=M.userFile;if(p==="preview"){if(!M.thumbnail){window.open(M.url);return}const V=b.value.filter(q=>!!q.thumbnail),U=V.map(q=>q.url),O=V.indexOf(M);O!==-1&&x.value&&x.value.openImagePreview(U,O)}else p==="rename"?r("renameFile",P,!0):p==="move"?r("moveFile",P,!0):p==="remove"&&r("removeFile",P,!0)},f=u=>{const p=[{title:"重命名",command:"rename",icon:Ce(Ae)},{title:"移动到",command:"move",icon:Ce(kt)},{title:"删除",command:"remove",icon:Ce(Xe),divided:!0,danger:!0}];return u.thumbnail?(p[0].divided=!0,p.unshift({title:"预览",command:"preview"})):(p[0].divided=!0,p.unshift({title:"打开",command:"preview"})),p},D=()=>{r("fileItemContextOpen")},A=u=>{var p,M,P,V,U,O;if(u){if(a.accept==="image/*"){if(!u.type.startsWith("image")){(M=(p=a.messageIns)==null?void 0:p.error)==null||M.call(p,"只能选择图片");return}}else if(a.accept===".xls,.xlsx"&&!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(u.type)){(V=(P=a.messageIns)==null?void 0:P.error)==null||V.call(P,"只能选择 excel 文件");return}if(a.fileLimit&&u.size/1024/1024>a.fileLimit){(O=(U=a.messageIns)==null?void 0:U.error)==null||O.call(U,`大小不能超过 ${a.fileLimit}MB`);return}return!0}},G=u=>{var p,M;if(A(u)){const P=(M=(p=a.messageIns)==null?void 0:p.loading)==null?void 0:M.call(p,{message:"上传中..",plain:!0,mask:!0});Et(u).then(V=>{et({name:V.name,isDirectory:0,parentId:k.value,path:V.path,length:V.length,contentType:V.contentType}).then(()=>{var U,O,q;(U=P==null?void 0:P.close)==null||U.call(P),(q=(O=a.messageIns)==null?void 0:O.success)==null||q.call(O,"上传成功"),Q()}).catch(U=>{var O,q,xe;(O=P==null?void 0:P.close)==null||O.call(P),(xe=(q=a.messageIns)==null?void 0:q.error)==null||xe.call(q,U.message)})}).catch(V=>{var U,O,q;(U=P==null?void 0:P.close)==null||U.call(P),(q=(O=a.messageIns)==null?void 0:O.error)==null||q.call(O,V.message)})}return!1},pe=u=>{const M=u.currentTarget.scrollTop;n.value=M>1},ve=()=>{r("queryDone")},te=u=>typeof u.contentType=="string"&&u.contentType.startsWith("image/")&&u.url,ce=u=>u==null?"-":u<1024?u+"B":u<1024*1024?(u/1024).toFixed(1)+"KB":u<1024*1024*1024?(u/1024/1024).toFixed(1)+"M":(u/1024/1024/1024).toFixed(1)+"G",Q=u=>{r("queryStart"),u&&(u.page!=null&&(i.value=u.page),u.parentId!=null&&(k.value=u.parentId),u.name!=null&&(d.value=u.name));const p=k.value;jl({page:i.value,limit:s.value,parentId:p===-1?void 0:p,name:d.value,isDirectory:0,...a.params||{}}).then(M=>{var P,V,U;if(!((P=M==null?void 0:M.list)!=null&&P.length)&&(M!=null&&M.count)){const O=Math.ceil(M.count/s.value);if(O&&i.value>O){Q({page:O});return}}o.value=(M==null?void 0:M.count)||0,b.value=((U=(V=M==null?void 0:M.list)==null?void 0:V.map)==null?void 0:U.call(V,O=>({key:O.id,name:O.name,url:O.url,thumbnail:te(O)?O.url:void 0,length:ce(O.length),updateTime:O.updateTime,isDirectory:O.isDirectory===1,userFile:O})))||[],ve()}).catch(M=>{var P,V;b.value=[],(V=(P=a.messageIns)==null?void 0:P.error)==null||V.call(P,M.message),ve()})};return we(()=>a.limit,()=>{B()}),we(()=>a.baseIndex,u=>{S.zIndex=u}),h({queryData:Q,clearSelections:B,getSelections:z}),(u,p)=>{const M=Ve,P=Ze,V=Ue,U=Ot,O=dl,q=Vt,xe=bt;return C(),L("div",zl,[y("div",Nl,[y("div",Gl,[g(P,{action:"",accept:e.accept,showFileList:!1,beforeUpload:G},{default:w(()=>[g(M,{type:"primary",class:"ele-btn-icon",icon:$(gt)},{default:w(()=>p[3]||(p[3]=[le(" 上传 ")])),_:1},8,["icon"])]),_:1},8,["accept"]),y("div",ql,[g(V,{clearable:!0,modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=ye=>d.value=ye),placeholder:"请输入文件名",onClear:ne,onChange:ne},null,8,["modelValue"]),g(M,{type:"primary",onClick:ne},{default:w(()=>p[4]||(p[4]=[le("搜索")])),_:1})]),g(U,{modelValue:T.value,"onUpdate:modelValue":p[1]||(p[1]=ye=>T.value=ye),items:v,validateEvent:!1},null,8,["modelValue"])]),b.value.length?(C(),L(de,{key:0},[y("div",{class:"file-picker-file-list",onScroll:pe},[g(O,H({boxChoose:!0,icons:$(ol),smallIcons:$(_e),contextMenuProps:S},e.fileListProps||{},{data:b.value,grid:T.value===1,selectionType:e.limit===1?"radio":"checkbox",selections:m.value,current:E.value,"onUpdate:current":p[2]||(p[2]=ye=>E.value=ye),contextMenus:f,class:[{"is-ping-top":n.value}],onItemClick:c,onItemContextMenu:l,"onUpdate:selections":_,onItemContextOpen:D}),null,16,["icons","smallIcons","contextMenuProps","data","grid","selectionType","selections","current","class"])],32),g(q,H({size:"small",teleported:!1,pageSizes:[18,24,30,36,42],layout:"total,prev,pager,next,sizes"},e.paginationProps||{},{currentPage:i.value,pageSize:s.value,total:o.value,"onUpdate:currentPage":ee,"onUpdate:pageSize":fe}),null,16,["currentPage","pageSize","total"])],64)):(C(),K(xe,H({key:1,imageSize:80,description:"无数据"},e.emptyProps||{}),null,16))]),g(Bl,{ref_key:"fileSelectionsRef",ref:x,fileSelections:e.limit===1?E.value?[E.value]:[]:m.value,limit:e.limit,selectionListProps:e.selectionListProps,baseIndex:e.baseIndex,onClearSelections:B,onRemoveItem:re},null,8,["fileSelections","limit","selectionListProps","baseIndex"])])}}},Kl={__name:"file-group-add",props:ge({parentId:Number,groupData:Array,modalProps:Object,baseIndex:Number,messageIns:[Object,Function]},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ge(["done"],["update:modelValue"]),setup(e,{emit:h}){const t=e,a=h,r=Ee(e,"modelValue"),k=I(null),b=I(!1),[m,E]=Ye({name:"",parentId:void 0}),T=()=>{r.value=!1},d=()=>{var o,n;(n=(o=k.value)==null?void 0:o.validate)==null||n.call(o,v=>{v&&(b.value=!0,et({...m,isDirectory:1}).then(x=>{var S,R;b.value=!1,(R=(S=t.messageIns)==null?void 0:S.success)==null||R.call(S,x),T(),a("done")}).catch(x=>{var S,R;b.value=!1,(R=(S=t.messageIns)==null?void 0:S.error)==null||R.call(S,x.message)}))})},i=()=>{var o,n;E(),(n=(o=k.value)==null?void 0:o.clearValidate)==null||n.call(o)},s=()=>{t.parentId!=null&&(m.parentId=t.parentId)};return(o,n)=>{const v=Lt,x=Qe,S=Ue,R=He,_=Ve,B=De;return C(),K(B,H({form:!0,width:460,title:"添加分组",zIndex:e.baseIndex,appendToBody:!1},e.modalProps||{},{modelValue:r.value,"onUpdate:modelValue":n[3]||(n[3]=z=>r.value=z),onOpen:s,onClosed:i}),{footer:w(()=>[g(_,{onClick:T},{default:w(()=>n[6]||(n[6]=[le("取消")])),_:1}),g(_,{type:"primary",loading:b.value,onClick:d},{default:w(()=>n[7]||(n[7]=[le(" 保存 ")])),_:1},8,["loading"])]),default:w(()=>[g(R,{ref_key:"formRef",ref:k,model:$(m),labelWidth:"82px",onSubmit:n[2]||(n[2]=J(()=>{},["prevent"]))},{default:w(()=>[g(x,{label:"上级分组",prop:"parentId"},{default:w(()=>[g(v,{modelValue:$(m).parentId,"onUpdate:modelValue":n[0]||(n[0]=z=>$(m).parentId=z),data:e.groupData.filter(z=>z.id!==0&&z.id!==-1),nodeKey:"id",props:{label:"name"},clearable:!0,checkStrictly:!0,defaultExpandAll:!0,placeholder:"请选择上级分组",popperOptions:{strategy:"fixed"},teleported:!1,class:"ele-fluid"},Ie({default:w(({data:z})=>[n[4]||(n[4]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1)),y("span",null,X(z.name),1)]),_:2},[$(m).parentId?{name:"prefix",fn:w(()=>[n[5]||(n[5]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1))]),key:"0"}:void 0]),1032,["modelValue","data"])]),_:1}),g(x,{label:"分组名称",prop:"name",rules:[{required:!0,message:"请输入分组名称",type:"string",trigger:"blur"}]},{default:w(()=>[g(S,{maxlength:20,clearable:!0,modelValue:$(m).name,"onUpdate:modelValue":n[1]||(n[1]=z=>$(m).name=z),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},16,["zIndex","modelValue"])}}},Xl={__name:"file-rename",props:ge({data:Object,modalProps:Object,baseIndex:Number,messageIns:[Object,Function]},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ge(["done"],["update:modelValue"]),setup(e,{emit:h}){const t=e,a=h,r=Ee(e,"modelValue"),k=I(null),b=I(!1),[m,E]=Ye({name:""}),T=()=>{r.value=!1},d=()=>{var o,n;(n=(o=k.value)==null?void 0:o.validate)==null||n.call(o,v=>{var x;v&&(b.value=!0,tt({...m,id:(x=t.data)==null?void 0:x.id}).then(S=>{var R,_;b.value=!1,(_=(R=t.messageIns)==null?void 0:R.success)==null||_.call(R,S),T(),a("done")}).catch(S=>{var R,_;b.value=!1,(_=(R=t.messageIns)==null?void 0:R.error)==null||_.call(R,S.message)}))})},i=()=>{var o,n;E(),(n=(o=k.value)==null?void 0:o.clearValidate)==null||n.call(o)},s=()=>{t.data&&(m.name=t.data.name)};return(o,n)=>{const v=Ue,x=Qe,S=He,R=Ve,_=De;return C(),K(_,H({form:!0,width:460,title:"重命名",zIndex:e.baseIndex,appendToBody:!1},e.modalProps||{},{modelValue:r.value,"onUpdate:modelValue":n[2]||(n[2]=B=>r.value=B),onOpen:s,onClosed:i}),{footer:w(()=>[g(R,{onClick:T},{default:w(()=>n[3]||(n[3]=[le("取消")])),_:1}),g(R,{type:"primary",loading:b.value,onClick:d},{default:w(()=>n[4]||(n[4]=[le(" 保存 ")])),_:1},8,["loading"])]),default:w(()=>[g(S,{ref_key:"formRef",ref:k,model:$(m),labelWidth:"82px",onSubmit:n[1]||(n[1]=J(()=>{},["prevent"]))},{default:w(()=>[g(x,{label:`${e.data&&e.data.isDirectory?"分组":"文件"}名称`,prop:"name",rules:[{required:!0,message:`请输入${e.data&&e.data.isDirectory?"分组":"文件"}名称`,type:"string",trigger:"blur"}]},{default:w(()=>[g(v,{maxlength:20,clearable:!0,modelValue:$(m).name,"onUpdate:modelValue":n[0]||(n[0]=B=>$(m).name=B),placeholder:`请输入${e.data&&e.data.isDirectory?"分组":"文件"}名称`},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},16,["zIndex","modelValue"])}}},Yl={class:"file-picker-move-wrapper"},Hl={__name:"file-move",props:ge({data:Object,groupData:Array,modalProps:Object,baseIndex:Number,messageIns:[Object,Function]},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ge(["done"],["update:modelValue"]),setup(e,{emit:h}){const t=e,a=h,r=Ee(e,"modelValue"),k=I(!1),b=I(),m=i=>{b.value=i.id},E=()=>{r.value=!1},T=()=>{var s,o,n;const i=b.value;if(i==null){(o=(s=t.messageIns)==null?void 0:s.error)==null||o.call(s,"请选择分组");return}k.value=!0,tt({id:(n=t.data)==null?void 0:n.id,parentId:i}).then(v=>{var x,S;k.value=!1,(S=(x=t.messageIns)==null?void 0:x.success)==null||S.call(x,v),E(),a("done")}).catch(v=>{var x,S;k.value=!1,(S=(x=t.messageIns)==null?void 0:x.error)==null||S.call(x,v.message)})},d=()=>{t.data&&(b.value=t.data.parentId)};return(i,s)=>{const o=xt,n=Je,v=Ve,x=De;return C(),K(x,H({width:460,title:"移动到",zIndex:e.baseIndex,appendToBody:!1},e.modalProps||{},{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=S=>r.value=S),onOpen:d}),{footer:w(()=>[g(v,{onClick:E},{default:w(()=>s[2]||(s[2]=[le("取消")])),_:1}),g(v,{type:"primary",loading:k.value,onClick:T},{default:w(()=>s[3]||(s[3]=[le(" 保存 ")])),_:1},8,["loading"])]),default:w(()=>[y("div",Yl,[g(n,{data:e.groupData.filter(S=>S.id!==-1),nodeKey:"id",props:{label:"name"},expandOnClickNode:!1,defaultExpandAll:!0,class:"file-picker-move-tree",onNodeClick:m},{default:w(S=>[s[1]||(s[1]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1)),y("span",{class:ae(["el-tree-node__label",{"is-active":S.data.id===b.value}])},X(S.data.name),3),g(o,{value:!0,modelValue:S.data.id===b.value},null,8,["modelValue"])]),_:1},8,["data"])])]),_:1},16,["zIndex","modelValue"])}}},mn=Object.assign({name:"FilePicker"},{__name:"index",props:ge({title:{type:String,default:"文件选择"},modalProps:Object,limit:Number,fileLimit:{type:Number,default:100},accept:String,params:Object,groupDropdownProps:Object,groupAddModalProps:Object,renameModalProps:Object,moveModalProps:Object,fileListProps:Object,selectionListProps:Object,emptyProps:Object,paginationProps:Object,baseIndex:Number},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ge(["done","close"],["update:modelValue"]),setup(e,{expose:h,emit:t}){const a=e,r=t,k=Ee(e,"modelValue"),{mobile:b}=Ct(),m=I(null),E=I(null),T=I(null),d=I(!1),i=I([]),s=I(null),o=I(!1),n=I(null),v=I(!1),x=I(),S=I(!1),R=I(null),_=I(!1),B=I(),z=I(),re=I([]);let ne=null;const ee=Z(()=>{if(a.baseIndex!=null)return a.baseIndex+100}),fe=Z(()=>ee.value==null?3e3:ee.value+100),c=I(),l=I(),f=It({inner:!0,appendTo:c}),D=Rt({appendTo:l}),A=j=>[{title:"重命名",command:"rename",icon:Ce(Ae)},{title:"添加分组",command:"add",icon:Ce(wt),iconStyle:{transform:"scale(0.92)"}},{title:"删除分组",command:"remove",icon:Ce(Xe),divided:!0,danger:!0}],G=()=>{B.value&&B.value.handleClose()},pe=(j,F)=>{ne=F,!(j==null||z.value===j)&&(G(),Te(()=>{re.value=A()||[],z.value=j,re.value.length&&Te(()=>{B.value&&B.value.handleOpen()})}))},ve=(j,F)=>{var oe,se,ie,ue;s.value!=null&&b.value&&((se=(oe=m.value)==null?void 0:oe.toggleCollapse)==null||se.call(oe,!0)),j&&j.id!=null&&(F||(ue=(ie=E.value)==null?void 0:ie.setSelectedGroup)==null||ue.call(ie,j),(s.value==null||s.value.id!==j.id)&&(s.value=j,O(j.id)))},te=()=>{_.value?O():U()},ce=j=>{_.value=!1,x.value=j?j.id:void 0,v.value=!0},Q=(j,F)=>{_.value=!!F,n.value=j,o.value=!0},u=(j,F)=>{_.value=!!F,R.value=j,S.value=!0},p=(j,F)=>{var oe,se,ie,ue,Oe;_.value=!!F,(Oe=(ue=(ie=(se=(oe=D==null?void 0:D.confirm)==null?void 0:oe.call(D,`确定要删除“${j.name}”吗?`,"系统提示",{type:"warning",draggable:!0}))==null?void 0:se.then)==null?void 0:ie.call(se,()=>{var Be;const N=(Be=f==null?void 0:f.loading)==null?void 0:Be.call(f,{message:"请求中..",plain:!0});Ll(j.id).then(je=>{var Pe,Se;(Pe=N==null?void 0:N.close)==null||Pe.call(N),(Se=f==null?void 0:f.success)==null||Se.call(f,je),te()}).catch(je=>{var Pe,Se;(Pe=N==null?void 0:N.close)==null||Pe.call(N),(Se=f==null?void 0:f.error)==null||Se.call(f,je.message)})}))==null?void 0:ue.catch)==null||Oe.call(ue,()=>{})},M=j=>{ne!=null&&(j==="rename"?Q(ne):j==="add"?ce(ne):j==="remove"&&p(ne))},P=()=>{d.value=!1},V=()=>{d.value=!0},U=()=>{V(),Fl({isDirectory:1}).then(j=>{const F=[{id:-1,name:"全部"},{id:0,name:"未分组"},...Mt({data:j,idField:"id",parentIdField:"parentId"})];i.value=F;const oe=s.value==null?void 0:Pt(F,se=>{var ie;return se.id===((ie=s.value)==null?void 0:ie.id)});s.value=null,Te(()=>{ve(oe||F[0])})}).catch(j=>{i.value=[],f.error(j.message),P()})},O=j=>{V();const F=j==null?void 0:{page:1,name:"",parentId:j};T.value&&T.value.queryData(F)},q=()=>{T.value&&T.value.clearSelections()},xe=()=>{q(),U()},ye=()=>{q(),r("close")},lt=()=>{k.value=!1},nt=()=>{var j,F;V(),r("done",((F=(j=T.value)==null?void 0:j.getSelections)==null?void 0:F.call(j))||[])};return h({hideLoading:P}),(j,F)=>{const oe=Tt,se=St,ie=We,ue=Ve,Oe=De;return C(),K(Oe,H({width:988,title:e.title,position:"center",zIndex:e.baseIndex},e.modalProps||{},{modelValue:k.value,"onUpdate:modelValue":F[5]||(F[5]=N=>k.value=N),class:"file-picker-modal",onOpen:xe,onClose:ye}),{footer:w(()=>[g(ue,{onClick:lt},{default:w(()=>F[6]||(F[6]=[le("取消")])),_:1}),g(ue,{type:"primary",onClick:nt},{default:w(()=>F[7]||(F[7]=[le("确定")])),_:1})]),default:w(()=>[g(oe,{ref_key:"splitRef",ref:m,space:"0px",size:"186px",flexTable:!0,allowCollapse:$(b),customStyle:{borderWidth:"0 1px 0 0"},class:"file-picker-wrapper"},{body:w(()=>[g(Wl,{ref_key:"fileListRef",ref:T,limit:e.limit,fileLimit:e.fileLimit,accept:e.accept,params:e.params,fileListProps:e.fileListProps,selectionListProps:e.selectionListProps,emptyProps:e.emptyProps,paginationProps:e.paginationProps,baseIndex:ee.value,messageIns:$(f),onQueryStart:V,onQueryDone:P,onRenameFile:Q,onMoveFile:u,onRemoveFile:p,onFileItemContextOpen:G},null,8,["limit","fileLimit","accept","params","fileListProps","selectionListProps","emptyProps","paginationProps","baseIndex","messageIns"])]),default:w(()=>[g(Dl,{ref_key:"fileGroupRef",ref:E,groupData:i.value,onGroupSelect:ve,onAddBtnClick:F[0]||(F[0]=N=>ce()),onMoreIconClick:pe,onHideGroupCtxMenu:F[1]||(F[1]=N=>G())},null,8,["groupData"])]),_:1},8,["allowCollapse"]),g(se,{loading:d.value,class:"file-picker-loading"},null,8,["loading"]),g(Kl,{modelValue:v.value,"onUpdate:modelValue":F[2]||(F[2]=N=>v.value=N),parentId:x.value,groupData:i.value,modalProps:e.groupAddModalProps,baseIndex:ee.value,messageIns:$(f),onDone:te},null,8,["modelValue","parentId","groupData","modalProps","baseIndex","messageIns"]),g(Xl,{modelValue:o.value,"onUpdate:modelValue":F[3]||(F[3]=N=>o.value=N),data:n.value,modalProps:e.renameModalProps,baseIndex:ee.value,messageIns:$(f),onDone:te},null,8,["modelValue","data","modalProps","baseIndex","messageIns"]),g(Hl,{modelValue:S.value,"onUpdate:modelValue":F[4]||(F[4]=N=>S.value=N),data:R.value,groupData:i.value,modalProps:e.moveModalProps,baseIndex:ee.value,messageIns:$(f),onDone:te},null,8,["modelValue","data","groupData","modalProps","baseIndex","messageIns"]),g(ie,H({triggerKeys:[],persistent:!1,validateEvent:!1,zIndex:ee.value,placement:"bottom-end",iconProps:{size:15},popperOptions:{strategy:"fixed",modifiers:[{name:"offset",options:{offset:[6,6]}}]}},e.groupDropdownProps||{},{ref_key:"ctxMenuDropdownRef",ref:B,trigger:"click",componentType:"pro",preventContextmenu:!0,virtualTriggering:!0,virtualRef:z.value,items:re.value,onCommand:M}),null,16,["zIndex","virtualRef","items"]),y("div",{ref_key:"messageWrapRef",ref:c,class:"ele-message-wrapper",style:ke({position:"fixed",zIndex:fe.value})},null,4),y("div",{ref_key:"messageBoxWrapRef",ref:l,class:"ele-message-box-wrapper",style:ke({position:"fixed",zIndex:fe.value})},null,4)]),_:1},16,["title","zIndex","modelValue"])}}});export{mn as _,et as a,$e as b,_e as c,ol as d,dl as e,Ll as f,$l as g,Fl as l,dn as r,tt as u};
