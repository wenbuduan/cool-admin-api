import{_ as _e}from"./index-MJsbY79C.js";import{b1 as Z,c as f,o as _,w as l,b as t,aI as ee,aJ as te,dc as ye,aK as le,aM as ne,u as a,aD as J,h as y,r as T,I as ae,aH as ge,aL as be,E as H,a8 as W,a5 as z,d as O,t as A,b8 as oe,m as R,a$ as Q,b0 as ve,gU as N,v as Ve,aR as xe,k as re,f as he,g as L,aW as Te,aC as Ie,U as X,ay as Ee,l as ke,bR as Ce,eq as Me,gV as Ue,aF as Se}from"./index-n6Orl0xG.js";import{_ as se}from"./index-DLejwlYb.js";import{_ as Ne}from"./index-BBd_ea8k.js";import"./index-xWcpkv5n.js";import"./index-DJBR385J.js";import"./index-DBPDFNRg.js";import"./virtual-list-Dy04eCLP.js";import"./index-C5FeiaYW.js";import"./index-Z0s6jAnH.js";import{a as ie,E as ue}from"./col-CI8qhQxM.js";import{E as $e}from"./input-number-w9GRKpek.js";import{a as De}from"./index-BF5afUAx.js";import"./tree-DjMbQr5I.js";import{E as Re}from"./tree-select-CIqUjQHp.js";import{l as de,u as we,a as Fe,r as ze}from"./index-CTy0Ul8l.js";import"./isArrayLikeObject-CVZfMnll.js";import"./vuedraggable.umd-oUa5xh2t.js";import"./index-tsWABA3i.js";import"./index-BZV4jAA3.js";const Be={__name:"menu-search",emits:["search"],setup(M,{emit:I}){const $=I,[p,C]=Z({title:"",path:"",authority:""}),g=()=>{$("search",{...p})},V=()=>{C(),g()};return(E,d)=>{const e=ne,v=le,x=ue,U=J,k=ie,w=ee,F=se;return _(),f(F,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[t(w,{"label-width":"72px",onKeyup:ye(g,["enter"]),onSubmit:d[3]||(d[3]=te(()=>{},["prevent"]))},{default:l(()=>[t(k,{gutter:8},{default:l(()=>[t(x,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{label:"菜单名称"},{default:l(()=>[t(e,{clearable:"",modelValue:a(p).title,"onUpdate:modelValue":d[0]||(d[0]=r=>a(p).title=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{label:"菜单地址"},{default:l(()=>[t(e,{clearable:"",modelValue:a(p).path,"onUpdate:modelValue":d[1]||(d[1]=r=>a(p).path=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{label:"权限标识"},{default:l(()=>[t(e,{clearable:"",modelValue:a(p).authority,"onUpdate:modelValue":d[2]||(d[2]=r=>a(p).authority=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{"label-width":"16px"},{default:l(()=>[t(U,{type:"primary",onClick:g},{default:l(()=>d[4]||(d[4]=[y("查询")])),_:1}),t(U,{onClick:V},{default:l(()=>d[5]||(d[5]=[y("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Oe={__name:"menu-select",props:{modelValue:[Number,String],placeholder:{type:String,default:"请选择上级菜单"}},emits:["update:modelValue"],setup(M,{expose:I,emit:$}){const p=M,C=$,g=T([]),V=e=>{C("update:modelValue",e||0)},E=ae(()=>{var e;if(p.modelValue)return(e=ge(g.value,v=>v.menuId==p.modelValue))==null?void 0:e.icon}),d=()=>{de().then(e=>{g.value=oe({data:e,idField:"menuId",parentIdField:"parentId"})}).catch(e=>{R.error(e.message)})};return d(),I({reload:d}),(e,v)=>{const x=H,U=Re;return _(),f(U,{clearable:"",filterable:"",data:g.value,"check-strictly":"","default-expand-all":"","node-key":"menuId",props:{label:"title"},placeholder:M.placeholder,"model-value":M.modelValue||void 0,class:"ele-fluid","popper-options":{strategy:"fixed"},"onUpdate:modelValue":V},be({default:l(({data:k})=>[k.icon?(_(),f(x,{key:0,style:{"margin-right":"4px",transform:"translateY(-1px)"}},{default:l(()=>[(_(),f(W(k.icon)))]),_:2},1024)):z("",!0),O("span",null,A(k.title),1)]),_:2},[E.value?{name:"prefix",fn:l(()=>[t(x,{color:"var(--el-text-color-regular)",style:{"margin-right":"6px"}},{default:l(()=>[(_(),f(W(E.value)))]),_:1})]),key:"0"}:void 0]),1032,["data","placeholder","model-value"])}}},Ae={__name:"menu-edit",props:Q({data:Object,parentId:Number},{modelValue:{type:Boolean},modelModifiers:{}}),emits:Q(["done"],["update:modelValue"]),setup(M,{expose:I,emit:$}){const p=M,C=$,g=ve(M,"modelValue"),V=T(!1),E=T(!1),d=T(null),[e,v,x]=Z({menuId:void 0,parentId:void 0,title:"",menuType:0,openType:0,icon:"",path:"",component:"",authority:"",sortNumber:void 0,hide:0,status:0,meta:""}),U=ae(()=>{const s={title:[{required:!0,type:"string",message:"请输入菜单名称",trigger:"blur"}],sortNumber:[{required:!0,type:"number",message:"请输入排序号",trigger:"blur"}],meta:[{type:"string",validator:(n,i,c)=>{if(i){console.log("value",i);const u="请输入正确的JSON格式";try{const b=JSON.parse(i);if(b==null||typeof b!="object"){c(u);return}}catch(b){c(u);return}}c()},trigger:"blur"}]};return e.menuType!==2&&(s.path=[{required:!0,type:"string",message:e.openType===2?"请输入外链地址":"请输入路由地址",trigger:"blur"},{type:"string",validator:(n,i,c)=>{if(i)if(e.openType===2){if(!N(i)){c("请输入正确的链接地址");return}}else{if(i==="/"){c("路由地址不能为 /");return}if(!i.startsWith("/")){c("路由地址需要以 / 开头");return}}c()},trigger:"blur"}],e.menuType===1&&e.openType!==2&&(s.component=[{required:!0,type:"string",message:e.openType===1?"请输入内嵌地址":"请输入组件路径",trigger:"blur"},{type:"string",validator:(n,i,c)=>{if(i&&e.openType===1&&!N(i)){c("请输入正确的链接地址");return}c()},trigger:"blur"}])),s}),k=()=>{g.value=!1},w=()=>{var s,n;(n=(s=d.value)==null?void 0:s.validate)==null||n.call(s,i=>{if(!i)return;E.value=!0;const c=V.value?we:Fe;console.log("form",e),c({...e,menuType:e.menuType===2?1:0,parentId:e.parentId||0,meta:e.meta||""}).then(u=>{E.value=!1,R.success(u),k(),C("done")}).catch(u=>{E.value=!1,R.error(u.message)})})},F=()=>{var s,n;e.menuType===0?(e.authority="",e.openType=0,e.component=""):e.menuType===1?e.openType===2&&(e.authority=""):(e.openType=0,e.icon="",e.path="",e.component="",e.hide=0),(n=(s=d.value)==null?void 0:s.clearValidate)==null||n.call(s)},r=()=>{var s,n;e.openType===2&&(e.component="",e.authority=""),(n=(s=d.value)==null?void 0:s.clearValidate)==null||n.call(s)},o=s=>{e.hide=s?0:1},h=s=>{var n;return!!((n=s.children)!=null&&n.length)&&!s.component},D=()=>{if(p.data){const s=N(p.data.path),n=N(p.data.component),i=p.data.menuType===1?2:h(p.data)?0:1;x({...p.data,menuType:i,openType:s?2:n?1:0,parentId:p.data.parentId===0?void 0:p.data.parentId}),V.value=!0}else v(),e.parentId=p.parentId,V.value=!1;X(()=>{X(()=>{var s,n;(n=(s=d.value)==null?void 0:s.clearValidate)==null||n.call(s)})})},S=T(null);return I({reloadMenuSelectData:()=>{var s,n;(n=(s=S.value)==null?void 0:s.reload)==null||n.call(s)}}),(s,n)=>{const i=le,c=ne,u=ue,b=xe,G=Ve,j=ie,pe=re,q=H,K=he,me=$e,P=Te,ce=ee,Y=J,fe=Ie;return _(),f(fe,{form:"",width:740,modelValue:g.value,"onUpdate:modelValue":n[12]||(n[12]=m=>g.value=m),title:V.value?"修改菜单":"新建菜单",onOpen:D},{footer:l(()=>[t(Y,{onClick:k},{default:l(()=>n[13]||(n[13]=[y("取消")])),_:1}),t(Y,{type:"primary",loading:E.value,onClick:w},{default:l(()=>n[14]||(n[14]=[y(" 保存 ")])),_:1},8,["loading"])]),default:l(()=>[t(ce,{ref_key:"formRef",ref:d,model:a(e),rules:U.value,"label-width":"100px","validate-on-rule-change":!1,onSubmit:n[11]||(n[11]=te(()=>{},["prevent"]))},{default:l(()=>[t(j,{gutter:16},{default:l(()=>[t(u,{sm:12,xs:24},{default:l(()=>[t(i,{label:"上级菜单",prop:"parentId"},{default:l(()=>[t(Oe,{ref_key:"menuSelectRef",ref:S,modelValue:a(e).parentId,"onUpdate:modelValue":n[0]||(n[0]=m=>a(e).parentId=m)},null,8,["modelValue"])]),_:1}),t(i,{label:"菜单名称",prop:"title"},{default:l(()=>[t(c,{clearable:"",maxlength:20,modelValue:a(e).title,"onUpdate:modelValue":n[1]||(n[1]=m=>a(e).title=m),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{sm:12,xs:24},{default:l(()=>[t(i,{label:"菜单类型",prop:"menuType"},{default:l(()=>[t(G,{modelValue:a(e).menuType,"onUpdate:modelValue":n[2]||(n[2]=m=>a(e).menuType=m),onChange:F},{default:l(()=>[t(b,{value:0,label:"目录"}),t(b,{value:1,label:"菜单"}),t(b,{value:2,label:"按钮"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"打开方式"},{default:l(()=>[t(G,{modelValue:a(e).openType,"onUpdate:modelValue":n[3]||(n[3]=m=>a(e).openType=m),disabled:a(e).menuType===0||a(e).menuType===2,onChange:r},{default:l(()=>[t(b,{value:0,label:"组件"}),t(b,{value:1,label:"内嵌"}),t(b,{value:2,label:"外链"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(pe,{style:{margin:"8px 0 22px 0",opacity:"0.6"}}),t(j,{gutter:16},{default:l(()=>[t(u,{sm:12,xs:24},{default:l(()=>[t(i,{label:"菜单图标",prop:"icon"},{default:l(()=>[t(De,{clearable:"",filterable:"popper","popper-width":460,"popper-height":388,"popper-options":{strategy:"fixed"},placeholder:"请选择图标",modelValue:a(e).icon,"onUpdate:modelValue":n[4]||(n[4]=m=>a(e).icon=m),disabled:a(e).menuType===2},null,8,["modelValue","disabled"])]),_:1}),t(i,{prop:"path"},{label:l(()=>[a(e).openType===2?(_(),f(K,{key:0,content:"需要以`http://`、`https://`、`//`开头",placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[t(q,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:l(()=>[t(a(L),{style:{opacity:"0.6"}})]),_:1})]),_:1})):z("",!0),O("span",null,A(a(e).openType===2?"外链地址":"路由地址"),1)]),default:l(()=>[t(c,{clearable:"",maxlength:100,modelValue:a(e).path,"onUpdate:modelValue":n[5]||(n[5]=m=>a(e).path=m),disabled:a(e).menuType===2,placeholder:a(e).openType===2?"请输入外链地址":"请输入路由地址"},null,8,["modelValue","disabled","placeholder"])]),_:1}),t(i,{prop:"component"},{label:l(()=>[a(e).openType===1?(_(),f(K,{key:0,content:"需要以`http://`、`https://`、`//`开头",placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[t(q,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:l(()=>[t(a(L),{style:{opacity:"0.6"}})]),_:1})]),_:1})):z("",!0),O("span",null,A(a(e).openType===1?"内嵌地址":"组件路径"),1)]),default:l(()=>[t(c,{clearable:"",maxlength:100,modelValue:a(e).component,"onUpdate:modelValue":n[6]||(n[6]=m=>a(e).component=m),disabled:a(e).menuType===0||a(e).menuType===2||a(e).openType===2,placeholder:a(e).openType===1?"请输入内嵌地址":"请输入组件路径"},null,8,["modelValue","disabled","placeholder"])]),_:1})]),_:1}),t(u,{sm:12,xs:24},{default:l(()=>[t(i,{label:"权限标识",prop:"authority"},{default:l(()=>[t(c,{clearable:"",modelValue:a(e).authority,"onUpdate:modelValue":n[7]||(n[7]=m=>a(e).authority=m),placeholder:"请输入权限标识",disabled:a(e).menuType===0||a(e).menuType===1&&a(e).openType===2},null,8,["modelValue","disabled"])]),_:1}),t(i,{label:"排序号",prop:"sortNumber"},{default:l(()=>[t(me,{min:0,max:99999,modelValue:a(e).sortNumber,"onUpdate:modelValue":n[8]||(n[8]=m=>a(e).sortNumber=m),placeholder:"请输入排序号","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),t(i,{label:"是否展示"},{default:l(()=>[t(P,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":a(e).hide===0,disabled:a(e).menuType===2,onChange:o},null,8,["model-value","disabled"]),t(K,{content:"选择不展示只注册路由不展示在侧边栏, 比如添加页面应该选择不展示","popper-style":{maxWidth:"240px"}},{default:l(()=>[t(q,{size:15,style:{"margin-left":"16px",cursor:"help"}},{default:l(()=>[t(a(L),{style:{opacity:"0.6"}})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(j,null,{default:l(()=>[t(u,{span:24},{default:l(()=>[t(i,{label:"状态"},{default:l(()=>[t(P,{modelValue:a(e).status,"onUpdate:modelValue":n[9]||(n[9]=m=>a(e).status=m),"inline-prompt":"","active-value":"ENABLED","inactive-value":"DISABLED","active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(i,{label:"路由元数据",prop:"meta"},{default:l(()=>[t(c,{rows:4,type:"textarea",maxlength:200,modelValue:a(e).meta,"onUpdate:modelValue":n[10]||(n[10]=m=>a(e).meta=m),placeholder:"请输入JSON格式的路由元数据"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},st=Object.assign({name:"SystemMenu"},{__name:"index",setup(M){const I=T(null),$=T([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"title",label:"菜单名称",slot:"title",minWidth:160},{prop:"path",label:"路由地址",minWidth:160},{prop:"sortNumber",label:"排序",width:100,align:"center"},{prop:"hide",label:"可见",width:100,align:"center",formatter:r=>["是","否"][r.hide]},{prop:"menuType",label:"类型",width:100,align:"center",slot:"menuType",formatter:r=>["菜单","按钮","外链","内嵌","目录"][N(r.path)?2:N(r.component)?3:w(r)?4:r.menuType]},{columnKey:"action",label:"操作",width:180,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),p=T(null),C=T(!1),g=T(),V=T(null),E=async({where:r})=>{const o=await de({...r});return oe({data:o,idField:"menuId",parentIdField:"parentId"})},d=r=>{var o,h;(h=(o=I.value)==null?void 0:o.reload)==null||h.call(o,{where:r})},e=(r,o)=>{p.value=r!=null?r:null,g.value=o,C.value=!0},v=()=>{var r,o;(o=(r=V.value)==null?void 0:r.reloadMenuSelectData)==null||o.call(r)},x=r=>{var o;if((o=r.children)!=null&&o.length){R.error("请先删除子节点");return}Se.confirm("确定要删除“"+r.title+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const h=R.loading({message:"请求中..",plain:!0});ze(r.menuId).then(D=>{h.close(),R.success(D),d(),v()}).catch(D=>{h.close(),R.error(D.message)})}).catch(()=>{})},U=()=>{var r,o;(o=(r=I.value)==null?void 0:r.toggleRowExpansionAll)==null||o.call(r,!0)},k=()=>{var r,o;(o=(r=I.value)==null?void 0:r.toggleRowExpansionAll)==null||o.call(r,!1)},w=r=>{var o;return!!((o=r.children)!=null&&o.length)&&!r.component},F=()=>{d(),v()};return(r,o)=>{const h=J,D=H,S=ke,B=Ee,s=re,n=Ne,i=se,c=_e;return _(),f(c,null,{default:l(()=>[t(Be,{onSearch:d}),t(i,{"body-style":{paddingTop:"8px"}},{default:l(()=>[t(n,{sticky:"",ref_key:"tableRef",ref:I,"row-key":"menuId",columns:$.value,datasource:E,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"菜单数据"},"default-expand-all":!1,pagination:!1,"cache-key":"systemMenuTable"},{toolbar:l(()=>[t(h,{type:"primary",class:"ele-btn-icon",icon:a(Ce),onClick:o[0]||(o[0]=u=>e())},{default:l(()=>o[2]||(o[2]=[y(" 新建 ")])),_:1},8,["icon"]),t(h,{class:"ele-btn-icon",icon:a(Me),onClick:U},{default:l(()=>o[3]||(o[3]=[y(" 展开全部 ")])),_:1},8,["icon"]),t(h,{class:"ele-btn-icon",icon:a(Ue),onClick:k},{default:l(()=>o[4]||(o[4]=[y(" 折叠全部 ")])),_:1},8,["icon"])]),title:l(({row:u})=>[u.icon?(_(),f(D,{key:0,size:15,style:{"margin-right":"8px","vertical-align":"-2px"}},{default:l(()=>[(_(),f(W(u.icon)))]),_:2},1024)):z("",!0),O("span",null,A(u.title),1)]),menuType:l(({row:u})=>[a(N)(u.path)?(_(),f(S,{key:0,size:"small",type:"danger","disable-transitions":!0},{default:l(()=>o[5]||(o[5]=[y(" 外链 ")])),_:1})):a(N)(u.component)?(_(),f(S,{key:1,size:"small",type:"warning","disable-transitions":!0},{default:l(()=>o[6]||(o[6]=[y(" 内嵌 ")])),_:1})):w(u)?(_(),f(S,{key:2,size:"small","disable-transitions":!0},{default:l(()=>o[7]||(o[7]=[y(" 目录 ")])),_:1})):u.menuType===0?(_(),f(S,{key:3,size:"small",type:"success","disable-transitions":!0},{default:l(()=>o[8]||(o[8]=[y(" 菜单 ")])),_:1})):u.menuType===1?(_(),f(S,{key:4,size:"small",type:"info","disable-transitions":!0},{default:l(()=>o[9]||(o[9]=[y(" 按钮 ")])),_:1})):z("",!0)]),action:l(({row:u})=>[t(B,{type:"primary",underline:!1,onClick:b=>e(null,u.menuId)},{default:l(()=>o[10]||(o[10]=[y(" 添加 ")])),_:2},1032,["onClick"]),t(s,{direction:"vertical"}),t(B,{type:"primary",underline:!1,onClick:b=>e(u)},{default:l(()=>o[11]||(o[11]=[y(" 修改 ")])),_:2},1032,["onClick"]),t(s,{direction:"vertical"}),t(B,{type:"danger",underline:!1,onClick:b=>x(u)},{default:l(()=>o[12]||(o[12]=[y(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),t(Ae,{ref_key:"menuEditRef",ref:V,modelValue:C.value,"onUpdate:modelValue":o[1]||(o[1]=u=>C.value=u),data:p.value,"parent-id":g.value,onDone:F},null,8,["modelValue","data","parent-id"])]),_:1})}}});export{st as default};
