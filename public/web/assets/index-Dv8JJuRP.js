import{_ as B}from"./index-ByJwDCaU.js";import{b1 as $,c as E,o as w,w as o,b as l,aI as C,aJ as K,dc as N,aK as U,aM as I,u as m,aD as F,h as c,r as k,ay as D,k as S,t as T,b2 as R,au as j,m as i,aF as W}from"./index-AWZvdbgs.js";import{_ as V}from"./index-BWkpR5g6.js";import{_ as z}from"./index-DWBgQO06.js";import"./index-axKr1LNA.js";import"./index-C8O7s9CO.js";import"./index-CkvP5V7E.js";import"./virtual-list-B-mgPJnJ.js";import"./index-BVfMDzgA.js";import"./index-DgrYBINK.js";import{E as G}from"./upload-CX_hwZQS.js";import"./progress-DvpGEND2.js";import{a as J,E as L}from"./col-DZqiZqzL.js";import{p as O,r as P,u as q}from"./index-5H3zYDd1.js";import"./isArrayLikeObject-CgR4g7QS.js";import"./vuedraggable.umd-D8mshle6.js";const A={__name:"file-search",emits:["search"],setup(M,{emit:f}){const g=f,[n,b]=$({name:"",path:"",createNickname:""}),d=()=>{g("search",{...n})},_=()=>{b(),d()};return(v,e)=>{const t=I,a=U,r=L,u=F,h=J,y=C,x=V;return w(),E(x,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[l(y,{"label-width":"72px",onKeyup:N(d,["enter"]),onSubmit:e[3]||(e[3]=K(()=>{},["prevent"]))},{default:o(()=>[l(h,{gutter:8},{default:o(()=>[l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(a,{label:"文件名称"},{default:o(()=>[l(t,{clearable:"",modelValue:m(n).name,"onUpdate:modelValue":e[0]||(e[0]=p=>m(n).name=p),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(a,{label:"文件路径"},{default:o(()=>[l(t,{clearable:"",modelValue:m(n).path,"onUpdate:modelValue":e[1]||(e[1]=p=>m(n).path=p),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(a,{label:"上传人"},{default:o(()=>[l(t,{clearable:"",modelValue:m(n).createNickname,"onUpdate:modelValue":e[2]||(e[2]=p=>m(n).createNickname=p),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(a,{"label-width":"16px"},{default:o(()=>[l(u,{type:"primary",onClick:d},{default:o(()=>e[4]||(e[4]=[c("查询")])),_:1}),l(u,{onClick:_},{default:o(()=>e[5]||(e[5]=[c("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},ce=Object.assign({name:"SystemFile"},{__name:"index",setup(M){const f=k(null),g=k([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"name",label:"文件名称",sortable:"custom",minWidth:140},{prop:"path",label:"文件路径",sortable:"custom",minWidth:140,slot:"path"},{prop:"length",label:"文件大小",width:120,align:"center",sortable:"custom",formatter:e=>e.length<1024?e.length+"B":e.length<1024*1024?(e.length/1024).toFixed(1)+"KB":e.length<1024*1024*1024?(e.length/1024/1024).toFixed(1)+"M":(e.length/1024/1024/1024).toFixed(1)+"G"},{prop:"createNickname",label:"上传人",width:120,align:"center",sortable:"custom"},{prop:"createTime",label:"上传时间",width:180,align:"center",sortable:"custom"},{columnKey:"action",label:"操作",width:120,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),n=k([]),b=({pages:e,where:t,orders:a})=>O({...t,...a,...e}),d=e=>{var t,a;n.value=[],(a=(t=f.value)==null?void 0:t.reload)==null||a.call(t,{page:1,where:e})},_=e=>{const t=e==null?n.value:[e];if(!t.length){i.error("请至少选择一条数据");return}W.confirm("确定要删除“"+t.map(a=>a.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=i.loading({message:"请求中..",plain:!0});P(t.map(r=>r.id)).then(r=>{a.close(),i.success(r),d()}).catch(r=>{a.close(),i.error(r.message)})}).catch(()=>{})},v=e=>{if(e.size/1024/1024>100)return i.error("大小不能超过 100MB"),!1;const t=i.loading({message:"上传中..",plain:!0,mask:!0});return q(e).then(()=>{t.close(),i.success("上传成功"),d()}).catch(a=>{t.close(),i.error(a.message)}),!1};return(e,t)=>{const a=F,r=G,u=D,h=S,y=z,x=V,p=B;return w(),E(p,null,{default:o(()=>[l(A,{onSearch:d}),l(x,{"body-style":{paddingTop:"8px"}},{default:o(()=>[l(y,{ref_key:"tableRef",ref:f,"row-key":"id",columns:g.value,datasource:b,"show-overflow-tooltip":!0,selections:n.value,"onUpdate:selections":t[1]||(t[1]=s=>n.value=s),"highlight-current-row":!0,"export-config":{fileName:"文件数据"},"cache-key":"systemFileTable"},{toolbar:o(()=>[l(r,{action:"","show-file-list":!1,"before-upload":v,style:{display:"inline-block","vertical-align":"middle"}},{default:o(()=>[l(a,{type:"primary",class:"ele-btn-icon",icon:m(R)},{default:o(()=>t[2]||(t[2]=[c(" 上传 ")])),_:1},8,["icon"])]),_:1}),l(a,{type:"danger",class:"ele-btn-icon",icon:m(j),style:{"margin-left":"12px"},onClick:t[0]||(t[0]=s=>_())},{default:o(()=>t[3]||(t[3]=[c(" 删除 ")])),_:1},8,["icon"])]),path:o(({row:s})=>[l(u,{type:"primary",href:s.url,target:"_blank",underline:!1},{default:o(()=>[c(T(s.path),1)]),_:2},1032,["href"])]),action:o(({row:s})=>[l(u,{type:"primary",underline:!1,href:s.downloadUrl,target:"_blank"},{default:o(()=>t[4]||(t[4]=[c(" 下载 ")])),_:2},1032,["href"]),l(h,{direction:"vertical"}),l(u,{type:"danger",underline:!1,onClick:H=>_(s)},{default:o(()=>t[5]||(t[5]=[c(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1})]),_:1})}}});export{ce as default};
